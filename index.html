<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–ø–∏–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background-color: #f0e6d2;
            color: #3a2c1a;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23d4c9a8" d="M50 0c13.8 0 25 11.2 25 25s-11.2 25-25 25S25 38.8 25 25 36.2 0 50 0zm0 10c-8.3 0-15 6.7-15 15s6.7 15 15 15 15-6.7 15-15-6.7-15-15-15z"/></svg>');
            background-size: 30px 30px;
        }
        .container {
            padding: 15px;
            max-width: 600px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 2px solid #8b5a2b;
            padding-bottom: 10px;
        }
        .game-title {
            font-size: 24px;
            font-weight: bold;
            color: #5d3a1a;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
        }
        .pets-count {
            background-color: #8b5a2b;
            color: #f0e6d2;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }
        .pets-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .pet-card {
            background-color: #e8d8b8;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            text-align: center;
            border: 2px solid #8b5a2b;
            position: relative;
        }
        .pet-card-active {
            border-color: #d4a017;
            box-shadow: 0 0 10px #d4a017;
        }
        .pet-image {
            font-size: 40px;
            margin: 5px 0;
        }
        .pet-level {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #d4a017;
            color: #3a2c1a;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid #8b5a2b;
        }
        .pet-evolution {
            font-size: 12px;
            color: #5d3a1a;
            margin-top: 5px;
            font-style: italic;
        }
        .stats-container {
            background-color: #e8d8b8;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            border: 2px solid #8b5a2b;
            margin-bottom: 15px;
        }
        .stat {
            margin-bottom: 10px;
        }
        .stat-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .stat-icon {
            font-size: 20px;
            margin-right: 10px;
            width: 25px;
            text-align: center;
        }
        .stat-name {
            font-weight: bold;
            width: 80px;
        }
        .stat-value {
            font-weight: bold;
        }
        .stat-bar {
            height: 15px;
            background-color: #d4c9a8;
            border-radius: 7px;
            overflow: hidden;
            position: relative;
        }
        .stat-fill {
            height: 100%;
            border-radius: 7px;
            transition: width 0.3s;
        }
        .hunger-fill {
            background-color: #d4a017;
        }
        .energy-fill {
            background-color: #5f8b3a;
        }
        .happiness-fill {
            background-color: #a02c2c;
        }
        .hygiene-fill {
            background-color: #3a5f8b;
        }
        .xp-fill {
            background-color: #8b5a2b;
        }
        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .action-btn {
            padding: 10px;
            background-color: #8b5a2b;
            color: #f0e6d2;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: 'Times New Roman', serif;
            border: 1px solid #5d3a1a;
        }
        .action-btn:hover {
            background-color: #5d3a1a;
        }
        .action-btn:disabled {
            background-color: #a89b7c;
            cursor: not-allowed;
        }
        .log-container {
            height: 100px;
            overflow-y: auto;
            background-color: #e8d8b8;
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
            font-size: 12px;
            border: 2px solid #8b5a2b;
        }
        .log-entry {
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid #d4c9a8;
        }
        .log-time {
            color: #5d3a1a;
            font-size: 10px;
            margin-right: 5px;
        }
        .main-menu {
            text-align: center;
            margin-top: 50px;
        }
        .menu-title {
            font-size: 32px;
            font-weight: bold;
            color: #5d3a1a;
            margin-bottom: 30px;
            text-shadow: 2px 2px 3px rgba(0,0,0,0.2);
        }
        .menu-btn {
            padding: 12px 25px;
            background-color: #8b5a2b;
            color: #f0e6d2;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 10px;
            width: 200px;
            font-family: 'Times New Roman', serif;
            border: 2px solid #5d3a1a;
        }
        .menu-btn:hover {
            background-color: #5d3a1a;
        }
        .pet-colors {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 10px;
            cursor: pointer;
            border: 2px solid #5d3a1a;
        }
        .color-option.selected {
            border-color: #d4a017;
            box-shadow: 0 0 5px #d4a017;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="main-menu" class="main-menu" style="display: block;">
            <div class="menu-title">–¢–∞–ø–∏–∫–∏</div>
            <p>–í—ã—Ä–∞—â–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏—Ö –º–∏—à–µ–∫-—Ç–∞–ø–∏–∫–æ–≤ –≤ —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–æ–º —Å—Ç–∏–ª–µ!</p>
            <button id="new-game-btn" class="menu-btn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            <button id="load-game-btn" class="menu-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="game-screen" style="display: none;">
            <div class="header">
                <div class="game-title">–¢–∞–ø–∏–∫–∏</div>
                <div class="pets-count" id="pets-count">1 —Ç–∞–ø–∏–∫</div>
            </div>

            <div class="pets-container" id="pets-list">
                <!-- –ü–∏—Ç–æ–º—Ü—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <div class="stats-container">
                <div class="stat">
                    <div class="stat-header">
                        <div class="stat-icon">üçó</div>
                        <div class="stat-name">–ì–æ–ª–æ–¥:</div>
                        <div class="stat-value" id="hunger-value">50%</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill hunger-fill" id="hunger-bar" style="width: 50%;"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-header">
                        <div class="stat-icon">üí§</div>
                        <div class="stat-name">–≠–Ω–µ—Ä–≥–∏—è:</div>
                        <div class="stat-value" id="energy-value">50%</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill energy-fill" id="energy-bar" style="width: 50%;"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-header">
                        <div class="stat-icon">üé≠</div>
                        <div class="stat-name">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:</div>
                        <div class="stat-value" id="happiness-value">50%</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill happiness-fill" id="happiness-bar" style="width: 50%;"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-header">
                        <div class="stat-icon">üßº</div>
                        <div class="stat-name">–ß–∏—Å—Ç–æ—Ç–∞:</div>
                        <div class="stat-value" id="hygiene-value">50%</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill hygiene-fill" id="hygiene-bar" style="width: 50%;"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-header">
                        <div class="stat-icon">‚öîÔ∏è</div>
                        <div class="stat-name">–û–ø—ã—Ç:</div>
                        <div class="stat-value" id="xp-value">0/50</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill xp-fill" id="xp-bar" style="width: 0%;"></div>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button id="feed-btn" class="action-btn">–ö–æ—Ä–º–∏—Ç—å</button>
                <button id="sleep-btn" class="action-btn">–°–ø–∞—Ç—å</button>
                <button id="play-btn" class="action-btn">–ò–≥—Ä–∞—Ç—å</button>
                <button id="clean-btn" class="action-btn">–ú—ã—Ç—å</button>
                <button id="train-btn" class="action-btn">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <div class="log-container" id="game-log">
                <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
            </div>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const STATS = {
            HUNGER: 'hunger',
            ENERGY: 'energy',
            HAPPINESS: 'happiness',
            HYGIENE: 'hygiene',
            XP: 'xp'
        };

        const EVOLUTION_STAGES = [
            { level: 1, name: "–ú–∞–ª—ã—à", emoji: "üêª", nextEvolution: 3, xpToNextLevel: 50 },
            { level: 3, name: "–ü–æ–¥—Ä–æ—Å—Ç–æ–∫", emoji: "üêª‚Äç‚ùÑÔ∏è", nextEvolution: 6, xpToNextLevel: 100 },
            { level: 6, name: "–í–∑—Ä–æ—Å–ª—ã–π", emoji: "üß∏", nextEvolution: 9, xpToNextLevel: 150 },
            { level: 9, name: "–ú–∞—Å—Ç–µ—Ä", emoji: "üêæ", nextEvolution: null, xpToNextLevel: 200 }
        ];

        const COLORS = [
            { name: "–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π", value: "#8B4513" },
            { name: "–ß–µ—Ä–Ω—ã–π", value: "#000000" },
            { name: "–ë–µ–ª—ã–π", value: "#FFFFFF" },
            { name: "–†—ã–∂–∏–π", value: "#FF8C00" },
            { name: "–°–µ—Ä—ã–π", value: "#808080" }
        ];

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            pets: [],
            currentPetId: null,
            gameStarted: false,
            lastUpdateTime: Date.now(),
            selectedColor: COLORS[0]
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const mainMenu = document.getElementById('main-menu');
        const gameScreen = document.getElementById('game-screen');
        
        // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
        const newGameBtn = document.getElementById('new-game-btn');
        const loadGameBtn = document.getElementById('load-game-btn');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–≥—Ä–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
        const petsCountElement = document.getElementById('pets-count');
        const petsList = document.getElementById('pets-list');
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        const hungerBar = document.getElementById('hunger-bar');
        const energyBar = document.getElementById('energy-bar');
        const happinessBar = document.getElementById('happiness-bar');
        const hygieneBar = document.getElementById('hygiene-bar');
        const xpBar = document.getElementById('xp-bar');
        const hungerValue = document.getElementById('hunger-value');
        const energyValue = document.getElementById('energy-value');
        const happinessValue = document.getElementById('happiness-value');
        const hygieneValue = document.getElementById('hygiene-value');
        const xpValue = document.getElementById('xp-value');
        
        // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
        const feedBtn = document.getElementById('feed-btn');
        const sleepBtn = document.getElementById('sleep-btn');
        const playBtn = document.getElementById('play-btn');
        const cleanBtn = document.getElementById('clean-btn');
        const trainBtn = document.getElementById('train-btn');
        
        // –õ–æ–≥ –∏–≥—Ä—ã
        const gameLog = document.getElementById('game-log');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGame();
            setupEventListeners();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            setInterval(gameLoop, 1000);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.enableClosingConfirmation();
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            newGameBtn.addEventListener('click', startNewGame);
            loadGameBtn.addEventListener('click', loadGameAndContinue);
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            feedBtn.addEventListener('click', () => performAction('feed'));
            sleepBtn.addEventListener('click', () => performAction('sleep'));
            playBtn.addEventListener('click', () => performAction('play'));
            cleanBtn.addEventListener('click', () => performAction('clean'));
            trainBtn.addEventListener('click', () => performAction('train'));
        }

        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameState.gameStarted || gameState.pets.length === 0) return;
            
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdateTime) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdateTime = now;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ—Ö –ø–∏—Ç–æ–º—Ü–µ–≤
            gameState.pets.forEach(pet => {
                // –£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
                decayStats(pet, deltaTime);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —ç–≤–æ–ª—é—Ü–∏—é
                checkEvolution(pet);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ
                checkReproduction(pet);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É
            saveGame();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
        }

        // –£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
        function decayStats(pet, deltaTime) {
            const decayRate = 0.5; // –±–∞–∑–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–º–µ–Ω—å—à–µ–Ω–∏—è (% –≤ –º–∏–Ω—É—Ç—É)
            const decayAmount = decayRate * deltaTime / 60;
            
            pet.stats.hunger = Math.max(0, pet.stats.hunger - decayAmount);
            pet.stats.energy = Math.max(0, pet.stats.energy - decayAmount);
            pet.stats.happiness = Math.max(0, pet.stats.happiness - decayAmount * 0.8);
            pet.stats.hygiene = Math.max(0, pet.stats.hygiene - decayAmount * 0.7);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–º–µ—Ä—Ç—å –æ—Ç –≥–æ–ª–æ–¥–∞
            if (pet.stats.hunger <= 0) {
                addLogMessage(`–û–¥–∏–Ω –∏–∑ —Ç–∞–ø–∏–∫–æ–≤ —É–º–µ—Ä –æ—Ç –≥–æ–ª–æ–¥–∞!`, true);
                removePet(pet.id);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —ç–≤–æ–ª—é—Ü–∏—é
        function checkEvolution(pet) {
            const currentStage = getCurrentEvolutionStage(pet);
            
            if (currentStage.nextEvolution && pet.level >= currentStage.nextEvolution && 
                pet.evolutionStage < EVOLUTION_STAGES.length - 1) {
                pet.evolutionStage += 1;
                const newStage = EVOLUTION_STAGES[pet.evolutionStage];
                addLogMessage(`–¢–∞–ø–∏–∫ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª –¥–æ —Å—Ç–∞–¥–∏–∏ "${newStage.name}"!`, true);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ —ç–≤–æ–ª—é—Ü–∏–∏
                if (Math.random() < 0.3 && gameState.pets.length < 10) {
                    reproducePet(pet);
                }
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ
        function checkReproduction(pet) {
            if (pet.level >= 3 && pet.stats.happiness > 70 && pet.stats.energy > 70 && 
                gameState.pets.length < 10 && Math.random() < 0.001) {
                reproducePet(pet);
            }
        }

        // –†–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
        function reproducePet(parentPet) {
            const newPet = {
                id: generateId(),
                level: 1,
                xp: 0,
                evolutionStage: 0,
                stats: {
                    hunger: 70,
                    energy: 70,
                    happiness: 70,
                    hygiene: 70
                },
                color: parentPet.color
            };
            
            gameState.pets.push(newPet);
            gameState.currentPetId = newPet.id;
            addLogMessage(`–ü–æ—è–≤–∏–ª—Å—è –Ω–æ–≤—ã–π —Ç–∞–ø–∏–∫! –¢–µ–ø–µ—Ä—å –∏—Ö ${gameState.pets.length}.`, true);
        }

        // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
        function startNewGame() {
            gameState.pets = [createNewPet()];
            gameState.currentPetId = gameState.pets[0].id;
            gameState.gameStarted = true;
            gameState.lastUpdateTime = Date.now();
            
            addLogMessage(`–ü–µ—Ä–≤—ã–π —Ç–∞–ø–∏–∫ –ø–æ—è–≤–∏–ª—Å—è –≤ –≤–∞—à–µ–º –∑–∞–º–∫–µ!`, true);
            showGameScreen();
            saveGame();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
        function createNewPet() {
            return {
                id: generateId(),
                level: 1,
                xp: 0,
                evolutionStage: 0,
                stats: {
                    hunger: 70,
                    energy: 70,
                    happiness: 70,
                    hygiene: 70
                },
                color: gameState.selectedColor
            };
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã –∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
        function loadGameAndContinue() {
            if (gameState.pets.length > 0) {
                gameState.gameStarted = true;
                gameState.lastUpdateTime = Date.now();
                showGameScreen();
                addLogMessage(`–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!`, true);
            } else {
                addLogMessage("–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã. –ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—É—é –∏–≥—Ä—É.", true);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω
        function showGameScreen() {
            mainMenu.style.display = 'none';
            gameScreen.style.display = 'block';
            updateUI();
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
        function performAction(action) {
            const pet = getCurrentPet();
            if (!pet) return;
            
            const currentStage = getCurrentEvolutionStage(pet);
            const statGain = 20 + pet.level * 2;
            
            switch (action) {
                case 'feed':
                    pet.stats.hunger = Math.min(100, pet.stats.hunger + statGain);
                    pet.stats.hygiene = Math.max(0, pet.stats.hygiene - 5);
                    addLogMessage(`–í—ã –ø–æ–∫–æ—Ä–º–∏–ª–∏ —Ç–∞–ø–∏–∫–∞.`);
                    break;
                case 'sleep':
                    pet.stats.energy = Math.min(100, pet.stats.energy + statGain);
                    pet.stats.happiness = Math.max(0, pet.stats.happiness - 3);
                    addLogMessage(`–¢–∞–ø–∏–∫ –ø–æ—Å–ø–∞–ª –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª —ç–Ω–µ—Ä–≥–∏—é.`);
                    break;
                case 'play':
                    pet.stats.happiness = Math.min(100, pet.stats.happiness + statGain);
                    pet.stats.energy = Math.max(0, pet.stats.energy - 10);
                    pet.stats.hygiene = Math.max(0, pet.stats.hygiene - 8);
                    addLogMessage(`–í—ã –ø–æ–∏–≥—Ä–∞–ª–∏ —Å —Ç–∞–ø–∏–∫–æ–º.`);
                    break;
                case 'clean':
                    pet.stats.hygiene = Math.min(100, pet.stats.hygiene + statGain);
                    pet.stats.happiness = Math.max(0, pet.stats.happiness - 5);
                    addLogMessage(`–í—ã –ø–æ–º—ã–ª–∏ —Ç–∞–ø–∏–∫–∞.`);
                    break;
                case 'train':
                    const xpGain = 10 + pet.level * 2;
                    pet.xp += xpGain;
                    pet.stats.energy = Math.max(0, pet.stats.energy - 15);
                    pet.stats.hunger = Math.max(0, pet.stats.hunger - 5);
                    addLogMessage(`–¢–∞–ø–∏–∫ –ø–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–ª—Å—è (+${xpGain} –æ–ø—ã—Ç–∞).`);
                    break;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
            checkLevelUp(pet);
            
            saveGame();
            updateUI();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function checkLevelUp(pet) {
            const currentStage = getCurrentEvolutionStage(pet);
            
            if (pet.xp >= currentStage.xpToNextLevel) {
                pet.xp -= currentStage.xpToNextLevel;
                pet.level += 1;
                addLogMessage(`–¢–∞–ø–∏–∫ –¥–æ—Å—Ç–∏–≥ —É—Ä–æ–≤–Ω—è ${pet.level}!`, true);
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
        function removePet(petId) {
            gameState.pets = gameState.pets.filter(pet => pet.id !== petId);
            if (gameState.currentPetId === petId) {
                gameState.currentPetId = gameState.pets.length > 0 ? gameState.pets[0].id : null;
            }
            
            if (gameState.pets.length === 0) {
                gameState.gameStarted = false;
                mainMenu.style.display = 'block';
                gameScreen.style.display = 'none';
            }
            
            saveGame();
        }

        // –í—ã–±–æ—Ä –ø–∏—Ç–æ–º—Ü–∞
        function selectPet(petId) {
            gameState.currentPetId = petId;
            updateUI();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø–∏—Ç–æ–º—Ü–µ–≤
            updatePetsCount();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∏—Ç–æ–º—Ü–µ–≤
            renderPetsList();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
            const pet = getCurrentPet();
            if (pet) {
                updatePetStats(pet);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø–∏—Ç–æ–º—Ü–µ–≤
        function updatePetsCount() {
            const count = gameState.pets.length;
            petsCountElement.textContent = `${count} —Ç–∞–ø–∏–∫${getRussianPluralEnding(count)}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–∏—Ç–æ–º—Ü–∞
        function updatePetStats(pet) {
            const currentStage = getCurrentEvolutionStage(pet);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ—Å–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            updateStatBar(STATS.HUNGER, pet.stats.hunger);
            updateStatBar(STATS.ENERGY, pet.stats.energy);
            updateStatBar(STATS.HAPPINESS, pet.stats.happiness);
            updateStatBar(STATS.HYGIENE, pet.stats.hygiene);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—ã—Ç–∞
            const xpPercent = (pet.xp / currentStage.xpToNextLevel) * 100;
            xpBar.style.width = `${xpPercent}%`;
            xpValue.textContent = `${pet.xp}/${currentStage.xpToNextLevel}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ—Å–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatBar(stat, value) {
            const bar = document.getElementById(`${stat}-bar`);
            const valueElement = document.getElementById(`${stat}-value`);
            
            if (bar && valueElement) {
                const percent = Math.round(value);
                bar.style.width = `${percent}%`;
                valueElement.textContent = `${percent}%`;
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥
        function addLogMessage(message, isImportant = false) {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            if (isImportant) {
                logEntry.style.fontWeight = 'bold';
                logEntry.style.color = '#8b5a2b';
            }
            
            logEntry.innerHTML = `<span class="log-time">[${timeString}]</span> ${message}`;
            gameLog.appendChild(logEntry);
            
            // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–æ–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
            gameLog.scrollTop = gameLog.scrollHeight;
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –ø–∏—Ç–æ–º—Ü–µ–≤
        function renderPetsList() {
            petsList.innerHTML = '';
            
            gameState.pets.forEach(pet => {
                const petCard = document.createElement('div');
                petCard.className = `pet-card ${pet.id === gameState.currentPetId ? 'pet-card-active' : ''}`;
                petCard.onclick = () => selectPet(pet.id);
                
                const evolutionStage = getCurrentEvolutionStage(pet);
                
                petCard.innerHTML = `
                    <div class="pet-image" style="color: ${pet.color.value}">${evolutionStage.emoji}</div>
                    <div class="pet-level">${pet.level}</div>
                    <div class="pet-evolution">${evolutionStage.name}</div>
                `;
                
                petsList.appendChild(petCard);
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
        function getCurrentPet() {
            return gameState.pets.find(pet => pet.id === gameState.currentPetId) || 
                   (gameState.pets.length > 0 ? gameState.pets[0] : null);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç–∞–¥–∏–∏ —ç–≤–æ–ª—é—Ü–∏–∏
        function getCurrentEvolutionStage(pet) {
            for (let i = EVOLUTION_STAGES.length - 1; i >= 0; i--) {
                if (pet.level >= EVOLUTION_STAGES[i].level) {
                    return EVOLUTION_STAGES[i];
                }
            }
            return EVOLUTION_STAGES[0];
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
        function getRussianPluralEnding(number) {
            if (number % 10 === 1 && number % 100 !== 11) {
                return '';
            } else if ([2, 3, 4].includes(number % 10) && ![12, 13, 14].includes(number % 100)) {
                return '–∞';
            } else {
                return '–æ–≤';
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            if (gameState.gameStarted) {
                localStorage.setItem('tapikiGame', JSON.stringify({
                    pets: gameState.pets,
                    currentPetId: gameState.currentPetId,
                    selectedColor: gameState.selectedColor
                }));
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        function loadGame() {
            const savedGame = localStorage.getItem('tapikiGame');
            if (savedGame) {
                const data = JSON.parse(savedGame);
                gameState.pets = data.pets || [];
                gameState.currentPetId = data.currentPetId || (gameState.pets.length > 0 ? gameState.pets[0].id : null);
                gameState.selectedColor = data.selectedColor || COLORS[0];
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–≥
                gameLog.innerHTML = '';
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initGame;
    </script>
</body>
</html>