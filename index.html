<!DOCTYPE html>
<html>
<head>
    <title>Cosmic Cow Hunt Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* Обновлённые стили */
        body {
            margin: 0;
            overflow: hidden;
            touch-action: none;
            background: #000a20;
            font-family: 'Arial', sans-serif;
            color: white;
        }
        #gameCanvas {
            background: #000a20;
            display: block;
        }
        .menu {
            /* Обновлённый дизайн меню */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 20, 40, 0.95);
            padding: 40px 60px;
            color: white;
            text-align: center;
            border-radius: 20px;
            border: 3px solid #3399ff;
            box-shadow: 0 0 40px rgba(255, 100, 200, 0.4);
            min-width: 300px;
        }
        .menu h1 {
            color: #ff66cc;
            margin: 0 0 25px;
            font-size: 2.5em;
            text-shadow: 3px 3px 0 #ff0066;
        }
        /* Остальные стили... */
    </style>
</head>
<body>
    <!-- Обновлённая разметка -->
    <div class="menu" id="mainMenu">
        <h1>COSMIC COW</h1>
        <div class="menu-content">
            <button onclick="startGame()">START</button>
            <div class="level">Level: <span id="currentLevel">1</span></div>
        </div>
    </div>

    <!-- Игровые элементы... -->

    <script>
        const gameConfig = {
            levels: [
                { cows: 4, speed: 1.5, spawn: 2000 },
                { cows: 5, speed: 1.8, spawn: 1800 },
                { cows: 6, speed: 2.0, spawn: 1500 },
                // Добавьте больше уровней
            ],
            currentLevel: 0,
            cowTypes: [
                { // Базовый тип
                    texture: createBellyTexture('#f0f0f0', '#d0d0d0'),
                    score: 100,
                    movement: 'sinusoidal'
                },
                // Добавьте другие типы
            ]
        };

        class AdvancedCow {
            constructor() {
                // Улучшенная анимация ног
                this.legs = [
                    { angle: 0, phase: 0 },
                    { angle: 0, phase: Math.PI/2 },
                    { angle: 0, phase: Math.PI },
                    { angle: 0, phase: Math.PI*1.5 }
                ];
                
                // Новая система анимации
                this.animations = {
                    flying: this.createWingAnimation(),
                    dying: this.createDeathAnimation()
                };
            }

            drawHead(ctx) {
                // Новая отрисовка головы с носом
                ctx.fillStyle = '#F5DEB3';
                ctx.beginPath();
                ctx.ellipse(0, 10, 8, 6, 0, 0, Math.PI*2);
                ctx.fill();
                
                // Ноздри
                ctx.fillStyle = '#333';
                ctx.beginPath();
                ctx.arc(-4, 12, 1.5, 0, Math.PI*2);
                ctx.arc(4, 12, 1.5, 0, Math.PI*2);
                ctx.fill();
            }

            drawLegs(ctx) {
                // Улучшенная анимация ног
                this.legs.forEach((leg, i) => {
                    const angle = Math.sin(Date.now()/200 + leg.phase) * 0.3;
                    this.drawLeg(ctx, i, angle);
                });
            }

            drawWings(ctx) {
                // Новая система анимации крыльев
                const frame = this.animations.flying.next().value;
                ctx.drawImage(frame, -40, -30, 80, 60);
            }

            die() {
                // Новая анимация смерти
                this.state = 'dying';
                this.color = '#808080';
                this.eyes = 'X';
                this.startDeathAnimation();
            }
        }

        // Оптимизированные функции
        function optimizedStarDrawing() {
            // Кэшированные объекты для звезд
            const starCache = new Map();
            
            function drawStar(x, y, size, color) {
                const key = `${size}-${color}`;
                if(!starCache.has(key)) {
                    const canvas = document.createElement('canvas');
                    // ... создание кэшированного изображения
                    starCache.set(key, canvas);
                }
                ctx.drawImage(starCache.get(key), x, y);
            }
        }

        // Система уровней
        function updateLevel() {
            if(score > gameConfig.levels[currentLevel].requiredScore) {
                currentLevel++;
                updateLevelDisplay();
                applyLevelSettings();
            }
        }

        // Инициализация игры
        function initGame() {
            // Оптимизированная инициализация объектов
            createPlanetsWithCollisionCheck();
            generateNebulae();
            initCachedTextures();
        }

        // Запуск игры
        function startGame() {
            initGame();
            gameLoop();
        }

        // Основной цикл
        function gameLoop(timestamp) {
            if(!gameActive) return;
            
            updatePhysics();
            checkCollisions();
            updateAnimations();
            
            requestAnimationFrame(gameLoop);
        }

        // Добавьте остальные функции...
    </script>
</body>
</html>