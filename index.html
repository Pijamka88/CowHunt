<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–ø–∏–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --dark-brown: #5e2c04;
            --medium-brown: #8b4513;
            --light-brown: #a0522d;
            --parchment: #f5e7d0;
            --red: #8b0000;
            --gold: #daa520;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            background-color: var(--parchment);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23d9c7a7" d="M0 0h100v100H0z"/><path fill="none" stroke="%23a0522d" stroke-width="0.5" d="M0 20h100M0 40h100M0 60h100M0 80h100M20 0v100M40 0v100M60 0v100M80 0v100"/></svg>');
            color: var(--dark-brown);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        #main-menu, #game-screen {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: var(--parchment);
            border: 8px double var(--medium-brown);
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            position: relative;
        }
        
        #main-menu {
            text-align: center;
        }
        
        #game-screen {
            display: none;
        }
        
        h1, h2, h3 {
            color: var(--red);
            text-align: center;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
            margin-top: 0;
        }
        
        h1 {
            font-size: 2.5rem;
            letter-spacing: 2px;
            margin-bottom: 30px;
        }
        
        h2 {
            font-size: 1.8rem;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 10px;
        }
        
        button {
            background-color: var(--medium-brown);
            color: white;
            border: 2px solid var(--dark-brown);
            padding: 10px 20px;
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }
        
        button:hover {
            background-color: var(--light-brown);
            transform: translateY(-2px);
            box-shadow: 3px 3px 7px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .pets-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .pet {
            position: relative;
            width: 120px;
            text-align: center;
        }
        
        .pet-emoji {
            font-size: 60px;
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
        }
        
        .pet-emoji:hover {
            transform: scale(1.1);
        }
        
        .pet-emoji.active {
            animation: bounce 0.5s infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }
        
        .pet-level {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: var(--gold);
            color: var(--dark-brown);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid var(--dark-brown);
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        
        .pet-card {
            background-color: white;
            border: 3px solid var(--medium-brown);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        
        .pet-stat {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 0.9rem;
        }
        
        .stat-icon {
            margin-right: 5px;
            font-size: 1rem;
        }
        
        .progress-container {
            flex-grow: 1;
            height: 15px;
            background-color: #e0e0e0;
            border-radius: 7px;
            overflow: hidden;
            border: 1px solid var(--dark-brown);
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--medium-brown);
            transition: width 0.3s;
        }
        
        .health-bar { background-color: #8b0000; }
        .hunger-bar { background-color: #556b2f; }
        .energy-bar { background-color: #4169e1; }
        .happiness-bar { background-color: #daa520; }
        .exp-bar { background-color: #9370db; }
        
        .actions-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed var(--medium-brown);
        }
        
        .pets-count {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--gold);
            color: var(--dark-brown);
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            border: 2px solid var(--dark-brown);
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        
        .scroll-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid var(--medium-brown);
            border-radius: 5px;
            background-color: rgba(255,255,255,0.7);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–æ—Å—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        .scroll-container::-webkit-scrollbar {
            width: 10px;
        }
        
        .scroll-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        
        .scroll-container::-webkit-scrollbar-thumb {
            background: var(--medium-brown);
            border-radius: 5px;
        }
        
        .scroll-container::-webkit-scrollbar-thumb:hover {
            background: var(--light-brown);
        }
        
        .evolution-notice {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--parchment);
            border: 3px solid var(--gold);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            z-index: 100;
            text-align: center;
            animation: pulse 1.5s infinite;
            display: none;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .evolution-text {
            font-size: 1.5rem;
            color: var(--red);
            margin-bottom: 10px;
        }
        
        .evolution-emoji {
            font-size: 3rem;
            display: block;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="main-menu">
        <h1>–¢–∞–ø–∏–∫–∏</h1>
        <button id="continue-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <button id="new-game-btn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>
    
    <div id="game-screen">
        <div class="pets-count" id="pets-count">0</div>
        <h2>–í–∞—à–∏ –¢–∞–ø–∏–∫–∏</h2>
        
        <div class="scroll-container">
            <div class="pets-container" id="pets-container">
                <!-- –¢–∞–ø–∏–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <div class="actions-container">
            <button id="feed-btn">üçó –ü–æ–∫–æ—Ä–º–∏—Ç—å</button>
            <button id="play-btn">‚öΩ –ò–≥—Ä–∞—Ç—å</button>
            <button id="sleep-btn">üåô –°–ø–∞—Ç—å</button>
            <button id="heal-btn">üíä –õ–µ—á–∏—Ç—å</button>
            <button id="train-btn">üèãÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>
    
    <div class="evolution-notice" id="evolution-notice">
        <div class="evolution-text">–≠–≤–æ–ª—é—Ü–∏—è!</div>
        <span class="evolution-emoji" id="evolution-emoji">üêª ‚ûî üêª‚Äç‚ùÑÔ∏è</span>
        <div id="evolution-text">–í–∞—à –¢–∞–ø–∏–∫ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª!</div>
        <button id="evolution-ok-btn">OK</button>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            pets: [],
            lastUpdate: Date.now(),
            version: 1
        };
        
        // –¶–≤–µ—Ç–∞ –¥–ª—è –¢–∞–ø–∏–∫–æ–≤
        const bearColors = [
            'üêª', // –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π
            'üêª‚Äç‚ùÑÔ∏è', // –ë–µ–ª—ã–π
            'üß∏', // –ñ–µ–ª—Ç—ã–π
            'üêæ', // –ß–µ—Ä–Ω—ã–π
            'üå∞', // –ö–∞—à—Ç–∞–Ω–æ–≤—ã–π
        ];
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const elements = {
            mainMenu: document.getElementById('main-menu'),
            gameScreen: document.getElementById('game-screen'),
            continueBtn: document.getElementById('continue-btn'),
            newGameBtn: document.getElementById('new-game-btn'),
            petsContainer: document.getElementById('pets-container'),
            petsCount: document.getElementById('pets-count'),
            feedBtn: document.getElementById('feed-btn'),
            playBtn: document.getElementById('play-btn'),
            sleepBtn: document.getElementById('sleep-btn'),
            healBtn: document.getElementById('heal-btn'),
            trainBtn: document.getElementById('train-btn'),
            evolutionNotice: document.getElementById('evolution-notice'),
            evolutionEmoji: document.getElementById('evolution-emoji'),
            evolutionText: document.getElementById('evolution-text'),
            evolutionOkBtn: document.getElementById('evolution-ok-btn')
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGame();
            setupEventListeners();
            updateMenu();
            
            if (gameState.pets.length > 0) {
                showGameScreen();
                updateGameUI();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            setInterval(gameLoop, 1000);
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            elements.continueBtn.addEventListener('click', showGameScreen);
            elements.newGameBtn.addEventListener('click', startNewGame);
            
            // –ò–≥—Ä–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
            elements.feedBtn.addEventListener('click', () => performAction('feed'));
            elements.playBtn.addEventListener('click', () => performAction('play'));
            elements.sleepBtn.addEventListener('click', () => performAction('sleep'));
            elements.healBtn.addEventListener('click', () => performAction('heal'));
            elements.trainBtn.addEventListener('click', () => performAction('train'));
            
            // –≠–≤–æ–ª—é—Ü–∏—è
            elements.evolutionOkBtn.addEventListener('click', hideEvolutionNotice);
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (gameState.pets.length === 0) return;
            
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdate) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdate = now;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ—Ö –¢–∞–ø–∏–∫–æ–≤
            gameState.pets.forEach(pet => {
                updatePet(pet, deltaTime);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            saveGame();
            updateGameUI();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¢–∞–ø–∏–∫–∞
        function updatePet(pet, deltaTime) {
            // –£–º–µ–Ω—å—à–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
            pet.hunger = Math.max(0, pet.hunger - 0.5 * deltaTime);
            pet.energy = Math.max(0, pet.energy - 0.3 * deltaTime);
            pet.happiness = Math.max(0, pet.happiness - 0.2 * deltaTime);
            
            // –ï—Å–ª–∏ –≥–æ–ª–æ–¥ –∏–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –Ω–∞ –Ω—É–ª–µ, —É–º–µ–Ω—å—à–∞–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
            if (pet.hunger <= 0 || pet.energy <= 0) {
                pet.health = Math.max(0, pet.health - 1 * deltaTime);
            }
            
            // –ï—Å–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ –Ω—É–ª–µ, —É–º–µ–Ω—å—à–∞–µ–º —Å—á–∞—Å—Ç—å–µ
            if (pet.health <= 0) {
                pet.happiness = Math.max(0, pet.happiness - 1 * deltaTime);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –¢–∞–ø–∏–∫
            if (pet.health <= 0 && !pet.isDead) {
                pet.isDead = true;
                pet.deathTime = Date.now();
            }
            
            // –ï—Å–ª–∏ –¢–∞–ø–∏–∫ –º–µ—Ä—Ç–≤ –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç, —É–¥–∞–ª—è–µ–º –µ–≥–æ
            if (pet.isDead && Date.now() - pet.deathTime > 300000) {
                const index = gameState.pets.indexOf(pet);
                if (index !== -1) {
                    gameState.pets.splice(index, 1);
                }
            }
        }
        
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –¢–∞–ø–∏–∫–æ–º
        function performAction(action) {
            const activePet = getActivePet();
            if (!activePet || activePet.isDead) return;
            
            switch (action) {
                case 'feed':
                    activePet.hunger = Math.min(100, activePet.hunger + 30);
                    activePet.energy = Math.max(0, activePet.energy - 5);
                    activePet.exp += 5;
                    break;
                case 'play':
                    activePet.happiness = Math.min(100, activePet.happiness + 20);
                    activePet.energy = Math.max(0, activePet.energy - 10);
                    activePet.hunger = Math.max(0, activePet.hunger - 5);
                    activePet.exp += 10;
                    break;
                case 'sleep':
                    activePet.energy = Math.min(100, activePet.energy + 40);
                    activePet.hunger = Math.max(0, activePet.hunger - 10);
                    activePet.exp += 5;
                    break;
                case 'heal':
                    activePet.health = Math.min(100, activePet.health + 30);
                    activePet.energy = Math.max(0, activePet.energy - 15);
                    activePet.exp += 5;
                    break;
                case 'train':
                    activePet.energy = Math.max(0, activePet.energy - 20);
                    activePet.hunger = Math.max(0, activePet.hunger - 15);
                    activePet.exp += 20;
                    break;
            }
            
            checkLevelUp(activePet);
            updateGameUI();
            saveGame();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function checkLevelUp(pet) {
            const expNeeded = getExpForLevel(pet.level + 1);
            
            if (pet.exp >= expNeeded) {
                pet.level++;
                pet.exp -= expNeeded;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–≤–æ–ª—é—Ü–∏—é –∫–∞–∂–¥—ã–µ 3 —É—Ä–æ–≤–Ω—è
                if (pet.level % 3 === 0) {
                    evolvePet(pet);
                }
                
                // –ï—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –∫—Ä–∞—Ç–µ–Ω 5, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –¢–∞–ø–∏–∫–∞
                if (pet.level % 5 === 0 && gameState.pets.length < 10) {
                    createNewPet();
                }
            }
        }
        
        // –≠–≤–æ–ª—é—Ü–∏—è –¢–∞–ø–∏–∫–∞
        function evolvePet(pet) {
            // –ü—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º —Ü–≤–µ—Ç/—Ñ–æ—Ä–º—É –¢–∞–ø–∏–∫–∞
            const currentColorIndex = bearColors.indexOf(pet.emoji);
            const nextColorIndex = (currentColorIndex + 1) % bearColors.length;
            const oldEmoji = pet.emoji;
            pet.emoji = bearColors[nextColorIndex];
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç–≤–æ–ª—é—Ü–∏–∏
            showEvolutionNotice(oldEmoji, pet.emoji, pet.level);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¢–∞–ø–∏–∫–∞
        function createNewPet() {
            if (gameState.pets.length >= 10) return;
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç, –æ—Ç–ª–∏—á–Ω—ã–π –æ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
            let availableColors = [...bearColors];
            gameState.pets.forEach(pet => {
                availableColors = availableColors.filter(color => color !== pet.emoji);
            });
            
            if (availableColors.length === 0) {
                availableColors = [...bearColors];
            }
            
            const randomColor = availableColors[Math.floor(Math.random() * availableColors.length)];
            
            const newPet = {
                emoji: randomColor,
                level: 1,
                exp: 0,
                health: 100,
                hunger: 50,
                energy: 80,
                happiness: 70,
                isDead: false,
                isActive: false
            };
            
            gameState.pets.push(newPet);
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¢–∞–ø–∏–∫–∞
        function getActivePet() {
            return gameState.pets.find(pet => pet.isActive) || gameState.pets[0];
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–ø—ã—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω—è
        function getExpForLevel(level) {
            return 100 * Math.pow(level, 1.5);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–≥—Ä—ã
        function updateGameUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¢–∞–ø–∏–∫–æ–≤
            elements.petsCount.textContent = gameState.pets.length;
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            elements.petsContainer.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ—Ö –¢–∞–ø–∏–∫–æ–≤
            gameState.pets.forEach((pet, index) => {
                const petElement = document.createElement('div');
                petElement.className = 'pet';
                
                // –ò–∫–æ–Ω–∫–∞ –¢–∞–ø–∏–∫–∞ —Å —É—Ä–æ–≤–Ω–µ–º
                const emojiElement = document.createElement('div');
                emojiElement.className = `pet-emoji ${pet.isActive ? 'active' : ''}`;
                emojiElement.textContent = pet.emoji;
                emojiElement.addEventListener('click', () => setActivePet(index));
                
                const levelElement = document.createElement('div');
                levelElement.className = 'pet-level';
                levelElement.textContent = pet.level;
                
                // –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                const cardElement = document.createElement('div');
                cardElement.className = 'pet-card';
                
                // –ó–¥–æ—Ä–æ–≤—å–µ
                const healthElement = createStatElement('‚ù§Ô∏è', '–ó–¥–æ—Ä–æ–≤—å–µ', pet.health, 100, 'health-bar');
                
                // –ì–æ–ª–æ–¥
                const hungerElement = createStatElement('üçé', '–ì–æ–ª–æ–¥', pet.hunger, 100, 'hunger-bar');
                
                // –≠–Ω–µ—Ä–≥–∏—è
                const energyElement = createStatElement('‚ö°', '–≠–Ω–µ—Ä–≥–∏—è', pet.energy, 100, 'energy-bar');
                
                // –°—á–∞—Å—Ç—å–µ
                const happinessElement = createStatElement('üòä', '–°—á–∞—Å—Ç—å–µ', pet.happiness, 100, 'happiness-bar');
                
                // –û–ø—ã—Ç
                const expElement = createStatElement('‚ú®', '–û–ø—ã—Ç', pet.exp, getExpForLevel(pet.level + 1), 'exp-bar');
                
                // –°–æ–±–∏—Ä–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
                cardElement.appendChild(healthElement);
                cardElement.appendChild(hungerElement);
                cardElement.appendChild(energyElement);
                cardElement.appendChild(happinessElement);
                cardElement.appendChild(expElement);
                
                // –°–æ–±–∏—Ä–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¢–∞–ø–∏–∫–∞
                petElement.appendChild(emojiElement);
                petElement.appendChild(levelElement);
                petElement.appendChild(cardElement);
                
                // –ï—Å–ª–∏ –¢–∞–ø–∏–∫ –º–µ—Ä—Ç–≤
                if (pet.isDead) {
                    const deadText = document.createElement('div');
                    deadText.textContent = 'üíÄ –£–º–µ—Ä';
                    deadText.style.color = 'red';
                    deadText.style.fontWeight = 'bold';
                    cardElement.appendChild(deadText);
                    
                    emojiElement.style.opacity = '0.5';
                    emojiElement.style.animation = 'none';
                }
                
                elements.petsContainer.appendChild(petElement);
            });
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–π –¢–∞–ø–∏–∫ –º–µ—Ä—Ç–≤
            const activePet = getActivePet();
            if (activePet && activePet.isDead) {
                elements.feedBtn.disabled = true;
                elements.playBtn.disabled = true;
                elements.sleepBtn.disabled = true;
                elements.healBtn.disabled = true;
                elements.trainBtn.disabled = true;
            } else {
                elements.feedBtn.disabled = false;
                elements.playBtn.disabled = false;
                elements.sleepBtn.disabled = false;
                elements.healBtn.disabled = false;
                elements.trainBtn.disabled = false;
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function createStatElement(icon, name, value, max, barClass) {
            const statElement = document.createElement('div');
            statElement.className = 'pet-stat';
            
            const iconElement = document.createElement('span');
            iconElement.className = 'stat-icon';
            iconElement.textContent = icon;
            
            const textElement = document.createElement('span');
            textElement.textContent = name + ':';
            textElement.style.minWidth = '70px';
            
            const valueElement = document.createElement('span');
            valueElement.textContent = ` ${Math.floor(value)}/${max}`;
            valueElement.style.minWidth = '50px';
            valueElement.style.textAlign = 'right';
            
            const progressContainer = document.createElement('div');
            progressContainer.className = 'progress-container';
            
            const progressBar = document.createElement('div');
            progressBar.className = `progress-bar ${barClass}`;
            progressBar.style.width = `${(value / max) * 100}%`;
            
            progressContainer.appendChild(progressBar);
            
            statElement.appendChild(iconElement);
            statElement.appendChild(textElement);
            statElement.appendChild(valueElement);
            statElement.appendChild(progressContainer);
            
            return statElement;
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¢–∞–ø–∏–∫–∞
        function setActivePet(index) {
            gameState.pets.forEach((pet, i) => {
                pet.isActive = (i === index);
            });
            updateGameUI();
            saveGame();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç–≤–æ–ª—é—Ü–∏–∏
        function showEvolutionNotice(oldEmoji, newEmoji, level) {
            elements.evolutionEmoji.textContent = `${oldEmoji} ‚ûî ${newEmoji}`;
            elements.evolutionText.textContent = `–¢–∞–ø–∏–∫ –¥–æ—Å—Ç–∏–≥ —É—Ä–æ–≤–Ω—è ${level} –∏ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª!`;
            elements.evolutionNotice.style.display = 'block';
        }
        
        // –°–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç–≤–æ–ª—é—Ü–∏–∏
        function hideEvolutionNotice() {
            elements.evolutionNotice.style.display = 'none';
        }
        
        // –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
        function startNewGame() {
            // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ –¢–∞–ø–∏–∫–∞
            gameState.pets = [{
                emoji: bearColors[0],
                level: 1,
                exp: 0,
                health: 100,
                hunger: 50,
                energy: 80,
                happiness: 70,
                isDead: false,
                isActive: true,
                birthTime: Date.now()
            }];
            
            gameState.lastUpdate = Date.now();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
            saveGame();
            showGameScreen();
            updateGameUI();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        function saveGame() {
            localStorage.setItem('tapiGame', JSON.stringify(gameState));
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
        function loadGame() {
            const savedGame = localStorage.getItem('tapiGame');
            if (savedGame) {
                const parsed = JSON.parse(savedGame);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                if (parsed.version === gameState.version) {
                    gameState = parsed;
                }
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é
        function updateMenu() {
            elements.continueBtn.disabled = gameState.pets.length === 0;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        function showMainMenu() {
            elements.mainMenu.style.display = 'block';
            elements.gameScreen.style.display = 'none';
            updateMenu();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∏–≥—Ä—ã
        function showGameScreen() {
            elements.mainMenu.style.display = 'none';
            elements.gameScreen.style.display = 'block';
            updateGameUI();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>