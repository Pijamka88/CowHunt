<!DOCTYPE html>
<html>
<head>
    <title>Cosmic Cows Hunt</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            touch-action: none;
            font-family: 'Arial', sans-serif;
            color: white;
        }
        
        #gameCanvas {
            cursor: crosshair;
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            background: rgba(0,0,0,0.9);
            text-align: center;
            padding-top: 20vh;
        }

        .active {
            display: block;
        }

        button {
            padding: 15px 30px;
            font-size: 20px;
            background: #4e54c8;
            border: 2px solid #8f94fb;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }

        button:hover {
            background: #8f94fb;
            transform: scale(1.1);
        }

        .hud {
            position: fixed;
            padding: 10px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
        }

        #topHUD {
            top: 10px;
            left: 10px;
        }

        #bottomHUD {
            bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: space-around;
        }

        .heart {
            color: #ff3366;
            font-size: 24px;
        }

        #reloadStatus {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            color: #ff3366;
            text-shadow: 0 0 10px #ff3366;
            display: none;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="mainMenu" class="screen active">
        <h1>‚ú® Cosmic Cows Hunt ‚ú®</h1>
        <button onclick="showScreen('game')">Start Game</button>
        <button onclick="showScreen('howToPlay')">How to Play</button>
        <button onclick="showScreen('highScores')">High Scores</button>
    </div>

    <div id="howToPlay" class="screen">
        <h2>How to Play</h2>
        <p>üî´ 5 bullets | ‚ù§Ô∏è 3 lives</p>
        <p>Shoot flying cows in 60 seconds!</p>
        <p>Different cow types give different points</p>
        <button onclick="showScreen('mainMenu')">Back</button>
    </div>

    <div id="highScores" class="screen">
        <h2>üèÜ Top 5 üèÜ</h2>
        <div id="scoresList"></div>
        <button onclick="showScreen('mainMenu')">Back</button>
    </div>

    <div id="topHUD" class="hud">
        Score: <span id="score">0</span> | Time: <span id="time">60</span>
    </div>

    <div id="bottomHUD" class="hud">
        <div>Ammo: <span id="ammo">5</span></div>
        <div>Hits: <span id="hits">0</span></div>
        <div>Misses: <span id="misses">0</span></div>
        <div>Lives: <span id="lives">‚ô•‚ô•‚ô•</span></div>
    </div>

    <div id="reloadStatus">RELOADING!</div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let animationId;
        let cows = [];
        let score = 0;
        let gameTime = 60;
        let gameActive = false;
        let ammo = 5;
        let hits = 0;
        let misses = 0;
        let lives = 3;
        let isReloading = false;

        // Game settings
        const COW_TYPES = [
            {color: '#8B4513', speed: 3, score: 100, pattern: 'linear'},
            {color: '#4B0082', speed: 4, score: 150, pattern: 'sin'},
            {color: '#B22222', speed: 5, score: 200, pattern: 'circle'}
        ];

        // Initialize WebApp
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class CosmicCow {
            constructor() {
                this.type = COW_TYPES[Math.floor(Math.random() * COW_TYPES.length)];
                this.x = canvas.width;
                this.y = Math.random() * (canvas.height - 80);
                this.angle = 0;
                this.radius = 0;
            }

            draw() {
                // Body
                ctx.fillStyle = this.type.color;
                ctx.fillRect(this.x, this.y, 60, 30);
                
                // Head
                ctx.beginPath();
                ctx.arc(this.x + 60, this.y + 15, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // Wings
                ctx.fillStyle = 'rgba(143, 148, 251, 0.5)';
                ctx.beginPath();
                ctx.ellipse(this.x + 30, this.y - 10, 20, 15, this.angle, 0, Math.PI * 2);
                ctx.fill();
                
                // Legs
                ctx.fillStyle = '#333';
                for(let i = 0; i < 3; i++) {
                    ctx.fillRect(this.x + 10 + i*15, this.y + 30, 5, 20);
                }
            }

            update() {
                switch(this.type.pattern) {
                    case 'sin':
                        this.x -= this.type.speed;
                        this.y += Math.sin(this.angle) * 2;
                        this.angle += 0.1;
                        break;
                    case 'circle':
                        this.radius += 0.1;
                        this.x -= this.type.speed;
                        this.y += Math.sin(this.radius) * 3;
                        break;
                    default:
                        this.x -= this.type.speed;
                }
            }
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background effect
            ctx.fillStyle = 'rgba(78, 84, 200, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            cows.forEach((cow, index) => {
                cow.update();
                cow.draw();
                if(cow.x < -100) cows.splice(index, 1);
            });

            animationId = requestAnimationFrame(gameLoop);
        }

        function spawnCow() {
            if(gameActive) {
                cows.push(new CosmicCow());
                setTimeout(spawnCow, 1000 + Math.random() * 1000);
            }
        }

        function startGame() {
            gameActive = true;
            score = 0;
            gameTime = 60;
            ammo = 5;
            hits = 0;
            misses = 0;
            lives = 3;
            cows = [];
            updateHUD();
            spawnCow();
            gameLoop();

            const timer = setInterval(() => {
                gameTime--;
                updateHUD();
                if(gameTime <= 0) {
                    endGame();
                    clearInterval(timer);
                }
            }, 1000);
        }

        function endGame() {
            gameActive = false;
            cancelAnimationFrame(animationId);
            showScreen('mainMenu');
            updateHighScores();
        }

        function updateHUD() {
            document.getElementById('score').textContent = score;
            document.getElementById('time').textContent = gameTime;
            document.getElementById('ammo').textContent = ammo;
            document.getElementById('hits').textContent = hits;
            document.getElementById('misses').textContent = misses;
            document.getElementById('lives').innerHTML = '‚ô•'.repeat(lives);
        }

        function reload() {
            if(ammo > 0) return;
            isReloading = true;
            document.getElementById('reloadStatus').style.display = 'block';
            canvas.style.cursor = 'wait';
            
            setTimeout(() => {
                ammo = 5;
                isReloading = false;
                canvas.style.cursor = 'crosshair';
                document.getElementById('reloadStatus').style.display = 'none';
                updateHUD();
            }, 2000);
        }

        canvas.addEventListener('click', (e) => {
            if(!gameActive || isReloading) return;
            
            if(ammo <= 0) {
                reload();
                return;
            }

            ammo--;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            let hit = false;

            cows.forEach((cow, index) => {
                if(x > cow.x && x < cow.x + 75 && y > cow.y && y < cow.y + 50) {
                    cows.splice(index, 1);
                    score += cow.type.score;
                    hits++;
                    hit = true;
                }
            });

            if(!hit) {
                misses++;
                if(misses % 5 === 0) {
                    lives = Math.max(0, lives - 1);
                    if(lives === 0) endGame();
                }
            }

            updateHUD();
            if(ammo <= 0) reload();
        });

        // Screens management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId === 'mainMenu' ? 'mainMenu' : screenId).classList.add('active');
            
            if(screenId === 'game') {
                startGame();
            }
        }

        // High Scores system
        function updateHighScores() {
            const scores = JSON.parse(localStorage.getItem('cosmicCowsScores') || '[]');
            const playerName = prompt('Enter your name:', 'Player');
            
            if(playerName) {
                scores.push({name: playerName, score: score});
                scores.sort((a, b) => b.score - a.score);
                const topScores = scores.slice(0, 5);
                localStorage.setItem('cosmicCowsScores', JSON.stringify(topScores));
                showScreen('highScores');
                displayScores();
            }
        }

        function displayScores() {
            const scores = JSON.parse(localStorage.getItem('cosmicCowsScores') || [];
            const list = document.getElementById('scoresList');
            list.innerHTML = scores.map((s, i) => 
                `<div>${i+1}. ${s.name}: ${s.score}</div>`
            ).join('');
        }

        // Initial scores display
        displayScores();
    </script>
</body>
</html>