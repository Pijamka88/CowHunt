<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medieval Bear Tamagotchi</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --dark-brown: #5e3a1f;
            --medium-brown: #8b5a2b;
            --light-brown: #d2a679;
            --parchment: #f5e7d0;
            --red: #a52a2a;
            --gold: #daa520;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background-color: var(--parchment);
            color: var(--dark-brown);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23d2a679" fill-opacity="0.2" d="M0 0h100v100H0z"/><path fill="none" stroke="%235e3a1f" stroke-width="0.5" stroke-opacity="0.3" d="M20 20l60 60M20 80l60-60"/></svg>');
            position: relative;
            min-height: 100vh;
        }
        
        #game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--dark-brown);
            padding-bottom: 10px;
        }
        
        .title {
            font-size: 28px;
            font-weight: bold;
            color: var(--red);
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
            letter-spacing: 1px;
        }
        
        .pets-count {
            background-color: var(--dark-brown);
            color: var(--parchment);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 16px;
            border: 2px solid var(--gold);
        }
        
        .pets-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .pet {
            position: relative;
            width: 120px;
            height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .pet-emoji {
            font-size: 60px;
            margin-bottom: 10px;
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .pet-emoji:hover {
            transform: scale(1.1);
        }
        
        .pet-level {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: var(--gold);
            color: var(--dark-brown);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid var(--dark-brown);
        }
        
        .pet-health {
            width: 100%;
            height: 5px;
            background-color: #ccc;
            border-radius: 3px;
            margin-top: 5px;
        }
        
        .pet-health-bar {
            height: 100%;
            border-radius: 3px;
            background-color: var(--red);
            transition: width 0.3s;
        }
        
        .actions-container {
            background-color: var(--light-brown);
            border: 3px solid var(--dark-brown);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .actions-title {
            font-size: 20px;
            text-align: center;
            margin-bottom: 15px;
            color: var(--dark-brown);
            font-weight: bold;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        button {
            background-color: var(--dark-brown);
            color: var(--parchment);
            border: none;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Times New Roman', serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--gold);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        button:hover {
            background-color: var(--medium-brown);
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #ccc;
            color: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-container {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
            border: 1px solid var(--dark-brown);
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--gold);
            width: 0%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-brown);
            font-size: 12px;
            font-weight: bold;
        }
        
        .action-progress {
            display: none;
            margin-top: 15px;
        }
        
        .action-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }
        
        .bounce { animation: bounce 0.5s infinite; }
        .pulse { animation: pulse 0.5s infinite; }
        .shake { animation: shake 0.3s infinite; }
        
        .evolution-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--parchment);
            border: 3px solid var(--gold);
            border-radius: 10px;
            padding: 20px;
            z-index: 100;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 300px;
            display: none;
        }
        
        .evolution-text {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--dark-brown);
        }
        
        .evolution-emoji {
            font-size: 50px;
            margin: 10px 0;
        }
        
        .evolution-button {
            background-color: var(--red);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="header">
            <div class="title">Medieval Bear Tamagotchi</div>
            <div class="pets-count" id="pets-count">0</div>
        </div>
        
        <div class="pets-container" id="pets-container">
            <!-- –ü–∏—Ç–æ–º—Ü—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>
        
        <div class="actions-container">
            <div class="actions-title">–î–µ–π—Å—Ç–≤–∏—è</div>
            <div class="action-buttons">
                <button id="feed-btn">–ü–æ–∫–æ—Ä–º–∏—Ç—å</button>
                <button id="play-btn">–ü–æ–∏–≥—Ä–∞—Ç—å</button>
                <button id="train-btn">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                <button id="heal-btn">–õ–µ—á–∏—Ç—å</button>
                <button id="clean-btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
                <button id="new-pet-btn">–ù–æ–≤—ã–π –ø–∏—Ç–æ–º–µ—Ü</button>
            </div>
            
            <div class="action-progress" id="action-progress">
                <div class="action-name" id="action-name">–î–µ–π—Å—Ç–≤–∏–µ</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar">0%</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="evolution-notification" id="evolution-notification">
        <div class="evolution-text">–í–∞—à –ø–∏—Ç–æ–º–µ—Ü —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª!</div>
        <div class="evolution-emoji" id="evolution-emoji">üêª ‚Üí üêª‚Äç‚ùÑÔ∏è</div>
        <button class="evolution-button" id="evolution-button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        const gameState = {
            pets: [],
            selectedPetIndex: 0,
            lastUpdate: Date.now(),
            actionInProgress: false,
            actionProgress: 0,
            actionInterval: null,
            colors: ['#5e3a1f', '#8b5a2b', '#a52a2a', '#4b3621', '#654321', '#800020'],
            version: 1
        };
        
        // –í–∏–¥—ã –ø–∏—Ç–æ–º—Ü–µ–≤
        const speciesData = {
            'cub': {
                emoji: 'üêª',
                nextLevel: 3,
                nextSpecies: 'bear',
                stats: { health: 100, hunger: 50, energy: 80, happiness: 70 }
            },
            'bear': {
                emoji: 'üêª‚Äç‚ùÑÔ∏è',
                nextLevel: 6,
                nextSpecies: 'knight',
                stats: { health: 150, hunger: 60, energy: 90, happiness: 80 }
            },
            'knight': {
                emoji: 'üêª‚Äç‚öîÔ∏è',
                nextLevel: 9,
                nextSpecies: 'king',
                stats: { health: 200, hunger: 70, energy: 100, happiness: 90 }
            },
            'king': {
                emoji: 'üêª‚Äçüëë',
                nextLevel: 12,
                nextSpecies: 'wizard',
                stats: { health: 250, hunger: 80, energy: 110, happiness: 100 }
            },
            'wizard': {
                emoji: 'üêª‚Äçüßô',
                nextLevel: 15,
                nextSpecies: 'dragon',
                stats: { health: 300, hunger: 90, energy: 120, happiness: 110 }
            },
            'dragon': {
                emoji: 'üêª‚Äçüêâ',
                nextLevel: Infinity,
                nextSpecies: null,
                stats: { health: 400, hunger: 100, energy: 150, happiness: 120 }
            }
        };
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const elements = {
            petsContainer: document.getElementById('pets-container'),
            petsCount: document.getElementById('pets-count'),
            feedBtn: document.getElementById('feed-btn'),
            playBtn: document.getElementById('play-btn'),
            trainBtn: document.getElementById('train-btn'),
            healBtn: document.getElementById('heal-btn'),
            cleanBtn: document.getElementById('clean-btn'),
            newPetBtn: document.getElementById('new-pet-btn'),
            actionProgress: document.getElementById('action-progress'),
            actionName: document.getElementById('action-name'),
            progressBar: document.getElementById('progress-bar'),
            evolutionNotification: document.getElementById('evolution-notification'),
            evolutionEmoji: document.getElementById('evolution-emoji'),
            evolutionButton: document.getElementById('evolution-button')
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGame();
            setupEventListeners();
            renderPets();
            updateUI();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            setInterval(gameLoop, 1000);
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            elements.feedBtn.addEventListener('click', () => startAction('feed'));
            elements.playBtn.addEventListener('click', () => startAction('play'));
            elements.trainBtn.addEventListener('click', () => startAction('train'));
            elements.healBtn.addEventListener('click', () => startAction('heal'));
            elements.cleanBtn.addEventListener('click', () => startAction('clean'));
            elements.newPetBtn.addEventListener('click', addNewPet);
            
            // –ö–Ω–æ–ø–∫–∞ —ç–≤–æ–ª—é—Ü–∏–∏
            elements.evolutionButton.addEventListener('click', closeEvolutionNotification);
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (gameState.pets.length === 0) return;
            
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdate) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdate = now;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ—Ö –ø–∏—Ç–æ–º—Ü–µ–≤
            gameState.pets.forEach(pet => {
                updatePet(pet, deltaTime);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É
            saveGame();
            updateUI();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∏—Ç–æ–º—Ü–∞
        function updatePet(pet, deltaTime) {
            // –£–º–µ–Ω—å—à–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
            pet.hunger = Math.max(0, pet.hunger - 0.3 * deltaTime);
            pet.energy = Math.max(0, pet.energy - 0.2 * deltaTime);
            pet.happiness = Math.max(0, pet.happiness - 0.1 * deltaTime);
            
            // –ï—Å–ª–∏ –≥–æ–ª–æ–¥ –∏–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –Ω–∞ –Ω—É–ª–µ, —É–º–µ–Ω—å—à–∞–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
            if (pet.hunger <= 0 || pet.energy <= 0) {
                pet.health = Math.max(0, pet.health - 0.5 * deltaTime);
            }
            
            // –ï—Å–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ –Ω—É–ª–µ, —É–º–µ–Ω—å—à–∞–µ–º —Å—á–∞—Å—Ç—å–µ
            if (pet.health <= 0) {
                pet.happiness = Math.max(0, pet.happiness - 1 * deltaTime);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –ø–∏—Ç–æ–º–µ—Ü
            if (pet.health <= 0 && !pet.isDead) {
                pet.isDead = true;
                pet.deathTime = Date.now();
            }
            
            // –ï—Å–ª–∏ –ø–∏—Ç–æ–º–µ—Ü –º–µ—Ä—Ç–≤ –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç, —É–¥–∞–ª—è–µ–º –µ–≥–æ
            if (pet.isDead && now - pet.deathTime > 300000) {
                const index = gameState.pets.indexOf(pet);
                if (index !== -1) {
                    gameState.pets.splice(index, 1);
                    if (gameState.selectedPetIndex >= index) {
                        gameState.selectedPetIndex = Math.max(0, gameState.selectedPetIndex - 1);
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–≤–æ–ª—é—Ü–∏—é
            checkEvolution(pet);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–≤–æ–ª—é—Ü–∏–∏
        function checkEvolution(pet) {
            if (pet.isDead) return;
            
            const speciesInfo = speciesData[pet.species];
            if (pet.level >= speciesInfo.nextLevel && speciesInfo.nextSpecies) {
                // –≠–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ–º
                const oldEmoji = speciesInfo.emoji;
                pet.species = speciesInfo.nextSpecies;
                const newEmoji = speciesData[pet.species].emoji;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showEvolutionNotification(oldEmoji, newEmoji);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const newStats = speciesData[pet.species].stats;
                pet.health = newStats.health;
                pet.hunger = newStats.hunger;
                pet.energy = newStats.energy;
                pet.happiness = newStats.happiness;
            }
        }
        
        // –ù–∞—á–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
        function startAction(action) {
            if (gameState.actionInProgress || gameState.pets.length === 0) return;
            
            const pet = gameState.pets[gameState.selectedPetIndex];
            if (pet.isDead) return;
            
            gameState.actionInProgress = true;
            gameState.actionProgress = 0;
            gameState.currentAction = action;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            elements.actionProgress.style.display = 'block';
            elements.actionName.textContent = getActionName(action);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            gameState.actionInterval = setInterval(() => {
                gameState.actionProgress += 2;
                elements.progressBar.style.width = `${gameState.actionProgress}%`;
                elements.progressBar.textContent = `${gameState.actionProgress}%`;
                
                if (gameState.actionProgress >= 100) {
                    finishAction(action);
                }
            }, 50);
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
            disableButtons(true);
        }
        
        // –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
        function finishAction(action) {
            clearInterval(gameState.actionInterval);
            gameState.actionInProgress = false;
            elements.actionProgress.style.display = 'none';
            
            const pet = gameState.pets[gameState.selectedPetIndex];
            
            switch (action) {
                case 'feed':
                    pet.hunger = Math.min(100, pet.hunger + 30);
                    pet.energy = Math.min(100, pet.energy - 5);
                    pet.exp += 5;
                    animatePet('pulse');
                    break;
                case 'play':
                    pet.happiness = Math.min(100, pet.happiness + 20);
                    pet.energy = Math.min(100, pet.energy - 10);
                    pet.hunger = Math.max(0, pet.hunger - 5);
                    pet.exp += 10;
                    animatePet('bounce');
                    break;
                case 'train':
                    pet.energy = Math.max(0, pet.energy - 20);
                    pet.hunger = Math.max(0, pet.hunger - 15);
                    pet.exp += 20;
                    animatePet('shake');
                    break;
                case 'heal':
                    pet.health = Math.min(speciesData[pet.species].stats.health, pet.health + 30);
                    pet.energy = Math.max(0, pet.energy - 15);
                    pet.exp += 5;
                    animatePet('pulse');
                    break;
                case 'clean':
                    pet.happiness = Math.min(100, pet.happiness + 15);
                    pet.health = Math.min(speciesData[pet.species].stats.health, pet.health + 10);
                    pet.exp += 5;
                    animatePet('bounce');
                    break;
            }
            
            checkLevelUp(pet);
            updateUI();
            saveGame();
            disableButtons(false);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function checkLevelUp(pet) {
            const expNeeded = getExpForLevel(pet.level + 1);
            
            if (pet.exp >= expNeeded) {
                pet.level++;
                pet.exp -= expNeeded;
                
                // –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è 3, 6, 9 –∏ —Ç.–¥. –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
                if (pet.level % 3 === 0) {
                    addNewPet();
                }
            }
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
        function addNewPet() {
            if (gameState.pets.length >= 10) return;
            
            const color = gameState.colors[gameState.pets.length % gameState.colors.length];
            
            const newPet = {
                species: 'cub',
                level: 1,
                exp: 0,
                health: 100,
                hunger: 50,
                energy: 80,
                happiness: 70,
                isDead: false,
                color: color,
                birthTime: Date.now()
            };
            
            gameState.pets.push(newPet);
            gameState.selectedPetIndex = gameState.pets.length - 1;
            
            renderPets();
            updateUI();
            saveGame();
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∏—Ç–æ–º—Ü–∞
        function animatePet(animation) {
            const petElements = document.querySelectorAll('.pet-emoji');
            if (petElements.length > gameState.selectedPetIndex) {
                const petElement = petElements[gameState.selectedPetIndex];
                petElement.classList.add(animation);
                
                setTimeout(() => {
                    petElement.classList.remove(animation);
                }, 1000);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç–≤–æ–ª—é—Ü–∏–∏
        function showEvolutionNotification(oldEmoji, newEmoji) {
            elements.evolutionEmoji.textContent = `${oldEmoji} ‚Üí ${newEmoji}`;
            elements.evolutionNotification.style.display = 'block';
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç–≤–æ–ª—é—Ü–∏–∏
        function closeEvolutionNotification() {
            elements.evolutionNotification.style.display = 'none';
            renderPets();
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
        function getActionName(action) {
            const names = {
                'feed': '–ö–æ—Ä–º–ª–µ–Ω–∏–µ',
                'play': '–ò–≥—Ä–∞',
                'train': '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
                'heal': '–õ–µ—á–µ–Ω–∏–µ',
                'clean': '–û—á–∏—Å—Ç–∫–∞'
            };
            return names[action] || '–î–µ–π—Å—Ç–≤–∏–µ';
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω—è
        function getExpForLevel(level) {
            return 100 * Math.pow(level, 1.5);
        }
        
        // –û—Ç–∫–ª—é—á–∏—Ç—å/–≤–∫–ª—é—á–∏—Ç—å –∫–Ω–æ–ø–∫–∏
        function disableButtons(disabled) {
            elements.feedBtn.disabled = disabled;
            elements.playBtn.disabled = disabled;
            elements.trainBtn.disabled = disabled;
            elements.healBtn.disabled = disabled;
            elements.cleanBtn.disabled = disabled;
            elements.newPetBtn.disabled = disabled || gameState.pets.length >= 10;
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–∏—Ç–æ–º—Ü–µ–≤
        function renderPets() {
            elements.petsContainer.innerHTML = '';
            
            gameState.pets.forEach((pet, index) => {
                const petElement = document.createElement('div');
                petElement.className = 'pet';
                petElement.style.opacity = pet.isDead ? '0.6' : '1';
                
                const speciesInfo = speciesData[pet.species];
                
                petElement.innerHTML = `
                    <div class="pet-emoji" style="color: ${pet.color}">${speciesInfo.emoji}</div>
                    <div class="pet-level">${pet.level}</div>
                    <div class="pet-health">
                        <div class="pet-health-bar" style="width: ${(pet.health / speciesInfo.stats.health) * 100}%"></div>
                    </div>
                `;
                
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
                if (index === gameState.selectedPetIndex) {
                    petElement.style.border = `2px solid ${pet.color}`;
                    petElement.style.borderRadius = '10px';
                    petElement.style.padding = '5px';
                }
                
                petElement.addEventListener('click', () => {
                    gameState.selectedPetIndex = index;
                    renderPets();
                    updateUI();
                });
                
                elements.petsContainer.appendChild(petElement);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏—Ç–æ–º—Ü–µ–≤
            elements.petsCount.textContent = gameState.pets.length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            if (gameState.pets.length > 0) {
                const pet = gameState.pets[gameState.selectedPetIndex];
                disableButtons(pet.isDead || gameState.actionInProgress);
            } else {
                disableButtons(true);
            }
            
            elements.newPetBtn.disabled = gameState.pets.length >= 10 || gameState.actionInProgress;
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        function saveGame() {
            localStorage.setItem('medievalBearTamagotchi', JSON.stringify(gameState));
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
        function loadGame() {
            const savedGame = localStorage.getItem('medievalBearTamagotchi');
            if (savedGame) {
                const parsed = JSON.parse(savedGame);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                if (parsed.version === gameState.version) {
                    Object.assign(gameState, parsed);
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã, –¥–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
            if (gameState.pets.length === 0) {
                addNewPet();
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>