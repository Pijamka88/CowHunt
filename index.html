<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Cow Hunt</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #0a0a2a, #1a1a4a);
            font-family: 'Arial', sans-serif;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }
        
        #gameCanvas {
            display: block;
            background: radial-gradient(circle at center, #0a0a2a 0%, #000015 100%);
            position: absolute;
            top: 0;
            left: 0;
        }
        
        #uiContainer {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #aaccff;
            text-shadow: 0 0 5px #3366ff;
            font-size: 18px;
            pointer-events: none;
        }
        
        #score, #ammo, #level {
            margin-bottom: 5px;
        }
        
        #startScreen, #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 40, 0.8);
            color: #aaccff;
            text-align: center;
        }
        
        #gameOverScreen {
            display: none;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #3366ff, 0 0 20px #4488ff;
            color: #88aaff;
        }
        
        button {
            background: linear-gradient(135deg, #3366ff, #2244cc);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 10px;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(51, 102, 255, 0.5);
            transition: all 0.3s;
        }
        
        button:hover {
            background: linear-gradient(135deg, #4488ff, #3366ee);
            box-shadow: 0 0 15px rgba(51, 102, 255, 0.8);
        }
        
        .instructions {
            margin: 20px;
            max-width: 80%;
            line-height: 1.5;
        }
        
        .crosshair {
            position: absolute;
            width: 30px;
            height: 30px;
            pointer-events: none;
            transform: translate(-50%, -50%);
            display: none;
        }
        
        .crosshair::before, .crosshair::after {
            content: '';
            position: absolute;
            background-color: rgba(170, 204, 255, 0.8);
        }
        
        .crosshair::before {
            width: 4px;
            height: 20px;
            left: 13px;
            top: 5px;
        }
        
        .crosshair::after {
            width: 20px;
            height: 4px;
            left: 5px;
            top: 13px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="uiContainer">
        <div id="score">Score: 0</div>
        <div id="ammo">Ammo: 10</div>
        <div id="level">Level: 1</div>
    </div>
    
    <div id="startScreen">
        <h1>Cosmic Cow Hunt</h1>
        <div class="instructions">
            Shoot the cosmic cows flying across the screen!<br>
            Be careful - you have limited ammo.<br>
            Hit cows to get points and more ammo.<br>
            Complete each level by reaching the target score.
        </div>
        <button id="startButton">Start Game</button>
    </div>
    
    <div id="gameOverScreen">
        <h1>Game Over</h1>
        <div id="finalScore">Your score: 0</div>
        <div id="finalLevel">Level reached: 1</div>
        <button id="restartButton">Play Again</button>
    </div>
    
    <div class="crosshair" id="crosshair"></div>
    
    <script>
        // Game variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const ammoElement = document.getElementById('ammo');
        const levelElement = document.getElementById('level');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreElement = document.getElementById('finalScore');
        const finalLevelElement = document.getElementById('finalLevel');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const crosshair = document.getElementById('crosshair');
        
        // Resize canvas to full window
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // Game state
        let gameState = {
            score: 0,
            ammo: 10,
            level: 1,
            targetScore: 100,
            cows: [],
            lastCowTime: 0,
            cowInterval: 2000,
            gameActive: false,
            animationId: null,
            backgroundStars: [],
            explosions: []
        };
        
        // Generate stars for background
        function generateStars() {
            gameState.backgroundStars = [];
            for (let i = 0; i < 100; i++) {
                gameState.backgroundStars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2 + 1,
                    alpha: Math.random() * 0.5 + 0.5
                });
            }
        }
        
        // Cow class
        class Cow {
            constructor() {
                this.width = 60;
                this.height = 40;
                this.speed = Math.random() * 3 + 1 + gameState.level * 0.5;
                this.angle = 0;
                this.rotationSpeed = (Math.random() - 0.5) * 0.05;
                
                // Determine spawn side (0: top, 1: right, 2: bottom, 3: left)
                const spawnSide = Math.floor(Math.random() * 4);
                
                if (spawnSide === 0) { // Top
                    this.x = Math.random() * (canvas.width - this.width);
                    this.y = -this.height;
                    this.direction = Math.random() * Math.PI * 0.6 + Math.PI * 0.2;
                } else if (spawnSide === 1) { // Right
                    this.x = canvas.width;
                    this.y = Math.random() * (canvas.height - this.height);
                    this.direction = Math.random() * Math.PI * 0.6 + Math.PI * 0.7;
                } else if (spawnSide === 2) { // Bottom
                    this.x = Math.random() * (canvas.width - this.width);
                    this.y = canvas.height;
                    this.direction = Math.random() * Math.PI * 0.6 + Math.PI * 1.2;
                } else { // Left
                    this.x = -this.width;
                    this.y = Math.random() * (canvas.height - this.height);
                    this.direction = Math.random() * Math.PI * 0.6 - Math.PI * 0.2;
                }
                
                this.health = 1;
                this.points = 10 + Math.floor(Math.random() * 10);
                this.color = `hsl(${Math.random() * 60 + 200}, 70%, 60%)`;
                this.antennaAngle = 0;
                this.antennaDirection = 1;
            }
            
            update() {
                this.x += Math.cos(this.direction) * this.speed;
                this.y += Math.sin(this.direction) * this.speed;
                this.angle += this.rotationSpeed;
                this.antennaAngle += 0.1 * this.antennaDirection;
                if (Math.abs(this.antennaAngle) > 0.5) {
                    this.antennaDirection *= -1;
                }
                
                // Check if cow is out of bounds
                return this.x < -this.width * 2 || this.x > canvas.width + this.width * 2 ||
                       this.y < -this.height * 2 || this.y > canvas.height + this.height * 2;
            }
            
            draw(ctx) {
                ctx.save();
                ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
                ctx.rotate(this.angle);
                
                // Cow body
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.ellipse(0, 0, this.width / 2, this.height / 2, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Cow head
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.ellipse(this.width / 4, 0, this.width / 4, this.height / 3, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Cow spots
                ctx.fillStyle = 'rgba(30, 30, 70, 0.7)';
                ctx.beginPath();
                ctx.ellipse(-this.width / 6, -this.height / 6, this.width / 8, this.height / 8, 0, 0, Math.PI * 2);
                ctx.ellipse(this.width / 6, this.height / 6, this.width / 6, this.height / 10, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Cow eyes
                ctx.fillStyle = '#88ffaa';
                ctx.beginPath();
                ctx.arc(this.width / 4 + this.width / 8, -this.height / 10, this.height / 10, 0, Math.PI * 2);
                ctx.fill();
                
                // Cow pupil
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(this.width / 4 + this.width / 8, -this.height / 10, this.height / 20, 0, Math.PI * 2);
                ctx.fill();
                
                // Antenna with orb
                ctx.strokeStyle = '#88aaff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(this.width / 4, -this.height / 4);
                ctx.lineTo(this.width / 4 + Math.cos(this.antennaAngle) * this.width / 6, 
                          -this.height / 3 + Math.sin(this.antennaAngle) * this.height / 6);
                ctx.stroke();
                
                ctx.fillStyle = '#4488ff';
                ctx.beginPath();
                ctx.arc(this.width / 4 + Math.cos(this.antennaAngle) * this.width / 6, 
                       -this.height / 3 + Math.sin(this.antennaAngle) * this.height / 6, 
                       this.height / 12, 0, Math.PI * 2);
                ctx.fill();
                
                // Cow legs
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 4;
                for (let i = 0; i < 4; i++) {
                    const legX = -this.width / 3 + (i % 2) * this.width / 1.5;
                    const legY = this.height / 4 + Math.floor(i / 2) * this.height / 4;
                    ctx.beginPath();
                    ctx.moveTo(legX, legY);
                    ctx.lineTo(legX, legY + this.height / 3);
                    ctx.stroke();
                }
                
                ctx.restore();
            }
            
            isHit(x, y) {
                // Simple ellipse collision detection
                const centerX = this.x + this.width / 2;
                const centerY = this.y + this.height / 2;
                const distance = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
                return distance < Math.max(this.width / 2, this.height / 2);
            }
        }
        
        // Explosion class
        class Explosion {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.particles = [];
                this.color = color;
                
                // Create particles
                for (let i = 0; i < 20; i++) {
                    this.particles.push({
                        x: 0,
                        y: 0,
                        size: Math.random() * 5 + 2,
                        speed: Math.random() * 3 + 1,
                        angle: Math.random() * Math.PI * 2,
                        life: 1,
                        decay: Math.random() * 0.02 + 0.01
                    });
                }
            }
            
            update() {
                for (let particle of this.particles) {
                    particle.x += Math.cos(particle.angle) * particle.speed;
                    particle.y += Math.sin(particle.angle) * particle.speed;
                    particle.life -= particle.decay;
                }
                
                return this.particles.every(p => p.life <= 0);
            }
            
            draw(ctx) {
                for (let particle of this.particles) {
                    if (particle.life > 0) {
                        ctx.globalAlpha = particle.life;
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.arc(
                            this.x + particle.x,
                            this.y + particle.y,
                            particle.size * particle.life,
                            0,
                            Math.PI * 2
                        );
                        ctx.fill();
                    }
                }
                ctx.globalAlpha = 1;
            }
        }
        
        // Update game state
        function update() {
            const currentTime = Date.now();
            
            // Spawn new cows
            if (currentTime - gameState.lastCowTime > gameState.cowInterval && gameState.cows.length < 5 + gameState.level) {
                gameState.cows.push(new Cow());
                gameState.lastCowTime = currentTime;
                // Decrease interval slightly as level increases (but not below 500ms)
                gameState.cowInterval = Math.max(500, 2000 - gameState.level * 100);
            }
            
            // Update cows
            gameState.cows = gameState.cows.filter(cow => {
                const isOutOfBounds = cow.update();
                return !isOutOfBounds;
            });
            
            // Update explosions
            gameState.explosions = gameState.explosions.filter(explosion => {
                const isFinished = explosion.update();
                return !isFinished;
            });
            
            // Check level completion
            if (gameState.score >= gameState.targetScore) {
                nextLevel();
            }
        }
        
        // Draw everything
        function draw() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw stars
            ctx.fillStyle = 'white';
            for (let star of gameState.backgroundStars) {
                ctx.globalAlpha = star.alpha;
                ctx.fillRect(star.x, star.y, star.size, star.size);
            }
            ctx.globalAlpha = 1;
            
            // Draw cows
            for (let cow of gameState.cows) {
                cow.draw(ctx);
            }
            
            // Draw explosions
            for (let explosion of gameState.explosions) {
                explosion.draw(ctx);
            }
            
            // Draw crosshair if game is active
            if (gameState.gameActive) {
                crosshair.style.display = 'block';
            }
        }
        
        // Game loop
        function gameLoop() {
            if (gameState.gameActive) {
                update();
                draw();
                gameState.animationId = requestAnimationFrame(gameLoop);
            }
        }
        
        // Handle mouse click (shooting)
        function handleShoot(e) {
            if (!gameState.gameActive || gameState.ammo <= 0) return;
            
            let clientX, clientY;
            
            if (e.type === 'touchstart') {
                e.preventDefault();
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            // Use ammo
            gameState.ammo--;
            ammoElement.textContent = `Ammo: ${gameState.ammo}`;
            
            // Check for hits
            let hit = false;
            for (let i = 0; i < gameState.cows.length; i++) {
                const cow = gameState.cows[i];
                if (cow.isHit(clientX, clientY)) {
                    // Cow hit!
                    gameState.score += cow.points;
                    scoreElement.textContent = `Score: ${gameState.score}`;
                    
                    // Add explosion
                    gameState.explosions.push(new Explosion(
                        cow.x + cow.width / 2,
                        cow.y + cow.height / 2,
                        cow.color
                    ));
                    
                    // Remove cow
                    gameState.cows.splice(i, 1);
                    
                    // Add ammo (chance based)
                    if (Math.random() < 0.5) {
                        gameState.ammo += 1 + Math.floor(Math.random() * 2);
                        ammoElement.textContent = `Ammo: ${gameState.ammo}`;
                    }
                    
                    hit = true;
                    break;
                }
            }
            
            // If missed all cows and no ammo left, game over
            if (!hit && gameState.ammo <= 0) {
                gameOver();
            }
        }
        
        // Update crosshair position
        function updateCrosshair(e) {
            let clientX, clientY;
            
            if (e.type === 'mousemove') {
                clientX = e.clientX;
                clientY = e.clientY;
            } else if (e.type === 'touchmove') {
                e.preventDefault();
                if (e.touches.length > 0) {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                }
            }
            
            if (clientX !== undefined && clientY !== undefined) {
                crosshair.style.left = `${clientX}px`;
                crosshair.style.top = `${clientY}px`;
            }
        }
        
        // Start new game
        function startGame() {
            gameState = {
                score: 0,
                ammo: 10,
                level: 1,
                targetScore: 100,
                cows: [],
                lastCowTime: Date.now(),
                cowInterval: 2000,
                gameActive: true,
                animationId: null,
                backgroundStars: gameState.backgroundStars,
                explosions: []
            };
            
            if (gameState.backgroundStars.length === 0) {
                generateStars();
            }
            
            scoreElement.textContent = `Score: ${gameState.score}`;
            ammoElement.textContent = `Ammo: ${gameState.ammo}`;
            levelElement.textContent = `Level: ${gameState.level}`;
            
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            gameLoop();
        }
        
        // Go to next level
        function nextLevel() {
            gameState.level++;
            gameState.targetScore = gameState.level * 100;
            gameState.ammo = 10 + gameState.level * 2;
            
            levelElement.textContent = `Level: ${gameState.level}`;
            ammoElement.textContent = `Ammo: ${gameState.ammo}`;
            
            // Clear existing cows
            gameState.cows = [];
        }
        
        // End game
        function gameOver() {
            gameState.gameActive = false;
            cancelAnimationFrame(gameState.animationId);
            
            finalScoreElement.textContent = `Your score: ${gameState.score}`;
            finalLevelElement.textContent = `Level reached: ${gameState.level}`;
            gameOverScreen.style.display = 'flex';
            crosshair.style.display = 'none';
        }
        
        // Event listeners
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        
        canvas.addEventListener('click', handleShoot);
        canvas.addEventListener('touchstart', handleShoot, { passive: false });
        
        document.addEventListener('mousemove', updateCrosshair);
        document.addEventListener('touchmove', updateCrosshair, { passive: false });
        
        // Initialize
        generateStars();
        
        // Telegram Web App support
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.expand();
            Telegram.WebApp.enableClosingConfirmation();
            
            // Adjust UI for Telegram viewport
            const viewportHeight = window.innerHeight;
            const viewportWidth = window.innerWidth;
            
            // You can add Telegram-specific adjustments here if needed
        }
    </script>
</body>
</html>