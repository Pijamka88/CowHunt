<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Cow Hunt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #00172D 0%, #003366 100%);
            font-family: 'Arial', sans-serif;
            color: white;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }
        
        #gameCanvas {
            display: block;
            background: radial-gradient(ellipse at center, #002244 0%, #000511 100%);
        }
        
        #startScreen, #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 20, 40, 0.8);
            z-index: 10;
        }
        
        #gameOverScreen {
            display: none;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #4FC3F7;
            color: #B3E5FC;
        }
        
        button {
            background: linear-gradient(180deg, #0288D1 0%, #01579B 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            font-size: 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }
        
        button:hover {
            background: linear-gradient(180deg, #039BE5 0%, #0277BD 100%);
            transform: scale(1.05);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        #scoreDisplay, #ammoDisplay, #highScoreDisplay {
            position: absolute;
            font-size: 1.2rem;
            color: #B3E5FC;
            text-shadow: 0 0 5px #4FC3F7;
            z-index: 5;
        }
        
        #scoreDisplay {
            top: 10px;
            left: 10px;
        }
        
        #ammoDisplay {
            top: 10px;
            right: 10px;
        }
        
        #highScoreDisplay {
            top: 40px;
            left: 10px;
        }
        
        #controlsInfo {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 0.8rem;
            color: #81D4FA;
            text-align: center;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="scoreDisplay">Score: 0</div>
    <div id="ammoDisplay">Ammo: 10</div>
    <div id="highScoreDisplay">High Score: 0</div>
    
    <div id="startScreen">
        <h1>Cosmic Cow Hunt</h1>
        <p>Shoot cows in spacesuits before they escape!</p>
        <button id="startButton">Start Game</button>
    </div>
    
    <div id="gameOverScreen">
        <h1>Game Over</h1>
        <p id="finalScore">Your score: 0</p>
        <button id="restartButton">Play Again</button>
    </div>
    
    <canvas id="gameCanvas"></canvas>
    
    <div id="controlsInfo">Tap to shoot | Move with mouse/touch</div>
    
    <script>
        // Initialize Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // Game variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const ammoDisplay = document.getElementById('ammoDisplay');
        const highScoreDisplay = document.getElementById('highScoreDisplay');
        const finalScore = document.getElementById('finalScore');
        
        // Game state
        let score = 0;
        let ammo = 10;
        let highScore = localStorage.getItem('cosmicCowHighScore') || 0;
        let gameRunning = false;
        let animationId;
        let lastTime = 0;
        let gameTime = 0;
        let cowSpawnTimer = 0;
        let ammoSpawnTimer = 0;
        
        // Set canvas size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // Player
        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: 20,
            color: '#4FC3F7',
            speed: 5,
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.closePath();
                
                // Draw crosshair
                ctx.beginPath();
                ctx.moveTo(this.x, this.y - 15);
                ctx.lineTo(this.x, this.y + 15);
                ctx.moveTo(this.x - 15, this.y);
                ctx.lineTo(this.x + 15, this.y);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.closePath();
            }
        };
        
        // Bullets
        const bullets = [];
        
        class Bullet {
            constructor(x, y, angle) {
                this.x = x;
                this.y = y;
                this.angle = angle;
                this.speed = 10;
                this.radius = 3;
                this.color = '#FFEB3B';
                this.distance = 0;
                this.maxDistance = 300;
            }
            
            update() {
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;
                this.distance += this.speed;
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.closePath();
                
                // Add glow effect
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius + 3, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 235, 59, 0.3)';
                ctx.fill();
                ctx.closePath();
            }
        }
        
        // Cows
        const cows = [];
        
        class Cow {
            constructor() {
                this.radius = 30;
                this.color = '#F5F5F5';
                this.scale = 0.5 + Math.random() * 0.5;
                this.health = 1;
                
                // Random spawn from edges
                const edge = Math.floor(Math.random() * 4);
                switch (edge) {
                    case 0: // top
                        this.x = Math.random() * canvas.width;
                        this.y = -this.radius;
                        break;
                    case 1: // right
                        this.x = canvas.width + this.radius;
                        this.y = Math.random() * canvas.height;
                        break;
                    case 2: // bottom
                        this.x = Math.random() * canvas.width;
                        this.y = canvas.height + this.radius;
                        break;
                    case 3: // left
                        this.x = -this.radius;
                        this.y = Math.random() * canvas.height;
                        break;
                }
                
                // Target point (opposite side)
                this.targetX = canvas.width / 2 + (Math.random() - 0.5) * canvas.width * 0.5;
                this.targetY = canvas.height / 2 + (Math.random() - 0.5) * canvas.height * 0.5;
                
                // Calculate direction
                const dx = this.targetX - this.x;
                const dy = this.targetY - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                this.speedX = (dx / distance) * (2 + Math.random() * 2);
                this.speedY = (dy / distance) * (2 + Math.random() * 2);
                
                // Animation variables
                this.legAngle = 0;
                this.legDirection = 1;
                this.animationSpeed = 2 + Math.random() * 2;
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                
                // Animate legs
                this.legAngle += this.legDirection * this.animationSpeed;
                if (Math.abs(this.legAngle) > 15) {
                    this.legDirection *= -1;
                }
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.scale, this.scale);
                
                // Body
                ctx.beginPath();
                ctx.ellipse(0, 0, 30, 20, 0, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = '#BDBDBD';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Helmet (glass part)
                ctx.beginPath();
                ctx.arc(0, -10, 20, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(179, 229, 252, 0.5)';
                ctx.fill();
                ctx.strokeStyle = '#E1F5FE';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Helmet rim
                ctx.beginPath();
                ctx.arc(0, -10, 20, Math.PI * 0.8, Math.PI * 2.2);
                ctx.strokeStyle = '#B3E5FC';
                ctx.lineWidth = 5;
                ctx.stroke();
                
                // Legs
                for (let i = -1; i <= 1; i += 2) {
                    ctx.save();
                    ctx.translate(i * 15, 15);
                    ctx.rotate(this.legAngle * Math.PI / 180);
                    
                    // Leg
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.lineTo(0, 25);
                    ctx.strokeStyle = '#BDBDBD';
                    ctx.lineWidth = 8;
                    ctx.stroke();
                    
                    // Hoof
                    ctx.beginPath();
                    ctx.arc(0, 30, 5, 0, Math.PI * 2);
                    ctx.fillStyle = '#616161';
                    ctx.fill();
                    ctx.restore();
                }
                
                // Head
                ctx.beginPath();
                ctx.ellipse(0, -15, 15, 12, 0, 0, Math.PI * 2);
                ctx.fillStyle = '#F5F5F5';
                ctx.fill();
                ctx.strokeStyle = '#BDBDBD';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Eyes
                for (let i = -1; i <= 1; i += 2) {
                    ctx.beginPath();
                    ctx.arc(i * 5, -18, 3, 0, Math.PI * 2);
                    ctx.fillStyle = '#212121';
                    ctx.fill();
                }
                
                // Nose
                ctx.beginPath();
                ctx.arc(0, -12, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#E57373';
                ctx.fill();
                
                // Health bar
                if (this.health < 1) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(-20, -40, 40, 5);
                    ctx.fillStyle = this.health > 0.5 ? '#4CAF50' : '#FF5722';
                    ctx.fillRect(-20, -40, 40 * this.health, 5);
                }
                
                ctx.restore();
            }
            
            isOutOfBounds() {
                return this.x < -this.radius * 2 || 
                       this.x > canvas.width + this.radius * 2 || 
                       this.y < -this.radius * 2 || 
                       this.y > canvas.height + this.radius * 2;
            }
        }
        
        // Ammo packs
        const ammoPacks = [];
        
        class AmmoPack {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 15;
                this.amount = 5;
                this.color = '#4CAF50';
                this.pulse = 0;
                this.pulseDirection = 1;
            }
            
            update() {
                // Pulsing animation
                this.pulse += this.pulseDirection * 0.05;
                if (this.pulse > 0.5 || this.pulse < 0) {
                    this.pulseDirection *= -1;
                }
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                // Outer circle with pulse effect
                ctx.beginPath();
                ctx.arc(0, 0, this.radius + this.pulse * 5, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(76, 175, 80, 0.3)';
                ctx.fill();
                
                // Main circle
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                
                // Plus sign
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(-5, 0);
                ctx.lineTo(5, 0);
                ctx.moveTo(0, -5);
                ctx.lineTo(0, 5);
                ctx.stroke();
                
                // Ammo count
                ctx.fillStyle = 'white';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.amount.toString(), 0, 0);
                
                ctx.restore();
            }
        }
        
        // Explosion effects
        const explosions = [];
        
        class Explosion {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.particles = [];
                this.color = color;
                
                // Create particles
                for (let i = 0; i < 20; i++) {
                    this.particles.push({
                        x: this.x,
                        y: this.y,
                        radius: 1 + Math.random() * 3,
                        color: this.color,
                        speedX: (Math.random() - 0.5) * 5,
                        speedY: (Math.random() - 0.5) * 5,
                        life: 30 + Math.random() * 20,
                        opacity: 1
                    });
                }
            }
            
            update() {
                for (let i = 0; i < this.particles.length; i++) {
                    const p = this.particles[i];
                    p.x += p.speedX;
                    p.y += p.speedY;
                    p.life--;
                    p.opacity = p.life / 50;
                    
                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                        i--;
                    }
                }
                
                return this.particles.length === 0;
            }
            
            draw() {
                for (const p of this.particles) {
                    ctx.globalAlpha = p.opacity;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                }
                ctx.globalAlpha = 1;
            }
        }
        
        // Game functions
        function spawnCow() {
            cows.push(new Cow());
        }
        
        function spawnAmmoPack() {
            const x = 50 + Math.random() * (canvas.width - 100);
            const y = 50 + Math.random() * (canvas.height - 100);
            ammoPacks.push(new AmmoPack(x, y));
        }
        
        function shootBullet() {
            if (ammo <= 0) return;
            
            const angle = Math.atan2(
                player.y - lastMouseY,
                player.x - lastMouseX
            ) + Math.PI;
            
            bullets.push(new Bullet(player.x, player.y, angle));
            ammo--;
            ammoDisplay.textContent = `Ammo: ${ammo}`;
            
            // Play shooting sound (Telegram Web Apps don't support audio)
        }
        
        function checkCollisions() {
            // Bullets and cows
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                // Remove bullets that are too far
                if (bullet.distance > bullet.maxDistance) {
                    bullets.splice(i, 1);
                    continue;
                }
                
                // Check collision with cows
                for (let j = cows.length - 1; j >= 0; j--) {
                    const cow = cows[j];
                    const dx = bullet.x - cow.x;
                    const dy = bullet.y - cow.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < bullet.radius + cow.radius * cow.scale) {
                        // Hit!
                        cow.health -= 0.25;
                        
                        // Create explosion
                        explosions.push(new Explosion(bullet.x, bullet.y, '#FFEB3B'));
                        
                        // Remove bullet
                        bullets.splice(i, 1);
                        
                        // Check if cow is dead
                        if (cow.health <= 0) {
                            // Add score
                            score += 10;
                            scoreDisplay.textContent = `Score: ${score}`;
                            
                            // Create bigger explosion
                            explosions.push(new Explosion(cow.x, cow.y, '#F5F5F5'));
                            
                            // Remove cow
                            cows.splice(j, 1);
                            
                            // Chance to spawn ammo pack
                            if (Math.random() < 0.3) {
                                spawnAmmoPack();
                            }
                        }
                        
                        break;
                    }
                }
            }
            
            // Player and ammo packs
            for (let i = ammoPacks.length - 1; i >= 0; i--) {
                const pack = ammoPacks[i];
                const dx = player.x - pack.x;
                const dy = player.y - pack.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < player.radius + pack.radius) {
                    // Collect ammo
                    ammo += pack.amount;
                    ammoDisplay.textContent = `Ammo: ${ammo}`;
                    
                    // Create green explosion
                    explosions.push(new Explosion(pack.x, pack.y, '#4CAF50'));
                    
                    // Remove ammo pack
                    ammoPacks.splice(i, 1);
                }
            }
            
            // Cows escaping
            for (let i = cows.length - 1; i >= 0; i--) {
                if (cows[i].isOutOfBounds()) {
                    cows.splice(i, 1);
                    score = Math.max(0, score - 5);
                    scoreDisplay.textContent = `Score: ${score}`;
                }
            }
        }
        
        function gameOver() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            
            // Update high score
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('cosmicCowHighScore', highScore);
                highScoreDisplay.textContent = `High Score: ${highScore}`;
            }
            
            // Show game over screen
            finalScore.textContent = `Your score: ${score}`;
            gameOverScreen.style.display = 'flex';
        }
        
        // Mouse/touch handling
        let lastMouseX = canvas.width / 2;
        let lastMouseY = canvas.height / 2;
        
        canvas.addEventListener('mousemove', (e) => {
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            lastMouseX = touch.clientX;
            lastMouseY = touch.clientY;
        }, { passive: false });
        
        canvas.addEventListener('click', (e) => {
            if (gameRunning) {
                shootBullet();
            }
        });
        
        canvas.addEventListener('touchend', (e) => {
            if (gameRunning) {
                shootBullet();
            }
        });
        
        // Button handlers
        startButton.addEventListener('click', () => {
            startScreen.style.display = 'none';
            startGame();
        });
        
        restartButton.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            startGame();
        });
        
        // Start game
        function startGame() {
            // Reset game state
            score = 0;
            ammo = 10;
            gameTime = 0;
            cowSpawnTimer = 0;
            ammoSpawnTimer = 0;
            
            // Clear arrays
            cows.length = 0;
            bullets.length = 0;
            ammoPacks.length = 0;
            explosions.length = 0;
            
            // Update displays
            scoreDisplay.textContent = `Score: ${score}`;
            ammoDisplay.textContent = `Ammo: ${ammo}`;
            highScoreDisplay.textContent = `High Score: ${highScore}`;
            
            // Set player position
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
            
            // Start game loop
            gameRunning = true;
            lastTime = performance.now();
            gameLoop();
        }
        
        // Main game loop
        function gameLoop(timestamp) {
            if (!gameRunning) return;
            
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            gameTime += deltaTime;
            
            // Spawn cows periodically
            cowSpawnTimer += deltaTime;
            if (cowSpawnTimer > 1000) {
                cowSpawnTimer = 0;
                if (Math.random() < 0.7) {
                    spawnCow();
                }
            }
            
            // Spawn ammo packs less frequently
            ammoSpawnTimer += deltaTime;
            if (ammoSpawnTimer > 5000 && ammoPacks.length < 3) {
                ammoSpawnTimer = 0;
                if (Math.random() < 0.5) {
                    spawnAmmoPack();
                }
            }
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw stars background
            drawStars();
            
            // Update and draw player
            player.x = lastMouseX;
            player.y = lastMouseY;
            player.draw();
            
            // Update and draw bullets
            for (const bullet of bullets) {
                bullet.update();
                bullet.draw();
            }
            
            // Update and draw cows
            for (const cow of cows) {
                cow.update();
                cow.draw();
            }
            
            // Update and draw ammo packs
            for (const pack of ammoPacks) {
                pack.update();
                pack.draw();
            }
            
            // Update and draw explosions
            for (let i = explosions.length - 1; i >= 0; i--) {
                if (explosions[i].update()) {
                    explosions.splice(i, 1);
                } else {
                    explosions[i].draw();
                }
            }
            
            // Check collisions
            checkCollisions();
            
            // Game over if out of ammo and no ammo packs left
            if (ammo <= 0 && ammoPacks.length === 0 && bullets.length === 0) {
                gameOver();
            }
            
            animationId = requestAnimationFrame(gameLoop);
        }
        
        // Draw starfield background
        const stars = [];
        for (let i = 0; i < 200; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 1.5,
                alpha: 0.1 + Math.random() * 0.9,
                speed: 0.1 + Math.random() * 0.5
            });
        }
        
        function drawStars() {
            for (const star of stars) {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(179, 229, 252, ${star.alpha})`;
                ctx.fill();
                
                // Move stars for parallax effect
                star.x -= star.speed;
                if (star.x < -10) {
                    star.x = canvas.width + 10;
                    star.y = Math.random() * canvas.height;
                }
            }
        }
        
        // Initialize high score display
        highScoreDisplay.textContent = `High Score: ${highScore}`;
    </script>
</body>
</html>