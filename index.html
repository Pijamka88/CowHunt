<!DOCTYPE html>
<html>
<head>
    <title>Cosmic Cow Hunt</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            touch-action: none;
            font-family: 'Arial', sans-serif;
            color: white;
        }

        #gameCanvas {
            cursor: none;
        }

        .screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(25, 25, 55, 0.95);
            padding: 2rem;
            border-radius: 15px;
            border: 2px solid #6c5ce7;
            min-width: 300px;
            display: none;
        }

        button {
            padding: 12px 25px;
            font-size: 18px;
            background: #6c5ce7;
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }

        button:hover {
            background: #a8a5e6;
            transform: scale(1.05);
        }

        #hud {
            position: fixed;
            width: 100%;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.5);
        }

        #ammoBar {
            position: fixed;
            bottom: 0;
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .heart {
            color: #ff4757;
            font-size: 24px;
        }

        #cursor {
            position: absolute;
            pointer-events: none;
            font-weight: bold;
            text-shadow: 0 0 5px #6c5ce7;
            transition: transform 0.1s;
        }

        .cow {
            position: absolute;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="hud">
        <div>Score: <span id="score">0</span></div>
        <div>Time: <span id="time">60</span></div>
        <div>Lives: <span id="lives">üíñüíñüíñ</span></div>
    </div>

    <div id="ammoBar">
        <div>Ammo: <span id="ammo">5</span></div>
        <div>Hits: <span id="hits">0</span></div>
        <div>Miss: <span id="miss">0</span></div>
    </div>

    <div id="cursor">‚ú®</div>

    <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
    <div id="mainMenu" class="screen">
        <h1>üõ∏ Cosmic Cow Hunt üêÑ</h1>
        <button onclick="showScreen('game')">Start Game</button>
        <button onclick="showScreen('howToPlay')">How to Play</button>
        <button onclick="showScreen('leaderboard')">High Scores</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω How to Play -->
    <div id="howToPlay" class="screen">
        <h2>How to Play</h2>
        <p>üî´ Shoot flying cows in 60 seconds!</p>
        <p>üéØ 5 bullets before reload</p>
        <p>üí• 3 lives maximum</p>
        <p>üöÄ Different cow types give various points</p>
        <button onclick="showScreen('mainMenu')">Back</button>
    </div>

    <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ -->
    <div id="leaderboard" class="screen">
        <h2>Top 5 Pilots</h2>
        <ol id="highScoresList"></ol>
        <button onclick="showScreen('mainMenu')">Back</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameActive = false;
        let cows = [];
        let bullets = 5;
        let score = 0;
        let hits = 0;
        let miss = 0;
        let lives = 3;
        let reloading = false;
        let animationId;
        let gameTime = 60;

        const config = {
            SPAWN_RATE: 1000,
            MAX_BULLETS: 5,
            RELOAD_TIME: 2000,
            COW_TYPES: [
                { color: '#8B4513', speed: 3, score: 100, size: 50 },
                { color: '#4B0082', speed: 5, score: 200, size: 40 },
                { color: '#FF69B4', speed: 7, score: 300, size: 30 }
            ]
        };

        class Cow {
            constructor() {
                const type = Math.floor(Math.random() * config.COW_TYPES.length);
                this.type = config.COW_TYPES[type];
                this.x = canvas.width + 100;
                this.y = Math.random() * (canvas.height - 100) + 50;
                this.speed = this.type.speed;
                this.angle = 0;
                this.amplitude = Math.random() * 80 + 20;
                this.t = Math.random() * 100;
            }

            update() {
                this.t += 0.08;
                this.x -= this.speed;
                this.y += Math.sin(this.t) * (this.amplitude * 0.2);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ª–µ–≤–æ–≥–æ –∫—Ä–∞—è
                if(this.x < -100) {
                    lives--;
                    updateHUD();
                    if(lives <= 0) endGame();
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(Math.sin(this.t) * 0.3);
                
                // –¢–µ–ª–æ
                ctx.fillStyle = this.type.color;
                ctx.fillRect(-this.type.size/2, -this.type.size/4, this.type.size, this.type.size/2);
                
                // –ì–æ–ª–æ–≤–∞
                ctx.beginPath();
                ctx.arc(this.type.size/2, 0, this.type.size/4, 0, Math.PI * 2);
                ctx.fill();
                
                // –ö—Ä—ã–ª—å—è
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.beginPath();
                ctx.ellipse(-this.type.size/3, -this.type.size/4, this.type.size/3, this.type.size/6, Math.PI/4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
        }

        function initGame() {
            Telegram.WebApp.ready();
            resizeCanvas();
            showScreen('mainMenu');
            loadHighScores();
            updateCursor();
            
            canvas.addEventListener('click', handleShoot);
            window.addEventListener('resize', resizeCanvas);
            window.addEventListener('mousemove', updateCursor);
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(screenId).style.display = 'block';
            if(screenId === 'game') startGame();
        }

        function startGame() {
            gameActive = true;
            cows = [];
            score = 0;
            bullets = 5;
            hits = 0;
            miss = 0;
            lives = 3;
            gameTime = 60;
            updateHUD();
            spawnCow();
            gameLoop();
            startTimer();
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawStars();
            
            cows.forEach((cow, i) => {
                cow.update();
                cow.draw();
                if(cow.x < -100) cows.splice(i, 1);
            });

            animationId = requestAnimationFrame(gameLoop);
        }

        function drawStars() {
            ctx.fillStyle = '#ffffff';
            for(let i = 0; i < 100; i++) {
                ctx.fillRect(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    1, 1
                );
            }
        }

        function spawnCow() {
            if(!gameActive) return;
            cows.push(new Cow());
            setTimeout(spawnCow, config.SPAWN_RATE);
        }

        function handleShoot(e) {
            if(!gameActive || reloading) return;
            
            if(bullets <= 0) {
                startReload();
                return;
            }

            bullets--;
            const rect = canvas.getBoundingClientRect();
            const [x, y] = [e.clientX - rect.left, e.clientY - rect.top];
            let hit = false;

            cows.forEach((cow, i) => {
                const dx = x - cow.x;
                const dy = y - cow.y;
                if(Math.abs(dx) < cow.type.size && Math.abs(dy) < cow.type.size/2) {
                    cows.splice(i, 1);
                    score += cow.type.score;
                    hits++;
                    hit = true;
                }
            });

            hit ? playHitSound() : miss++;
            updateHUD();
            
            if(bullets <= 0) startReload();
        }

        function startReload() {
            reloading = true;
            document.getElementById('cursor').textContent = 'üîÑ Reloading';
            setTimeout(() => {
                bullets = config.MAX_BULLETS;
                reloading = false;
                document.getElementById('cursor').textContent = '‚ú®';
                updateHUD();
            }, config.RELOAD_TIME);
        }

        function startTimer() {
            const timer = setInterval(() => {
                gameTime--;
                document.getElementById('time').textContent = gameTime;
                
                if(gameTime <= 0 || lives <= 0) {
                    endGame();
                    clearInterval(timer);
                }
            }, 1000);
        }

        function endGame() {
            gameActive = false;
            cancelAnimationFrame(animationId);
            saveHighScore(score);
            showScreen('mainMenu');
            document.querySelector('#mainMenu h1').innerHTML = 
                `Game Over!<br>Score: ${score}<br>Hits: ${hits}`;
        }

        function updateHUD() {
            document.getElementById('score').textContent = score;
            document.getElementById('ammo').textContent = bullets;
            document.getElementById('hits').textContent = hits;
            document.getElementById('miss').textContent = miss;
            document.getElementById('lives').innerHTML = 'üíñ'.repeat(Math.max(0, lives));
            document.getElementById('time').textContent = gameTime;
        }

        function updateCursor(e) {
            const cursor = document.getElementById('cursor');
            if(e) {
                cursor.style.left = `${e.clientX + 15}px`;
                cursor.style.top = `${e.clientY}px`;
            }
        }

        function loadHighScores() {
            const scores = JSON.parse(localStorage.getItem('highScores') || '[]');
            const list = document.getElementById('highScoresList');
            list.innerHTML = scores.slice(0,5).map(s => `<li>${s.name}: ${s.score}`).join('');
        }

        function saveHighScore(score) {
            const scores = JSON.parse(localStorage.getItem('highScores') || '[]');
            scores.push({ name: 'Player', score });
            scores.sort((a,b) => b.score - a.score);
            localStorage.setItem('highScores', JSON.stringify(scores.slice(0,5)));
            loadHighScores();
        }

        function playHitSound() {
            const audio = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU');
            audio.play();
        }

        initGame();
    </script>
</body>
</html>