<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Cow Hunt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            font-family: 'Orbitron', sans-serif;
            background: #000;
            color: #fff;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        #mainMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0,0,0,0.9);
            padding: 2rem;
            border-radius: 15px;
            border: 2px solid #6a00ff;
            z-index: 2;
        }

        .menu-btn {
            padding: 1rem 2rem;
            margin: 0.5rem;
            font-size: 1.2rem;
            background: linear-gradient(45deg, #6a00ff, #a100f5);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #hud {
            position: absolute;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 1rem;
            box-sizing: border-box;
            z-index: 1;
        }

        #bottomHud {
            position: absolute;
            bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 1rem;
            box-sizing: border-box;
        }

        .hearts {
            display: flex;
            gap: 0.5rem;
        }

        .heart {
            color: #ff3366;
            font-size: 1.5rem;
        }

        #reloadingText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff0000;
            font-size: 2rem;
            text-shadow: 0 0 10px #ff0000;
            display: none;
            z-index: 3;
        }

        #timer {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            color: #00ff9d;
        }

        #leaderboard {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 2rem;
            border-radius: 15px;
            border: 2px solid #6a00ff;
            display: none;
            z-index: 3;
        }
    </style>
</head>
<body>
    <div id="mainMenu">
        <h1 style="color: #6a00ff; margin-bottom: 2rem;">SPACE COW HUNT</h1>
        <button class="menu-btn" id="startBtn">Start Game</button>
        <button class="menu-btn" id="howToBtn">How to Play</button>
        <button class="menu-btn" id="leaderboardBtn">High Scores</button>
    </div>

    <div id="hud">
        <div>Score: <span id="score">0</span></div>
        <div id="timer">60s</div>
        <div class="hearts" id="lives"></div>
    </div>

    <div id="bottomHud">
        <div>Ammo: <span id="ammo">5</span></div>
        <div>Hits: <span id="hits">0</span></div>
        <div>Misses: <span id="misses">0</span></div>
    </div>

    <div id="reloadingText">RELOADING...</div>
    <div id="leaderboard">
        <h2>TOP 5 COWBOYS</h2>
        <ol id="highScores"></ol>
        <button class="menu-btn" onclick="closeLeaderboard()">Close</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameState = {};
        let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
        
        // Инициализация игры
        function initGame() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            gameState = {
                cows: [],
                score: 0,
                ammo: 5,
                lives: 3,
                hits: 0,
                misses: 0,
                isPlaying: false,
                reloading: false,
                particles: [],
                crosshair: { x: 0, y: 0 },
                lastShot: 0,
                timeLeft: 60
            };
            
            updateLivesDisplay();
            startGameTimer();
        }

        // Обновление отображения жизней
        function updateLivesDisplay() {
            const livesContainer = document.getElementById('lives');
            livesContainer.innerHTML = Array(gameState.lives).fill('<span class="heart">❤</span>').join('');
        }

        // Таймер игры
        function startGameTimer() {
            const timerInterval = setInterval(() => {
                gameState.timeLeft--;
                document.getElementById('timer').textContent = `${gameState.timeLeft}s`;
                
                if(gameState.timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        // Создание коров разных типов
        class SpaceCow {
            constructor(type) {
                this.types = {
                    basic: { speed: 2, color: '#ff9966', score: 100 },
                    speedy: { speed: 4, color: '#ff4444', score: 200 },
                    tank: { speed: 1, color: '#8888ff', score: 300 }
                };
                
                this.type = type || Object.keys(this.types)[Math.floor(Math.random() * 3)];
                this.config = this.types[this.type];
                
                this.x = Math.random() < 0.5 ? -100 : canvas.width + 100;
                this.y = Math.random() * canvas.height * 0.8;
                this.angle = 0;
                this.health = this.type === 'tank' ? 2 : 1;
                this.active = true;
            }

            update() {
                const wave = Math.sin(this.angle) * 50;
                this.x += this.config.speed * (this.x < canvas.width/2 ? 1 : -1);
                this.y += wave * 0.1;
                this.angle += 0.05;
            }

            draw() {
                ctx.fillStyle = this.config.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // Крылья
                ctx.strokeStyle = this.config.color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 30, Math.PI * 0.2, Math.PI * 0.8);
                ctx.stroke();
            }
        }

        // Основной игровой цикл
        function gameLoop() {
            if(!gameState.isPlaying) return;

            ctx.fillStyle = 'rgba(25, 0, 51, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Создание звёздного фона
            if(Math.random() < 0.05) {
                ctx.fillStyle = `hsl(${Math.random()*360}, 100%, 80%)`;
                ctx.beginPath();
                ctx.arc(
                    Math.random()*canvas.width,
                    Math.random()*canvas.height,
                    Math.random()*2,
                    0, Math.PI*2
                );
                ctx.fill();
            }

            // Создание новых коров
            if(Math.random() < 0.02) {
                gameState.cows.push(new SpaceCow());
            }

            // Обновление коров
            gameState.cows = gameState.cows.filter(cow => {
                cow.update();
                cow.draw();
                return cow.active && cow.x > -150 && cow.x < canvas.width + 150;
            });

            requestAnimationFrame(gameLoop);
        }

        // Обработка выстрела
        function handleShoot(e) {
            if(!gameState.isPlaying || gameState.reloading || Date.now() - gameState.lastShot < 200) return;

            gameState.lastShot = Date.now();
            gameState.ammo--;
            
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;

            let hit = false;
            gameState.cows.forEach(cow => {
                const dx = x - cow.x;
                const dy = y - cow.y;
                if(Math.sqrt(dx*dx + dy*dy) < 30) {
                    cow.health--;
                    if(cow.health <= 0) {
                        cow.active = false;
                        gameState.score += cow.config.score;
                        gameState.hits++;
                    }
                    hit = true;
                }
            });

            if(!hit) gameState.misses++;
            if(hit) new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU').play();

            updateHud();
            
            if(gameState.ammo <= 0) {
                gameState.reloading = true;
                document.getElementById('reloadingText').style.display = 'block';
                setTimeout(() => {
                    gameState.ammo = 5;
                    gameState.reloading = false;
                    document.getElementById('reloadingText').style.display = 'none';
                }, 2000);
            }
        }

        // Обновление интерфейса
        function updateHud() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('ammo').textContent = gameState.ammo;
            document.getElementById('hits').textContent = gameState.hits;
            document.getElementById('misses').textContent = gameState.misses;
        }

        // Завершение игры
        function endGame() {
            gameState.isPlaying = false;
            document.getElementById('mainMenu').style.display = 'block';
            
            if(leaderboard.length < 5 || gameState.score > leaderboard[4].score) {
                const name = prompt('New high score! Enter your name:');
                if(name) {
                    leaderboard.push({ name, score: gameState.score });
                    leaderboard.sort((a,b) => b.score - a.score);
                    leaderboard = leaderboard.slice(0,5);
                    localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
                }
            }
        }

        // Лидерборд
        function showLeaderboard() {
            const list = document.getElementById('highScores');
            list.innerHTML = leaderboard
                .map((entry, i) => `<li>${i+1}. ${entry.name} - ${entry.score}</li>`)
                .join('');
            document.getElementById('leaderboard').style.display = 'block';
        }

        function closeLeaderboard() {
            document.getElementById('leaderboard').style.display = 'none';
        }

        // Инициализация событий
        canvas.addEventListener('mousedown', handleShoot);
        canvas.addEventListener('touchstart', handleShoot);

        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('mainMenu').style.display = 'none';
            initGame();
            gameState.isPlaying = true;
            gameLoop();
        });

        document.getElementById('howToBtn').addEventListener('click', () => {
            alert('How to Play:\n- Shoot space cows before time runs out\n- 5 shots before reload\n- 3 lives\n- Different cow types:\n  Red: Fast (200pts)\n  Blue: Tank (300pts)\n  Orange: Basic (100pts)');
        });

        document.getElementById('leaderboardBtn').addEventListener('click', showLeaderboard);

        // Инициализация Telegram Web App
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>