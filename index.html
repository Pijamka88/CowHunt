<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Коровки в космосе</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      color: white;
    }

    canvas {
      display: block;
      background: #002244;
    }

    #menu {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
    }

    #menu button {
      padding: 15px 30px;
      font-size: 20px;
      border: none;
      background: #007BFF;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      margin: 10px;
    }

    #menu button:hover {
      background: #0056b3;
    }

    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 20px;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>Коровки в космосе</h1>
    <button onclick="startGame()">Начать игру</button>
    <p>Попади в коров с крыльями!</p>
  </div>
  <div id="score">Счёт: 0</div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    let gameRunning = false;
    let score = 0;
    let cows = [];
    let particles = [];

    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }

    window.addEventListener('resize', resize);

    class Cow {
      constructor(x, y, speed) {
        this.x = x;
        this.y = y;
        this.speed = speed;
        this.direction = Math.random() > 0.5 ? 1 : -1;
        this.size = 50 + Math.random() * 30;
        this.health = 1;
        this.dead = false;
        this.angle = 0;
      }

      update() {
        if (this.dead) return;
        this.x += this.speed * this.direction;
        this.y += Math.sin(this.angle) * 2;
        this.angle += 0.05;
        if (this.x < 0 || this.x > width) {
          this.direction *= -1;
        }
      }

      draw() {
        if (this.dead) return;
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle);
        // Тело коровы
        ctx.beginPath();
        ctx.fillStyle = '#4488aa';
        ctx.ellipse(0, 0, this.size / 2, this.size, 0, 0, Math.PI * 2);
        ctx.fill();

        // Голова
        ctx.beginPath();
        ctx.fillStyle = '#ffffff';
        ctx.arc(0, -this.size / 2, this.size / 3, 0, Math.PI * 2);
        ctx.fill();

        // Шлем
        ctx.beginPath();
        ctx.fillStyle = '#336699';
        ctx.arc(0, -this.size / 2, this.size / 3.5, 0, Math.PI * 2);
        ctx.fill();

        // Рога
        ctx.beginPath();
        ctx.fillStyle = '#ffcc00';
        ctx.moveTo(-this.size / 4, -this.size / 2 - this.size / 6);
        ctx.lineTo(-this.size / 6, -this.size / 2 - this.size / 6);
        ctx.lineTo(-this.size / 6, -this.size / 2 - this.size / 6 - this.size / 6);
        ctx.lineTo(-this.size / 4, -this.size / 2 - this.size / 6 - this.size / 6);
        ctx.closePath();
        ctx.fill();

        ctx.beginPath();
        ctx.moveTo(this.size / 4, -this.size / 2 - this.size / 6);
        ctx.lineTo(this.size / 6, -this.size / 2 - this.size / 6);
        ctx.lineTo(this.size / 6, -this.size / 2 - this.size / 6 - this.size / 6);
        ctx.lineTo(this.size / 4, -this.size / 2 - this.size / 6 - this.size / 6);
        ctx.closePath();
        ctx.fill();

        // Глаза
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(-this.size / 6, -this.size / 2 + this.size / 10, 5, 0, Math.PI * 2);
        ctx.arc(this.size / 6, -this.size / 2 + this.size / 10, 5, 0, Math.PI * 2);
        ctx.fill();

        // Нос
        ctx.fillStyle = '#8b4513';
        ctx.beginPath();
        ctx.arc(0, -this.size / 2 + this.size / 4, 8, 0, Math.PI * 2);
        ctx.fill();

        // Ноздри
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(-3, -this.size / 2 + this.size / 4 + 2, 2, 0, Math.PI * 2);
        ctx.arc(3, -this.size / 2 + this.size / 4 + 2, 2, 0, Math.PI * 2);
        ctx.fill();

        // Ноги
        for (let i = 0; i < 4; i++) {
          ctx.fillStyle = '#654321';
          ctx.fillRect(i * 10 - 10, this.size / 2, 5, 10);
        }

        ctx.restore();
      }

      hit() {
        this.health--;
        if (this.health <= 0) {
          this.dead = true;
          createExplosion(this.x, this.y);
        }
      }
    }

    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 8;
        this.vy = (Math.random() - 0.5) * 8;
        this.color = color;
        this.life = 30;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.life--;
      }

      draw() {
        ctx.beginPath();
        ctx.fillStyle = this.color;
        ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function createExplosion(x, y) {
      for (let i = 0; i < 30; i++) {
        particles.push(new Particle(x, y, '#ffcc00'));
      }
    }

    function spawnCows() {
      for (let i = 0; i < 5; i++) {
        const x = Math.random() * width;
        const y = Math.random() * height;
        const speed = 2 + Math.random() * 2;
        cows.push(new Cow(x, y, speed));
      }
    }

    function startGame() {
      document.getElementById("menu").style.display = "none";
      gameRunning = true;
      score = 0;
      document.getElementById("score").innerText = "Счёт: 0";
      cows = [];
      particles = [];
      spawnCows();
      requestAnimationFrame(gameLoop);
    }

    function gameLoop() {
      if (!gameRunning) return;

      ctx.clearRect(0, 0, width, height);

      // Обновление и отрисовка коров
      for (let cow of cows) {
        cow.update();
        cow.draw();
      }

      // Обновление и отрисовка частиц
      for (let p of particles) {
        p.update();
        p.draw();
      }

      // Удаление устаревших частиц
      particles = particles.filter(p => p.life > 0);

      // Проверка столкновений
      for (let cow of cows) {
        if (cow.dead) {
          cow.y += 3;
          if (cow.y > height) {
            cows.splice(cows.indexOf(cow), 1);
          }
        }
      }

      // Перезапуск коров при их исчезновении
      if (cows.length === 0) {
        spawnCows();
      }

      requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener('click', (e) => {
      if (!gameRunning) return;
      const rect = canvas.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const clickY = e.clientY - rect.top;

      for (let cow of cows) {
        const dx = clickX - cow.x;
        const dy = clickY - cow.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < cow.size) {
          cow.hit();
          score++;
          document.getElementById("score").innerText = "Счёт: " + score;
        }
      }
    });

    // Мобильная оптимизация
    canvas.addEventListener('touchstart', (e) => {
      if (!gameRunning) return;
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const clickX = touch.clientX - rect.left;
      const clickY = touch.clientY - rect.top;

      for (let cow of cows) {
        const dx = clickX - cow.x;
        const dy = clickY - cow.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < cow.size) {
          cow.hit();
          score++;
          document.getElementById("score").innerText = "Счёт: " + score;
        }
      }
    });

    // Запуск игры по умолчанию
    window.onload = () => {
      if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.ready();
      }
    };
  </script>
</body>
</html>