<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—ã–µ –ú–∏—à–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background-color: #f0e6d2;
            color: #3a2c1a;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f0e6d2"/><path d="M0,0 L100,100 M100,0 L0,100" stroke="%23d4c9a8" stroke-width="1"/></svg>');
            background-size: 100px 100px;
        }

        #game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #d4c9a8;
            border: 2px solid #8b7355;
            border-radius: 5px;
            box-shadow: 3px 3px 5px rgba(0,0,0,0.2);
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }

        .pets-count {
            background-color: #8b7355;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 16px;
        }

        .pets-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .pet {
            position: relative;
            width: 120px;
            text-align: center;
        }

        .pet-image {
            width: 100px;
            height: 100px;
            margin: 0 auto;
            position: relative;
            filter: drop-shadow(3px 3px 3px rgba(0,0,0,0.3));
        }

        .pet-emoji {
            font-size: 60px;
            line-height: 100px;
            transition: transform 0.3s;
        }

        .pet:hover .pet-emoji {
            transform: scale(1.1);
        }

        .pet-level {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #8b7355;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid #3a2c1a;
            z-index: 2;
        }

        .pet-stats {
            background-color: #d4c9a8;
            border: 2px solid #8b7355;
            border-radius: 5px;
            padding: 5px;
            margin-top: 5px;
            font-size: 12px;
            box-shadow: 2px 2px 3px rgba(0,0,0,0.1);
        }

        .stat-bar {
            height: 10px;
            background-color: #8b7355;
            border-radius: 3px;
            margin-top: 2px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background-color: #4a752c;
            transition: width 0.3s;
        }

        .health .stat-fill {
            background-color: #c22b2b;
        }

        .hunger .stat-fill {
            background-color: #d4a017;
        }

        .energy .stat-fill {
            background-color: #2b6ec2;
        }

        .happiness .stat-fill {
            background-color: #c22b8f;
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 15px;
            background-color: #d4c9a8;
            border: 2px solid #8b7355;
            border-radius: 5px;
            box-shadow: 3px 3px 5px rgba(0,0,0,0.2);
        }

        .action-btn {
            background-color: #8b7355;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Times New Roman', serif;
            font-size: 14px;
            transition: background-color 0.3s;
            box-shadow: 2px 2px 3px rgba(0,0,0,0.2);
        }

        .action-btn:hover {
            background-color: #6b5a3f;
        }

        .action-btn:disabled {
            background-color: #a9a18e;
            cursor: not-allowed;
        }

        .selected {
            outline: 3px solid #4a752c;
            outline-offset: 3px;
            border-radius: 5px;
        }

        .evolution-animation {
            animation: evolve 1s ease-in-out;
        }

        @keyframes evolve {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .bounce {
            animation: bounce 0.5s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .eat-animation {
            animation: eat 0.5s ease;
        }

        @keyframes eat {
            0% { transform: scale(1); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1); }
        }

        .sleep-animation {
            animation: sleep 2s ease-in-out infinite;
        }

        @keyframes sleep {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }

        .play-animation {
            animation: play 0.3s ease infinite alternate;
        }

        @keyframes play {
            from { transform: translateX(0); }
            to { transform: translateX(5px); }
        }

        .heal-animation {
            animation: heal 0.5s ease;
        }

        @keyframes heal {
            0% { opacity: 1; }
            50% { opacity: 0.5; background-color: rgba(255,255,255,0.8); }
            100% { opacity: 1; }
        }

        .train-animation {
            animation: train 0.3s ease infinite alternate;
        }

        @keyframes train {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="header">
            <div class="title">–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—ã–µ –ú–∏—à–∫–∏</div>
            <div class="pets-count" id="pets-count">0</div>
        </div>

        <div class="pets-container" id="pets-container">
            <!-- –ú–∏—à–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>

        <div class="actions">
            <button class="action-btn" id="feed-btn">–ü–æ–∫–æ—Ä–º–∏—Ç—å</button>
            <button class="action-btn" id="play-btn">–ü–æ–∏–≥—Ä–∞—Ç—å</button>
            <button class="action-btn" id="sleep-btn">–£–ª–æ–∂–∏—Ç—å —Å–ø–∞—Ç—å</button>
            <button class="action-btn" id="heal-btn">–õ–µ—á–∏—Ç—å</button>
            <button class="action-btn" id="train-btn">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            pets: [],
            selectedPetIndex: 0,
            lastUpdate: Date.now(),
            version: 1
        };
        
        // –í–∏–¥—ã –º–∏—à–µ–∫ –∏ –∏—Ö —ç–≤–æ–ª—é—Ü–∏–∏
        const speciesData = {
            'baby': {
                emoji: 'üêª',
                color: '#8B4513',
                next: ['teen'],
                stats: { health: 100, hunger: 100, energy: 100, happiness: 100 }
            },
            'teen': {
                emoji: 'üêª',
                color: '#A0522D',
                next: ['adult'],
                stats: { health: 120, hunger: 120, energy: 120, happiness: 120 }
            },
            'adult': {
                emoji: 'üêª',
                color: '#654321',
                next: ['knight'],
                stats: { health: 150, hunger: 150, energy: 150, happiness: 150 }
            },
            'knight': {
                emoji: 'üêª',
                color: '#2F4F4F',
                next: ['king'],
                stats: { health: 200, hunger: 200, energy: 200, happiness: 200 }
            },
            'king': {
                emoji: 'üêª',
                color: '#D4AF37',
                next: [],
                stats: { health: 250, hunger: 250, energy: 250, happiness: 250 }
            }
        };
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const elements = {
            petsContainer: document.getElementById('pets-container'),
            petsCount: document.getElementById('pets-count'),
            feedBtn: document.getElementById('feed-btn'),
            playBtn: document.getElementById('play-btn'),
            sleepBtn: document.getElementById('sleep-btn'),
            healBtn: document.getElementById('heal-btn'),
            trainBtn: document.getElementById('train-btn')
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGame();
            setupEventListeners();
            
            if (gameState.pets.length === 0) {
                // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ –º–∏—à–∫—É, –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö
                addNewPet();
            } else {
                updateGameUI();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            setInterval(gameLoop, 1000);
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            elements.feedBtn.addEventListener('click', () => performAction('feed'));
            elements.playBtn.addEventListener('click', () => performAction('play'));
            elements.sleepBtn.addEventListener('click', () => performAction('sleep'));
            elements.healBtn.addEventListener('click', () => performAction('heal'));
            elements.trainBtn.addEventListener('click', () => performAction('train'));
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (gameState.pets.length === 0) return;
            
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdate) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdate = now;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ—Ö –º–∏—à–µ–∫
            gameState.pets.forEach(pet => {
                updatePet(pet, deltaTime);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            saveGame();
            updateGameUI();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏—à–∫–∏
        function updatePet(pet, deltaTime) {
            // –£–º–µ–Ω—å—à–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
            pet.hunger = Math.max(0, pet.hunger - 0.3 * deltaTime);
            pet.energy = Math.max(0, pet.energy - 0.2 * deltaTime);
            pet.happiness = Math.max(0, pet.happiness - 0.1 * deltaTime);
            
            // –ï—Å–ª–∏ –≥–æ–ª–æ–¥ –∏–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –Ω–∞ –Ω—É–ª–µ, —É–º–µ–Ω—å—à–∞–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
            if (pet.hunger <= 0 || pet.energy <= 0) {
                pet.health = Math.max(0, pet.health - 0.5 * deltaTime);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –º–∏—à–∫–∞
            if (pet.health <= 0 && !pet.isDead) {
                pet.isDead = true;
                pet.deathTime = Date.now();
            }
            
            // –ï—Å–ª–∏ –º–∏—à–∫–∞ –º–µ—Ä—Ç–≤ –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç, —É–¥–∞–ª—è–µ–º –µ–≥–æ
            if (pet.isDead && Date.now() - pet.deathTime > 300000) {
                const index = gameState.pets.indexOf(pet);
                if (index !== -1) {
                    gameState.pets.splice(index, 1);
                    if (gameState.selectedPetIndex >= index) {
                        gameState.selectedPetIndex = Math.max(0, gameState.selectedPetIndex - 1);
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–≤–æ–ª—é—Ü–∏—é
            checkEvolution(pet);
        }
        
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –º–∏—à–∫–æ–π
        function performAction(action) {
            const pet = getSelectedPet();
            if (!pet || pet.isDead) return;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è
            const petElement = document.querySelector(`.pet[data-index="${gameState.selectedPetIndex}"] .pet-emoji`);
            if (petElement) {
                petElement.classList.remove('eat-animation', 'play-animation', 'sleep-animation', 'heal-animation', 'train-animation');
                void petElement.offsetWidth; // Trigger reflow
                
                switch (action) {
                    case 'feed': petElement.classList.add('eat-animation'); break;
                    case 'play': petElement.classList.add('play-animation'); break;
                    case 'sleep': petElement.classList.add('sleep-animation'); break;
                    case 'heal': petElement.classList.add('heal-animation'); break;
                    case 'train': petElement.classList.add('train-animation'); break;
                }
            }
            
            switch (action) {
                case 'feed':
                    pet.hunger = Math.min(getSpeciesData(pet.species).stats.hunger, pet.hunger + 20);
                    pet.energy = Math.max(0, pet.energy - 5);
                    addExp(pet, 5);
                    break;
                case 'play':
                    pet.happiness = Math.min(getSpeciesData(pet.species).stats.happiness, pet.happiness + 15);
                    pet.energy = Math.max(0, pet.energy - 10);
                    pet.hunger = Math.max(0, pet.hunger - 5);
                    addExp(pet, 10);
                    break;
                case 'sleep':
                    pet.energy = Math.min(getSpeciesData(pet.species).stats.energy, pet.energy + 30);
                    pet.hunger = Math.max(0, pet.hunger - 10);
                    addExp(pet, 5);
                    break;
                case 'heal':
                    pet.health = Math.min(getSpeciesData(pet.species).stats.health, pet.health + 25);
                    pet.energy = Math.max(0, pet.energy - 10);
                    addExp(pet, 5);
                    break;
                case 'train':
                    pet.energy = Math.max(0, pet.energy - 15);
                    pet.hunger = Math.max(0, pet.hunger - 10);
                    addExp(pet, 15);
                    break;
            }
            
            updateGameUI();
            saveGame();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—ã—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
        function addExp(pet, amount) {
            pet.exp += amount;
            const expNeeded = getExpForLevel(pet.level + 1);
            
            if (pet.exp >= expNeeded) {
                pet.level++;
                pet.exp -= expNeeded;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
                const petElement = document.querySelector(`.pet[data-index="${gameState.pets.indexOf(pet)}"] .pet-emoji`);
                if (petElement) {
                    petElement.classList.add('bounce');
                    setTimeout(() => petElement.classList.remove('bounce'), 1000);
                }
                
                // –ï—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –∫—Ä–∞—Ç–µ–Ω 3, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –º–∏—à–∫—É
                if (pet.level % 3 === 0) {
                    addNewPet();
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–≤–æ–ª—é—Ü–∏–∏
        function checkEvolution(pet) {
            const speciesInfo = speciesData[pet.species];
            const nextSpecies = speciesInfo.next;
            
            for (const next of nextSpecies) {
                if (pet.level >= 3 * (Object.keys(speciesData).indexOf(next)) {
                    evolvePet(pet, next);
                    return;
                }
            }
        }
        
        // –≠–≤–æ–ª—é—Ü–∏—è –º–∏—à–∫–∏
        function evolvePet(pet, newSpecies) {
            const petElement = document.querySelector(`.pet[data-index="${gameState.pets.indexOf(pet)}"] .pet-emoji`);
            if (petElement) {
                petElement.classList.add('evolution-animation');
                setTimeout(() => petElement.classList.remove('evolution-animation'), 1000);
            }
            
            pet.species = newSpecies;
            saveGame();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∏—à–∫–∏
        function addNewPet() {
            const newPet = {
                species: 'baby',
                level: 1,
                exp: 0,
                health: speciesData['baby'].stats.health,
                hunger: speciesData['baby'].stats.hunger,
                energy: speciesData['baby'].stats.energy,
                happiness: speciesData['baby'].stats.happiness,
                isDead: false,
                birthTime: Date.now()
            };
            
            gameState.pets.push(newPet);
            gameState.selectedPetIndex = gameState.pets.length - 1;
            
            updateGameUI();
            saveGame();
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–∏—à–∫–∏
        function getSelectedPet() {
            return gameState.pets[gameState.selectedPetIndex];
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ
        function getSpeciesData(species) {
            return speciesData[species] || speciesData['baby'];
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–ø—ã—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω—è
        function getExpForLevel(level) {
            return 50 * Math.pow(level, 1.5);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–≥—Ä—ã
        function updateGameUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏—à–µ–∫
            elements.petsCount.textContent = gameState.pets.length;
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –º–∏—à–∫–∞–º–∏
            elements.petsContainer.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–∏—à–µ–∫ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            gameState.pets.forEach((pet, index) => {
                const speciesInfo = getSpeciesData(pet.species);
                
                const petElement = document.createElement('div');
                petElement.className = `pet ${index === gameState.selectedPetIndex ? 'selected' : ''}`;
                petElement.setAttribute('data-index', index);
                
                if (pet.isDead) {
                    petElement.style.opacity = '0.6';
                }
                
                petElement.innerHTML = `
                    <div class="pet-image">
                        <div class="pet-emoji" style="color: ${speciesInfo.color}">${speciesInfo.emoji}</div>
                    </div>
                    <div class="pet-level">${pet.level}</div>
                    <div class="pet-stats">
                        <div class="stat health">
                            <div>–ó–¥–æ—Ä–æ–≤—å–µ: ${Math.floor(pet.health)}/${speciesInfo.stats.health}</div>
                            <div class="stat-bar">
                                <div class="stat-fill" style="width: ${(pet.health / speciesInfo.stats.health) * 100}%"></div>
                            </div>
                        </div>
                        <div class="stat hunger">
                            <div>–ì–æ–ª–æ–¥: ${Math.floor(pet.hunger)}/${speciesInfo.stats.hunger}</div>
                            <div class="stat-bar">
                                <div class="stat-fill" style="width: ${(pet.hunger / speciesInfo.stats.hunger) * 100}%"></div>
                            </div>
                        </div>
                        <div class="stat energy">
                            <div>–≠–Ω–µ—Ä–≥–∏—è: ${Math.floor(pet.energy)}/${speciesInfo.stats.energy}</div>
                            <div class="stat-bar">
                                <div class="stat-fill" style="width: ${(pet.energy / speciesInfo.stats.energy) * 100}%"></div>
                            </div>
                        </div>
                        <div class="stat happiness">
                            <div>–°—á–∞—Å—Ç—å–µ: ${Math.floor(pet.happiness)}/${speciesInfo.stats.happiness}</div>
                            <div class="stat-bar">
                                <div class="stat-fill" style="width: ${(pet.happiness / speciesInfo.stats.happiness) * 100}%"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –º–∏—à–∫–∏
                petElement.addEventListener('click', () => {
                    gameState.selectedPetIndex = index;
                    updateGameUI();
                });
                
                elements.petsContainer.appendChild(petElement);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            const pet = getSelectedPet();
            if (pet) {
                const isDead = pet.isDead;
                elements.feedBtn.disabled = isDead;
                elements.playBtn.disabled = isDead;
                elements.sleepBtn.disabled = isDead;
                elements.healBtn.disabled = isDead;
                elements.trainBtn.disabled = isDead;
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        function saveGame() {
            localStorage.setItem('medievalBears', JSON.stringify(gameState));
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
        function loadGame() {
            const savedGame = localStorage.getItem('medievalBears');
            if (savedGame) {
                const parsed = JSON.parse(savedGame);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                if (parsed.version === gameState.version) {
                    gameState = parsed;
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
