<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тапики</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --pet-color-1: #FF6B6B;
            --pet-color-2: #4ECDC4;
            --pet-color-3: #45B7D1;
            --pet-color-4: #FFBE0B;
            --pet-color-5: #FB5607;
            --pet-color-6: #8338EC;
            --pet-color-7: #3A86FF;
            --pet-color-8: #FF006E;
            --pet-color-9: #A5DD9B;
            --pet-color-10: #F9C74F;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: #FFEEDD;
            margin: 0;
            padding: 0;
            color: #5A3D2B;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            padding: 15px;
            box-sizing: border-box;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: #FFD5A5;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        h1 {
            margin: 0;
            color: #FF6B6B;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
            font-size: 24px;
        }

        .pets-count {
            background-color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .pets-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding-bottom: 20px;
            max-height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .pet {
            width: 140px;
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            position: relative;
        }

        .pet:hover {
            transform: translateY(-5px);
        }

        .pet.active {
            box-shadow: 0 0 0 3px #FF9E7D;
        }

        .pet-shape {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            position: relative;
            background-color: var(--pet-color);
            border-radius: 50%;
            /* Медвежья мордочка */
            box-shadow: 
                /* Уши */
                -15px -10px 0 0 var(--pet-color) inset,
                15px -10px 0 0 var(--pet-color) inset,
                /* Глаза */
                -10px 10px 0 0 white inset,
                10px 10px 0 0 white inset,
                /* Нос */
                0px 15px 0 0 white inset,
                /* Рот */
                0px 25px 0 0 transparent inset;
        }

        .pet-shape::before,
        .pet-shape::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #5A3D2B;
            border-radius: 50%;
            top: 30px;
        }

        .pet-shape::before {
            left: 25px;
        }

        .pet-shape::after {
            right: 25px;
        }

        .pet-stats {
            margin-top: 10px;
        }

        .stat {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .stat-icon {
            width: 16px;
            height: 16px;
            margin-right: 5px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .hunger-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23e74c3c'%3E%3Cpath d='M12 3c-4.97 0-9 3.185-9 7.115 0 2.557 1.522 4.82 3.889 6.115l-.996 1.74C3.562 19.8 6.848 21 12 21c5.153 0 8.438-1.2 9.107-3.03l-.996-1.74c2.367-1.295 3.889-3.558 3.889-6.115C21 6.185 16.97 3 12 3zm0 2c3.87 0 7 2.355 7 5.115 0 1.847-.988 3.49-2.57 4.53l-.43.26-.3.42-.5-.28c-.645-.37-1.292-.62-2-.76V11h-2v1.815c-.708.14-1.355.39-2 .76l-.5.28-.3-.42-.43-.26C5.988 13.605 5 11.962 5 10.115 5 7.355 8.13 5 12 5z'/%3E%3C/svg%3E");
        }

        .energy-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23f39c12'%3E%3Cpath d='M12 20a8 8 0 0 1-8-8 8 8 0 0 1 8-8 8 8 0 0 1 8 8 8 8 0 0 1-8 8m0-18a10 10 0 0 0-10 10 10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2m-1 12h2v5h-2v-5m0-9h2v7h-2V5'/%3E%3C/svg%3E");
        }

        .happiness-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232ecc71'%3E%3Cpath d='M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z'/%3E%3Cpath d='M14.829 14.828a4.055 4.055 0 0 1-1.272.858 4.002 4.002 0 0 1-4.875-1.45l-1.658 1.119a6.063 6.063 0 0 0 1.621 1.62 5.963 5.963 0 0 0 2.148.903 6.042 6.042 0 0 0 3.163-.85 6.048 6.048 0 0 0 1.652-1.617l-1.658-1.119a4.032 4.032 0 0 1-.489.592z'/%3E%3Ccircle cx='8.5' cy='10.5' r='1.5'/%3E%3Ccircle cx='15.5' cy='10.5' r='1.5'/%3E%3C/svg%3E");
        }

        .stat-bar {
            flex-grow: 1;
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            border-radius: 4px;
        }

        .hunger-fill {
            background-color: #e74c3c;
        }

        .energy-fill {
            background-color: #f39c12;
        }

        .happiness-fill {
            background-color: #2ecc71;
        }

        .level-info {
            font-size: 10px;
            text-align: center;
            margin-top: 5px;
            color: #888;
        }

        .xp-bar {
            height: 4px;
            background-color: #ddd;
            border-radius: 2px;
            margin-top: 3px;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background-color: #9b59b6;
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 15px;
            background-color: #FFD5A5;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .action-btn {
            border: none;
            background-color: white;
            color: #5A3D2B;
            padding: 8px 12px;
            border-radius: 20px;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .action-btn:disabled {
            opacity: 0.5;
            transform: none;
            cursor: not-allowed;
        }

        .action-icon {
            width: 16px;
            height: 16px;
            background-size: contain;
        }

        .feed-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23e74c3c'%3E%3Cpath d='M18.06 22.99h1.66c.84 0 1.53-.64 1.63-1.46L23 5.05h-5V1h-1.97v4.05h-4.97l.3 2.34c1.71.47 3.31 1.32 4.27 2.26 1.44 1.42 2.43 2.89 2.43 5.29v8.05zM1 21.99V21h15.03v.99c0 .55-.45 1-1.01 1H2.01c-.56 0-1.01-.45-1.01-1zm15.03-7c0-8-15.03-8-15.03 0h15.03zM1.02 17h15v2h-15z'/%3E%3C/svg%3E");
        }

        .play-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232ecc71'%3E%3Cpath d='M8 5v14l11-7z'/%3E%3C/svg%3E");
        }

        .sleep-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23f39c12'%3E%3Cpath d='M12.34 2.02C6.59 1.82 2 6.42 2 12c0 5.52 4.48 10 10 10 3.71 0 6.93-2.02 8.66-5.02-7.51-.25-12.09-8.43-8.32-14.96z'/%3E%3C/svg%3E");
        }

        .train-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%239b59b6'%3E%3Cpath d='M4 9h16v2H4zm0 4h10v2H4z'/%3E%3C/svg%3E");
        }

        .menu-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background-color: white;
            border: none;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
        }

        .menu-icon {
            width: 24px;
            height: 24px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%235A3D2B'%3E%3Cpath d='M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z'/%3E%3C/svg%3E");
            background-size: contain;
        }

        .menu-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 213, 165, 0.95);
            z-index: 90;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transform: translateY(-100%);
            transition: transform 0.3s;
        }

        .menu-screen.active {
            transform: translateY(0);
        }

        .menu-item {
            background-color: white;
            color: #5A3D2B;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 30px;
            font-weight: bold;
            text-decoration: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 200px;
            text-align: center;
            cursor: pointer;
        }

        .menu-item:hover {
            background-color: #FFEEDD;
        }

        .game-title {
            font-size: 32px;
            color: #FF6B6B;
            margin-bottom: 30px;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.1);
        }

        @media (max-width: 480px) {
            .pet {
                width: calc(50% - 20px);
            }
            
            .actions {
                gap: 5px;
            }
            
            .action-btn {
                padding: 6px 8px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Тапики</h1>
            <div class="pets-count" id="pets-count">1 мишка</div>
        </header>

        <div class="pets-container" id="pets-container">
            <!-- Питомцы будут добавляться здесь -->
        </div>

        <div class="actions">
            <button class="action-btn" id="feed-btn" onclick="feedPet()">
                <span class="action-icon feed-icon"></span>
                Кормить
            </button>
            <button class="action-btn" id="play-btn" onclick="playWithPet()">
                <span class="action-icon play-icon"></span>
                Играть
            </button>
            <button class="action-btn" id="sleep-btn" onclick="restPet()">
                <span class="action-icon sleep-icon"></span>
                Спать
            </button>
            <button class="action-btn" id="train-btn" onclick="trainPet()">
                <span class="action-icon train-icon"></span>
                Тренировать
            </button>
        </div>

        <button class="menu-btn" id="menu-btn">
            <span class="menu-icon"></span>
        </button>

        <div class="menu-screen" id="menu-screen">
            <div class="game-title">Тапики</div>
            <div class="menu-item" onclick="continueGame()">Продолжить</div>
            <div class="menu-item" onclick="newGame()">Новая игра</div>
            <div class="menu-item" onclick="showHelp()">Помощь</div>
        </div>
    </div>

    <script>
        // Игровые данные
        let gameState = {
            pets: [],
            currentPetIndex: 0,
            lastUpdateTime: Date.now()
        };

        // Цвета для питомцев
        const petColors = [
            'var(--pet-color-1)',
            'var(--pet-color-2)',
            'var(--pet-color-3)',
            'var(--pet-color-4)',
            'var(--pet-color-5)',
            'var(--pet-color-6)',
            'var(--pet-color-7)',
            'var(--pet-color-8)',
            'var(--pet-color-9)',
            'var(--pet-color-10)'
        ];

        // Инициализация игры
        function initGame() {
            // Проверяем, есть ли сохраненные данные
            const savedGame = localStorage.getItem('tapikiGame');
            if (savedGame) {
                gameState = JSON.parse(savedGame);
                gameState.lastUpdateTime = Date.now();
                updateStatsOverTime();
            } else {
                newGame();
            }
            
            // Инициализация Telegram Web App
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
            }
            
            renderGame();
            
            // Настройка меню
            document.getElementById('menu-btn').addEventListener('click', toggleMenu);
        }

        // Новая игра
        function newGame() {
            gameState = {
                pets: [createNewPet(0)],
                currentPetIndex: 0,
                lastUpdateTime: Date.now()
            };
            saveGame();
            hideMenu();
            renderGame();
        }

        // Продолжить игру
        function continueGame() {
            hideMenu();
        }

        // Показать помощь
        function showHelp() {
            alert(`Как играть в Тапики:
            
1. Кормите мишку - увеличивает сытость
2. Играйте с мишкой - увеличивает счастье
3. Укладывайте спать - восстанавливает энергию
4. Тренируйте - дает опыт для роста
            
Когда мишка достигнет +3 уровня от текущего максимума, появится новый мишка!`);
        }

        // Создать нового питомца
        function createNewPet(index) {
            return {
                hunger: 80,
                energy: 80,
                happiness: 80,
                level: 1,
                xp: 0,
                maxLevel: 1,
                color: petColors[index % petColors.length]
            };
        }

        // Сохранить игру
        function saveGame() {
            localStorage.setItem('tapikiGame', JSON.stringify(gameState));
        }

        // Показать/скрыть меню
        function toggleMenu() {
            document.getElementById('menu-screen').classList.toggle('active');
        }

        function hideMenu() {
            document.getElementById('menu-screen').classList.remove('active');
        }

        // Обновить статистику с течением времени
        function updateStatsOverTime() {
            const now = Date.now();
            const timePassed = now - gameState.lastUpdateTime;
            const minutesPassed = timePassed / (1000 * 60);
            
            if (minutesPassed > 0) {
                gameState.pets.forEach(pet => {
                    // Уменьшаем показатели со временем
                    const decayRate = Math.min(5 * minutesPassed, 30);
                    pet.hunger = Math.max(0, pet.hunger - decayRate);
                    pet.energy = Math.max(0, pet.energy - decayRate * 0.7);
                    pet.happiness = Math.max(0, pet.happiness - decayRate * 0.5);
                });
                
                gameState.lastUpdateTime = now;
                saveGame();
            }
        }

        // Отрисовать игру
        function renderGame() {
            updateStatsOverTime();
            
            const petsContainer = document.getElementById('pets-container');
            petsContainer.innerHTML = '';
            
            // Обновляем счетчик питомцев
            document.getElementById('pets-count').textContent = 
                `${gameState.pets.length} ${pluralize(gameState.pets.length, 'мишка', 'мишки', 'мишек')}`;
            
            // Рендерим всех питомцев
            gameState.pets.forEach((pet, index) => {
                const petElement = document.createElement('div');
                petElement.className = `pet ${index === gameState.currentPetIndex ? 'active' : ''}`;
                petElement.style.setProperty('--pet-color', pet.color);
                petElement.onclick = () => {
                    gameState.currentPetIndex = index;
                    renderGame();
                };
                
                petElement.innerHTML = `
                    <div class="pet-shape"></div>
                    <div class="pet-stats">
                        <div class="stat">
                            <div class="stat-icon hunger-icon"></div>
                            <div class="stat-bar"><div class="stat-fill hunger-fill" style="width: ${pet.hunger}%"></div></div>
                        </div>
                        <div class="stat">
                            <div class="stat-icon energy-icon"></div>
                            <div class="stat-bar"><div class="stat-fill energy-fill" style="width: ${pet.energy}%"></div></div>
                        </div>
                        <div class="stat">
                            <div class="stat-icon happiness-icon"></div>
                            <div class="stat-bar"><div class="stat-fill happiness-fill" style="width: ${pet.happiness}%"></div></div>
                        </div>
                        <div class="level-info">Уровень ${pet.level}</div>
                        <div class="xp-bar"><div class="xp-fill" style="width: ${(pet.xp / (pet.level * 20)) * 100}%"></div></div>
                    </div>
                `;
                
                petsContainer.appendChild(petElement);
            });
            
            saveGame();
        }

        // Покормить питомца
        function feedPet() {
            const pet = gameState.pets[gameState.currentPetIndex];
            
            if (pet.energy < 10) {
                alert('Мишка слишком устал, чтобы есть!');
                return;
            }
            
            pet.hunger = Math.min(100, pet.hunger + 30);
            pet.energy = Math.max(0, pet.energy - 10);
            addXp(pet, 5);
            
            renderGame();
        }

        // Поиграть с питомцем
        function playWithPet() {
            const pet = gameState.pets[gameState.currentPetIndex];
            
            if (pet.energy < 15 || pet.hunger < 20) {
                alert('Мишка слишком устал или голоден для игр!');
                return;
            }
            
            pet.happiness = Math.min(100, pet.happiness + 25);
            pet.energy = Math.max(0, pet.energy - 15);
            pet.hunger = Math.max(0, pet.hunger - 20);
            addXp(pet, 8);
            
            renderGame();
        }

        // Отдых питомца
        function restPet() {
            const pet = gameState.pets[gameState.currentPetIndex];
            
            pet.energy = Math.min(100, pet.energy + 40);
            pet.happiness = Math.max(0, pet.happiness - 10);
            addXp(pet, 3);
            
            renderGame();
        }

        // Тренировка питомца
        function trainPet() {
            const pet = gameState.pets[gameState.currentPetIndex];
            
            if (pet.energy < 30 || pet.hunger < 30 || pet.happiness < 30) {
                alert('Мишка не готов к тренировке!');
                return;
            }
            
            pet.energy = Math.max(0, pet.energy - 30);
            pet.hunger = Math.max(0, pet.hunger - 30);
            pet.happiness = Math.max(0, pet.happiness - 30);
            addXp(pet, 15);
            
            renderGame();
        }

        // Добавить опыт питомцу
        function addXp(pet, amount) {
            pet.xp += amount;
            
            // Проверяем повышение уровня
            while (pet.xp >= pet.level * 20) {
                pet.xp -= pet.level * 20;
                pet.level++;
                
                // Обновляем максимальный уровень
                const maxLevel = Math.max(...gameState.pets.map(p => p.level));
                pet.maxLevel = maxLevel;
                
                // Проверяем, нужно ли добавить нового питомца
                if (pet.level >= maxLevel + 3 && gameState.pets.length < 10) {
                    const newPet = createNewPet(gameState.pets.length);
                    newPet.maxLevel = pet.level;
                    gameState.pets.push(newPet);
                    alert('Появился новый мишка!');
                }
            }
        }

        // Функция для склонения слов
        function pluralize(number, one, few, many) {
            if (number % 10 === 1 && number % 100 !== 11) {
                return one;
            } else if ([2, 3, 4].includes(number % 10) && ![12, 13, 14].includes(number % 100)) {
                return few;
            } else {
                return many;
            }
        }

        // Инициализация игры при загрузке
        window.onload = initGame;
    </script>
</body>
</html>