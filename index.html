<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Harvest</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }
        
        .container {
            max-width: 100%;
            padding: 10px;
            box-sizing: border-box;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stats {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .stat {
            display: flex;
            align-items: center;
        }
        
        .stat-icon {
            margin-right: 5px;
            font-size: 18px;
        }
        
        .farm {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .plot {
            aspect-ratio: 1/1;
            background-color: #8BC34A;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        .plot-soil {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #5D4037;
            opacity: 0.3;
        }
        
        .crop {
            position: absolute;
            width: 80%;
            height: 80%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            z-index: 2;
        }
        
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 5px;
            background-color: #FFC107;
            z-index: 3;
        }
        
        .shop {
            background-color: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        
        .shop-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #4CAF50;
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .shop-item {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .shop-item:hover {
            background-color: #eee;
        }
        
        .shop-item-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .shop-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .shop-item-price {
            color: #4CAF50;
            font-size: 12px;
        }
        
        .upgrades {
            background-color: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .upgrades-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #4CAF50;
        }
        
        .upgrade {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .upgrade:hover {
            background-color: #eee;
        }
        
        .upgrade-info {
            display: flex;
            flex-direction: column;
        }
        
        .upgrade-name {
            font-weight: bold;
        }
        
        .upgrade-description {
            font-size: 12px;
            color: #666;
        }
        
        .upgrade-price {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            border-bottom: 2px solid #4CAF50;
            color: #4CAF50;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .achievement {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .achievement-icon {
            font-size: 24px;
            margin-right: 10px;
            color: #FFC107;
        }
        
        .achievement-locked {
            color: #ccc;
        }
        
        .achievement-info {
            flex: 1;
        }
        
        .achievement-name {
            font-weight: bold;
        }
        
        .achievement-description {
            font-size: 12px;
            color: #666;
        }
        
        .achievement-reward {
            color: #4CAF50;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="stats">
                <div class="stat">
                    <span class="stat-icon">üí∞</span>
                    <span id="money">0</span>
                </div>
                <div class="stat">
                    <span class="stat-icon">üåæ</span>
                    <span id="harvested">0</span>
                </div>
            </div>
            <div class="stats">
                <div class="stat">
                    <span class="stat-icon">‚è±Ô∏è</span>
                    <span id="growth-speed">1x</span>
                </div>
                <div class="stat">
                    <span class="stat-icon">üìà</span>
                    <span id="income-multiplier">1x</span>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="farm">–§–µ—Ä–º–∞</div>
            <div class="tab" data-tab="shop">–ú–∞–≥–∞–∑–∏–Ω</div>
            <div class="tab" data-tab="upgrades">–£–ª—É—á—à–µ–Ω–∏—è</div>
            <div class="tab" data-tab="achievements">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
        </div>
        
        <div class="tab-content active" id="farm-tab">
            <div class="farm" id="farm">
                <!-- Plots will be generated here -->
            </div>
        </div>
        
        <div class="tab-content" id="shop-tab">
            <div class="shop">
                <div class="shop-title">–°–µ–º–µ–Ω–∞</div>
                <div class="shop-items" id="seeds">
                    <!-- Seed items will be generated here -->
                </div>
            </div>
            <div class="shop">
                <div class="shop-title">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</div>
                <div class="shop-items" id="tools">
                    <!-- Tool items will be generated here -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="upgrades-tab">
            <div class="upgrades">
                <div class="upgrades-title">–£–ª—É—á—à–µ–Ω–∏—è —Ñ–µ—Ä–º—ã</div>
                <div id="farm-upgrades">
                    <!-- Farm upgrades will be generated here -->
                </div>
            </div>
            <div class="upgrades">
                <div class="upgrades-title">–£–ª—É—á—à–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞</div>
                <div id="player-upgrades">
                    <!-- Player upgrades will be generated here -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="achievements-tab">
            <div id="achievements">
                <!-- Achievements will be generated here -->
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <script>
        // Game state
        const gameState = {
            money: 100,
            harvested: 0,
            plots: [],
            seeds: [],
            tools: [],
            farmUpgrades: [],
            playerUpgrades: [],
            achievements: [],
            growthSpeed: 1,
            incomeMultiplier: 1,
            unlockedPlots: 3,
            maxPlots: 9,
            lastSave: Date.now()
        };
        
        // Crop types
        const crops = [
            { id: 1, name: "–ü—à–µ–Ω–∏—Ü–∞", emoji: "üåæ", growthTime: 10, value: 5, seedPrice: 2 },
            { id: 2, name: "–ú–æ—Ä–∫–æ–≤—å", emoji: "ü•ï", growthTime: 15, value: 10, seedPrice: 5 },
            { id: 3, name: "–ö—É–∫—É—Ä—É–∑–∞", emoji: "üåΩ", growthTime: 20, value: 20, seedPrice: 10 },
            { id: 4, name: "–ü–æ–º–∏–¥–æ—Ä", emoji: "üçÖ", growthTime: 25, value: 30, seedPrice: 15 },
            { id: 5, name: "–ë–∞–∫–ª–∞–∂–∞–Ω", emoji: "üçÜ", growthTime: 30, value: 40, seedPrice: 20 },
            { id: 6, name: "–ö–ª—É–±–Ω–∏–∫–∞", emoji: "üçì", growthTime: 35, value: 50, seedPrice: 25 }
        ];
        
        // Tools
        const tools = [
            { id: 1, name: "–õ–µ–π–∫–∞", emoji: "üö∞", price: 50, description: "–£—Å–∫–æ—Ä—è–µ—Ç —Ä–æ—Å—Ç –Ω–∞ 10%", effect: "growth", value: 0.1 },
            { id: 2, name: "–£–¥–æ–±—Ä–µ–Ω–∏–µ", emoji: "üß™", price: 100, description: "–£—Å–∫–æ—Ä—è–µ—Ç —Ä–æ—Å—Ç –Ω–∞ 25%", effect: "growth", value: 0.25 },
            { id: 3, name: "–¢—Ä–∞–∫—Ç–æ—Ä", emoji: "üöú", price: 200, description: "–£—Å–∫–æ—Ä—è–µ—Ç —Ä–æ—Å—Ç –Ω–∞ 50%", effect: "growth", value: 0.5 }
        ];
        
        // Farm upgrades
        const farmUpgrades = [
            { id: 1, name: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≥—Ä—è–¥–∫–∞", price: 100, description: "–û—Ç–∫—Ä—ã–≤–∞–µ—Ç 1 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –≥—Ä—è–¥–∫—É", maxLevel: 6, effect: "plot" },
            { id: 2, name: "–ü–ª–æ–¥–æ—Ä–æ–¥–Ω–∞—è –ø–æ—á–≤–∞", price: 150, description: "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ –Ω–∞ 20%", maxLevel: 5, effect: "growth", value: 0.2 },
            { id: 3, name: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–º–µ–Ω–∞", price: 200, description: "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –æ—Ç —É—Ä–æ–∂–∞—è –Ω–∞ 25%", maxLevel: 4, effect: "income", value: 0.25 }
        ];
        
        // Player upgrades
        const playerUpgrades = [
            { id: 1, name: "–ù–∞–≤—ã–∫ —Ñ–µ—Ä–º–µ—Ä–∞", price: 300, description: "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –æ—Ç –≤—Å–µ—Ö –∫—É–ª—å—Ç—É—Ä –Ω–∞ 10%", maxLevel: 10, effect: "income", value: 0.1 },
            { id: 2, name: "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", price: 500, description: "–£–º–µ–Ω—å—à–∞–µ—Ç –≤—Ä–µ–º—è —Ä–æ—Å—Ç–∞ –Ω–∞ 15%", maxLevel: 5, effect: "growth", value: 0.15 }
        ];
        
        // Achievements
        const achievements = [
            { id: 1, name: "–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏", description: "–ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ 100 –º–æ–Ω–µ—Ç", reward: "+50 –º–æ–Ω–µ—Ç", target: 100, rewardType: "money", rewardValue: 50, emoji: "üë£", unlocked: false },
            { id: 2, name: "–ù–∞—á–∏–Ω–∞—é—â–∏–π —Ñ–µ—Ä–º–µ—Ä", description: "–°–æ–±–µ—Ä–∏—Ç–µ 50 —É—Ä–æ–∂–∞–µ–≤", reward: "+1 –≥—Ä—è–¥–∫–∞", target: 50, rewardType: "plot", rewardValue: 1, emoji: "üë®‚Äçüåæ", unlocked: false },
            { id: 3, name: "–û–ø—ã—Ç–Ω—ã–π —Ñ–µ—Ä–º–µ—Ä", description: "–ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ 1000 –º–æ–Ω–µ—Ç", reward: "+100 –º–æ–Ω–µ—Ç", target: 1000, rewardType: "money", rewardValue: 100, emoji: "üßë‚Äçüåæ", unlocked: false },
            { id: 4, name: "–ú–∞—Å—Ç–µ—Ä —É—Ä–æ–∂–∞—è", description: "–°–æ–±–µ—Ä–∏—Ç–µ 200 —É—Ä–æ–∂–∞–µ–≤", reward: "x2 –¥–æ—Ö–æ–¥", target: 200, rewardType: "income", rewardValue: 2, emoji: "üë®‚Äçüî¨", unlocked: false },
            { id: 5, name: "–ó–æ–ª–æ—Ç—ã–µ —Ä—É–∫–∏", description: "–ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ 5000 –º–æ–Ω–µ—Ç", reward: "+500 –º–æ–Ω–µ—Ç", target: 5000, rewardType: "money", rewardValue: 500, emoji: "üèÜ", unlocked: false }
        ];
        
        // Initialize game
        function initGame() {
            // Initialize plots
            for (let i = 0; i < gameState.maxPlots; i++) {
                gameState.plots.push({
                    id: i,
                    planted: false,
                    crop: null,
                    progress: 0,
                    growthStart: 0,
                    tool: null
                });
            }
            
            // Initialize seeds
            gameState.seeds = [...crops];
            
            // Initialize tools
            gameState.tools = [...tools];
            
            // Initialize farm upgrades
            gameState.farmUpgrades = farmUpgrades.map(upgrade => ({
                ...upgrade,
                level: 0
            }));
            
            // Initialize player upgrades
            gameState.playerUpgrades = playerUpgrades.map(upgrade => ({
                ...upgrade,
                level: 0
            }));
            
            // Initialize achievements
            gameState.achievements = [...achievements];
            
            // Load saved game
            loadGame();
            
            // Render game
            renderFarm();
            renderSeeds();
            renderTools();
            renderFarmUpgrades();
            renderPlayerUpgrades();
            renderAchievements();
            updateStats();
            
            // Start game loop
            setInterval(gameLoop, 1000);
            
            // Initialize Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.enableClosingConfirmation();
            }
        }
        
        // Game loop
        function gameLoop() {
            let changed = false;
            
            // Update crops growth
            gameState.plots.forEach(plot => {
                if (plot.planted && plot.progress < 1) {
                    const growthRate = gameState.growthSpeed;
                    const elapsed = (Date.now() - plot.growthStart) / 1000;
                    const totalTime = plot.crop.growthTime / growthRate;
                    plot.progress = Math.min(elapsed / totalTime, 1);
                    changed = true;
                }
            });
            
            // Auto-save every 30 seconds
            if (Date.now() - gameState.lastSave > 30000) {
                saveGame();
                gameState.lastSave = Date.now();
            }
            
            if (changed) {
                renderFarm();
            }
        }
        
        // Render farm plots
        function renderFarm() {
            const farmElement = document.getElementById('farm');
            farmElement.innerHTML = '';
            
            for (let i = 0; i < gameState.unlockedPlots; i++) {
                const plot = gameState.plots[i];
                const plotElement = document.createElement('div');
                plotElement.className = 'plot';
                plotElement.onclick = () => handlePlotClick(i);
                
                // Add soil background
                const soilElement = document.createElement('div');
                soilElement.className = 'plot-soil';
                plotElement.appendChild(soilElement);
                
                if (plot.planted) {
                    // Add crop
                    const cropElement = document.createElement('div');
                    cropElement.className = 'crop';
                    cropElement.textContent = plot.crop.emoji;
                    plotElement.appendChild(cropElement);
                    
                    // Add progress bar
                    const progressElement = document.createElement('div');
                    progressElement.className = 'progress-bar';
                    progressElement.style.width = `${plot.progress * 100}%`;
                    plotElement.appendChild(progressElement);
                    
                    // Add tool effect if present
                    if (plot.tool) {
                        const toolElement = document.createElement('div');
                        toolElement.style.position = 'absolute';
                        toolElement.style.top = '5px';
                        toolElement.style.right = '5px';
                        toolElement.style.fontSize = '14px';
                        toolElement.textContent = plot.tool.emoji;
                        plotElement.appendChild(toolElement);
                    }
                    
                    // Check if crop is ready
                    if (plot.progress >= 1) {
                        plotElement.style.boxShadow = '0 0 10px gold';
                    }
                } else {
                    // Empty plot
                    plotElement.textContent = '‚ûï';
                }
                
                farmElement.appendChild(plotElement);
            }
        }
        
        // Render seed shop
        function renderSeeds() {
            const seedsElement = document.getElementById('seeds');
            seedsElement.innerHTML = '';
            
            gameState.seeds.forEach(seed => {
                const seedElement = document.createElement('div');
                seedElement.className = 'shop-item';
                seedElement.onclick = () => buySeed(seed.id);
                
                seedElement.innerHTML = `
                    <div class="shop-item-icon">${seed.emoji}</div>
                    <div class="shop-item-name">${seed.name}</div>
                    <div class="shop-item-price">${seed.seedPrice} –º–æ–Ω–µ—Ç</div>
                `;
                
                seedsElement.appendChild(seedElement);
            });
        }
        
        // Render tools shop
        function renderTools() {
            const toolsElement = document.getElementById('tools');
            toolsElement.innerHTML = '';
            
            gameState.tools.forEach(tool => {
                const toolElement = document.createElement('div');
                toolElement.className = 'shop-item';
                toolElement.onclick = () => buyTool(tool.id);
                
                toolElement.innerHTML = `
                    <div class="shop-item-icon">${tool.emoji}</div>
                    <div class="shop-item-name">${tool.name}</div>
                    <div class="shop-item-description">${tool.description}</div>
                    <div class="shop-item-price">${tool.price} –º–æ–Ω–µ—Ç</div>
                `;
                
                toolsElement.appendChild(toolElement);
            });
        }
        
        // Render farm upgrades
        function renderFarmUpgrades() {
            const upgradesElement = document.getElementById('farm-upgrades');
            upgradesElement.innerHTML = '';
            
            gameState.farmUpgrades.forEach(upgrade => {
                const upgradeElement = document.createElement('div');
                upgradeElement.className = 'upgrade';
                upgradeElement.onclick = () => buyFarmUpgrade(upgrade.id);
                
                const maxed = upgrade.level >= upgrade.maxLevel;
                const price = Math.floor(upgrade.price * Math.pow(1.5, upgrade.level));
                
                upgradeElement.innerHTML = `
                    <div class="upgrade-info">
                        <div class="upgrade-name">${upgrade.name} ${upgrade.level > 0 ? `(${upgrade.level}/${upgrade.maxLevel})` : ''}</div>
                        <div class="upgrade-description">${upgrade.description}</div>
                    </div>
                    <div class="upgrade-price">${maxed ? 'MAX' : price + ' –º–æ–Ω–µ—Ç'}</div>
                `;
                
                if (maxed) {
                    upgradeElement.style.opacity = '0.7';
                    upgradeElement.style.cursor = 'default';
                }
                
                upgradesElement.appendChild(upgradeElement);
            });
        }
        
        // Render player upgrades
        function renderPlayerUpgrades() {
            const upgradesElement = document.getElementById('player-upgrades');
            upgradesElement.innerHTML = '';
            
            gameState.playerUpgrades.forEach(upgrade => {
                const upgradeElement = document.createElement('div');
                upgradeElement.className = 'upgrade';
                upgradeElement.onclick = () => buyPlayerUpgrade(upgrade.id);
                
                const maxed = upgrade.level >= upgrade.maxLevel;
                const price = Math.floor(upgrade.price * Math.pow(1.5, upgrade.level));
                
                upgradeElement.innerHTML = `
                    <div class="upgrade-info">
                        <div class="upgrade-name">${upgrade.name} ${upgrade.level > 0 ? `(${upgrade.level}/${upgrade.maxLevel})` : ''}</div>
                        <div class="upgrade-description">${upgrade.description}</div>
                    </div>
                    <div class="upgrade-price">${maxed ? 'MAX' : price + ' –º–æ–Ω–µ—Ç'}</div>
                `;
                
                if (maxed) {
                    upgradeElement.style.opacity = '0.7';
                    upgradeElement.style.cursor = 'default';
                }
                
                upgradesElement.appendChild(upgradeElement);
            });
        }
        
        // Render achievements
        function renderAchievements() {
            const achievementsElement = document.getElementById('achievements');
            achievementsElement.innerHTML = '';
            
            gameState.achievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = 'achievement';
                
                if (achievement.unlocked) {
                    achievementElement.innerHTML = `
                        <div class="achievement-icon">${achievement.emoji}</div>
                        <div class="achievement-info">
                            <div class="achievement-name">${achievement.name}</div>
                            <div class="achievement-description">${achievement.description}</div>
                        </div>
                        <div class="achievement-reward">${achievement.reward}</div>
                    `;
                } else {
                    achievementElement.innerHTML = `
                        <div class="achievement-icon achievement-locked">üîí</div>
                        <div class="achievement-info">
                            <div class="achievement-name">???</div>
                            <div class="achievement-description">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</div>
                        </div>
                    `;
                }
                
                achievementsElement.appendChild(achievementElement);
            });
        }
        
        // Update stats display
        function updateStats() {
            document.getElementById('money').textContent = gameState.money;
            document.getElementById('harvested').textContent = gameState.harvested;
            document.getElementById('growth-speed').textContent = gameState.growthSpeed.toFixed(1) + 'x';
            document.getElementById('income-multiplier').textContent = gameState.incomeMultiplier.toFixed(1) + 'x';
        }
        
        // Handle plot click
        function handlePlotClick(plotId) {
            const plot = gameState.plots[plotId];
            
            if (plot.planted) {
                if (plot.progress >= 1) {
                    // Harvest crop
                    harvestCrop(plotId);
                } else {
                    // Crop is growing
                    showNotification('–ï—â—ë –Ω–µ –≤—ã—Ä–æ—Å–ª–æ!');
                }
            } else {
                // Plot is empty - open seed selection
                showSeedSelection(plotId);
            }
        }
        
        // Show seed selection
        function showSeedSelection(plotId) {
            // In a real Telegram Web App, you would use their popup interface
            // For this example, we'll just show a notification with the first seed
            if (gameState.money >= gameState.seeds[0].seedPrice) {
                plantCrop(plotId, gameState.seeds[0].id);
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
            }
        }
        
        // Plant a crop
        function plantCrop(plotId, cropId) {
            const plot = gameState.plots[plotId];
            const crop = gameState.seeds.find(s => s.id === cropId);
            
            if (gameState.money >= crop.seedPrice) {
                gameState.money -= crop.seedPrice;
                plot.planted = true;
                plot.crop = crop;
                plot.progress = 0;
                plot.growthStart = Date.now();
                plot.tool = null;
                
                updateStats();
                renderFarm();
                showNotification(`–ü–æ—Å–∞–∂–µ–Ω–æ: ${crop.name}`);
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
            }
        }
        
        // Harvest a crop
        function harvestCrop(plotId) {
            const plot = gameState.plots[plotId];
            
            if (plot.planted && plot.progress >= 1) {
                const value = Math.floor(plot.crop.value * gameState.incomeMultiplier);
                gameState.money += value;
                gameState.harvested++;
                
                plot.planted = false;
                plot.crop = null;
                plot.progress = 0;
                plot.growthStart = 0;
                plot.tool = null;
                
                updateStats();
                renderFarm();
                showNotification(`–°–æ–±—Ä–∞–Ω–æ: +${value} –º–æ–Ω–µ—Ç`);
                
                // Check achievements
                checkAchievements();
            }
        }
        
        // Buy seed
        function buySeed(seedId) {
            showNotification('–°–µ–º–µ–Ω–∞ –ø–æ–∫—É–ø–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–æ—Å–∞–¥–∫–µ');
        }
        
        // Buy tool
        function buyTool(toolId) {
            const tool = gameState.tools.find(t => t.id === toolId);
            
            if (gameState.money >= tool.price) {
                gameState.money -= tool.price;
                
                // Find first plot with a crop but no tool
                const plot = gameState.plots.find(p => p.planted && !p.tool);
                
                if (plot) {
                    plot.tool = tool;
                    
                    // Apply tool effect
                    if (tool.effect === 'growth') {
                        const growthRate = 1 + tool.value;
                        plot.growthStart = Date.now() - (Date.now() - plot.growthStart) / growthRate;
                    }
                    
                    renderFarm();
                    showNotification(`–ü—Ä–∏–º–µ–Ω–µ–Ω–æ: ${tool.name}`);
                } else {
                    showNotification('–ù–µ—Ç –≥—Ä—è–¥–æ–∫ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞');
                }
                
                updateStats();
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
            }
        }
        
        // Buy farm upgrade
        function buyFarmUpgrade(upgradeId) {
            const upgrade = gameState.farmUpgrades.find(u => u.id === upgradeId);
            
            if (upgrade.level >= upgrade.maxLevel) return;
            
            const price = Math.floor(upgrade.price * Math.pow(1.5, upgrade.level));
            
            if (gameState.money >= price) {
                gameState.money -= price;
                upgrade.level++;
                
                // Apply upgrade effect
                if (upgrade.effect === 'plot') {
                    gameState.unlockedPlots = Math.min(3 + upgrade.level, gameState.maxPlots);
                } else if (upgrade.effect === 'growth') {
                    gameState.growthSpeed = 1 + (upgrade.value * upgrade.level);
                } else if (upgrade.effect === 'income') {
                    gameState.incomeMultiplier = 1 + (upgrade.value * upgrade.level);
                }
                
                renderFarmUpgrades();
                updateStats();
                renderFarm();
                showNotification(`–ö—É–ø–ª–µ–Ω–æ: ${upgrade.name}`);
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
            }
        }
        
        // Buy player upgrade
        function buyPlayerUpgrade(upgradeId) {
            const upgrade = gameState.playerUpgrades.find(u => u.id === upgradeId);
            
            if (upgrade.level >= upgrade.maxLevel) return;
            
            const price = Math.floor(upgrade.price * Math.pow(1.5, upgrade.level));
            
            if (gameState.money >= price) {
                gameState.money -= price;
                upgrade.level++;
                
                // Apply upgrade effect
                if (upgrade.effect === 'income') {
                    gameState.incomeMultiplier = 1 + (upgrade.value * upgrade.level);
                } else if (upgrade.effect === 'growth') {
                    gameState.growthSpeed = 1 + (upgrade.value * upgrade.level);
                }
                
                renderPlayerUpgrades();
                updateStats();
                showNotification(`–ö—É–ø–ª–µ–Ω–æ: ${upgrade.name}`);
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
            }
        }
        
        // Check achievements
        function checkAchievements() {
            gameState.achievements.forEach(achievement => {
                if (!achievement.unlocked) {
                    let targetMet = false;
                    
                    if (achievement.name === "–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏" && gameState.money >= achievement.target) {
                        targetMet = true;
                    } else if (achievement.name === "–ù–∞—á–∏–Ω–∞—é—â–∏–π —Ñ–µ—Ä–º–µ—Ä" && gameState.harvested >= achievement.target) {
                        targetMet = true;
                    } else if (achievement.name === "–û–ø—ã—Ç–Ω—ã–π —Ñ–µ—Ä–º–µ—Ä" && gameState.money >= achievement.target) {
                        targetMet = true;
                    } else if (achievement.name === "–ú–∞—Å—Ç–µ—Ä —É—Ä–æ–∂–∞—è" && gameState.harvested >= achievement.target) {
                        targetMet = true;
                    } else if (achievement.name === "–ó–æ–ª–æ—Ç—ã–µ —Ä—É–∫–∏" && gameState.money >= achievement.target) {
                        targetMet = true;
                    }
                    
                    if (targetMet) {
                        achievement.unlocked = true;
                        
                        // Apply reward
                        if (achievement.rewardType === 'money') {
                            gameState.money += achievement.rewardValue;
                        } else if (achievement.rewardType === 'plot') {
                            gameState.unlockedPlots = Math.min(gameState.unlockedPlots + achievement.rewardValue, gameState.maxPlots);
                        } else if (achievement.rewardType === 'income') {
                            gameState.incomeMultiplier *= achievement.rewardValue;
                        }
                        
                        showNotification(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${achievement.name}!`);
                        updateStats();
                        renderFarm();
                        renderAchievements();
                    }
                }
            });
        }
        
        // Show notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.opacity = '1';
            
            setTimeout(() => {
                notification.style.opacity = '0';
            }, 2000);
        }
        
        // Save game
        function saveGame() {
            const saveData = JSON.stringify(gameState);
            localStorage.setItem('happyHarvestSave', saveData);
        }
        
        // Load game
        function loadGame() {
            const saveData = localStorage.getItem('happyHarvestSave');
            if (saveData) {
                const savedState = JSON.parse(saveData);
                
                // Merge saved state with default state
                Object.keys(savedState).forEach(key => {
                    gameState[key] = savedState[key];
                });
                
                // Make sure we have all plots
                while (gameState.plots.length < gameState.maxPlots) {
                    gameState.plots.push({
                        id: gameState.plots.length,
                        planted: false,
                        crop: null,
                        progress: 0,
                        growthStart: 0,
                        tool: null
                    });
                }
                
                showNotification('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            }
        }
        
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // Initialize game when loaded
        window.onload = initGame;
    </script>
</body>
</html>
