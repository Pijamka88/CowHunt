<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–ø–∏–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --medieval-dark: #3a2c21;
            --medieval-light: #d9c7b8;
            --medieval-red: #8b2e1d;
            --medieval-gold: #c9a66b;
            --medieval-blue: #3a5e8c;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background-color: var(--medieval-light);
            color: var(--medieval-dark);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%233a2c21" fill-opacity="0.05" d="M0 0h100v100H0z"/><path fill="none" stroke="%233a2c21" stroke-opacity="0.1" stroke-width="1" d="M0 0h100v100H0z"/></svg>');
            background-size: 100px 100px;
        }
        
        .container {
            padding: 15px;
            max-width: 100%;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: var(--medieval-dark);
            color: var(--medieval-gold);
            border-bottom: 3px solid var(--medieval-gold);
        }
        
        .game-title {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 0px var(--medieval-red);
        }
        
        .pets-count {
            background-color: var(--medieval-red);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            border: 2px solid var(--medieval-gold);
        }
        
        .pets-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .pet-card {
            background-color: var(--medieval-light);
            border: 3px solid var(--medieval-dark);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 3px 3px 0px rgba(0,0,0,0.2);
            position: relative;
            transition: transform 0.2s;
        }
        
        .pet-card:hover {
            transform: translateY(-3px);
        }
        
        .pet-card-selected {
            border-color: var(--medieval-gold);
            box-shadow: 0 0 10px var(--medieval-gold);
        }
        
        .pet-image {
            font-size: 50px;
            text-align: center;
            margin: 10px 0;
        }
        
        .pet-level {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: var(--medieval-red);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid var(--medieval-gold);
        }
        
        .pet-evolution {
            font-size: 12px;
            text-align: center;
            margin-top: 5px;
            color: var(--medieval-blue);
            font-weight: bold;
        }
        
        .stats-container {
            margin-top: 10px;
        }
        
        .stat {
            margin-bottom: 8px;
        }
        
        .stat-label {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
            font-size: 12px;
        }
        
        .stat-icon {
            margin-right: 5px;
            font-size: 14px;
        }
        
        .stat-bar-container {
            height: 12px;
            background-color: var(--medieval-dark);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .stat-bar {
            height: 100%;
            border-radius: 6px;
        }
        
        .hunger-bar {
            background-color: #e67e22;
        }
        
        .energy-bar {
            background-color: #f1c40f;
        }
        
        .happiness-bar {
            background-color: #2ecc71;
        }
        
        .hygiene-bar {
            background-color: #3498db;
        }
        
        .xp-bar-container {
            height: 5px;
            background-color: var(--medieval-dark);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 3px;
        }
        
        .xp-bar {
            height: 100%;
            background-color: var(--medieval-gold);
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        
        .action-btn {
            padding: 8px;
            background-color: var(--medieval-dark);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Times New Roman', serif;
        }
        
        .action-btn:hover {
            background-color: var(--medieval-blue);
            transform: translateY(-2px);
        }
        
        .action-btn:active {
            transform: translateY(0);
        }
        
        .action-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        .log-container {
            height: 120px;
            overflow-y: auto;
            background-color: var(--medieval-light);
            border: 2px solid var(--medieval-dark);
            border-radius: 5px;
            padding: 10px;
            margin-top: 15px;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px dashed var(--medieval-dark);
        }
        
        .log-time {
            color: var(--medieval-blue);
            font-size: 10px;
            margin-right: 5px;
        }
        
        .evolution-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--medieval-gold);
            color: var(--medieval-dark);
            padding: 20px;
            border-radius: 10px;
            border: 3px solid var(--medieval-red);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            z-index: 100;
            text-align: center;
            max-width: 80%;
            display: none;
        }
        
        .evolution-emoji {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .close-evolution-btn {
            margin-top: 10px;
            padding: 5px 10px;
            background-color: var(--medieval-red);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        @media (max-width: 600px) {
            .pets-container {
                grid-template-columns: 1fr 1fr;
            }
            
            .actions {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ –∏–≥—Ä—ã -->
        <div class="header">
            <div class="game-title">–¢–∞–ø–∏–∫–∏</div>
            <div class="pets-count" id="pets-count">1</div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø–∏—Ç–æ–º—Ü–∞–º–∏ -->
        <div class="pets-container" id="pets-container">
            <!-- –ü–∏—Ç–æ–º—Ü—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
        <div class="log-container" id="game-log">
            <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç–≤–æ–ª—é—Ü–∏–∏ -->
        <div class="evolution-notification" id="evolution-notification">
            <div class="evolution-emoji" id="evolution-emoji">üêª</div>
            <h3 id="evolution-title">–≠–≤–æ–ª—é—Ü–∏—è!</h3>
            <p id="evolution-text">–í–∞—à –ø–∏—Ç–æ–º–µ—Ü —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª!</p>
            <button class="close-evolution-btn" id="close-evolution-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const STATS = {
            HUNGER: 'hunger',
            ENERGY: 'energy',
            HAPPINESS: 'happiness',
            HYGIENE: 'hygiene'
        };

        const EVOLUTION_STAGES = [
            { level: 0, name: "–ú–∞–ª—ã—à", emoji: "üêª", nextLevel: 3, color: "#FF9999" },
            { level: 3, name: "–ü–æ–¥—Ä–æ—Å—Ç–æ–∫", emoji: "üêª", nextLevel: 6, color: "#FF6666" },
            { level: 6, name: "–í–∑—Ä–æ—Å–ª—ã–π", emoji: "üêª", nextLevel: 9, color: "#FF3333" },
            { level: 9, name: "–ú–∞—Å—Ç–µ—Ä", emoji: "üêª", nextLevel: 12, color: "#FF0000" },
            { level: 12, name: "–õ–µ–≥–µ–Ω–¥–∞", emoji: "üêª", nextLevel: null, color: "#CC0000" }
        ];

        const EVOLUTION_TRAITS = [
            {
                name: "–°–∏–ª–∞—á",
                description: "–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –∏ —Å–∏–ª–∞",
                modifiers: {
                    energyDecay: 0.8,
                    energyGain: 1.2
                }
            },
            {
                name: "–£–º–Ω–∏–∫",
                description: "–ë—ã—Å—Ç—Ä–µ–µ –ø–æ–ª—É—á–∞–µ—Ç –æ–ø—ã—Ç",
                modifiers: {
                    xpGain: 1.5
                }
            },
            {
                name: "–í–µ—Å–µ–ª—å—á–∞–∫",
                description: "–ë—ã—Å—Ç—Ä–µ–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
                modifiers: {
                    happinessDecay: 0.7,
                    happinessGain: 1.3
                }
            },
            {
                name: "–ß–∏—Å—Ç—é–ª—è",
                description: "–î–æ–ª—å—à–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–∏—Å—Ç–æ—Ç—É",
                modifiers: {
                    hygieneDecay: 0.6
                }
            },
            {
                name: "–û–±–∂–æ—Ä–∞",
                description: "–ë—ã—Å—Ç—Ä–µ–µ –Ω–∞—Å—ã—â–∞–µ—Ç—Å—è",
                modifiers: {
                    hungerDecay: 1.2,
                    hungerGain: 1.3
                }
            }
        ];

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            pets: [],
            selectedPetId: null,
            gameStarted: false,
            lastUpdateTime: Date.now()
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const petsContainer = document.getElementById('pets-container');
        const gameLog = document.getElementById('game-log');
        const petsCountElement = document.getElementById('pets-count');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —ç–≤–æ–ª—é—Ü–∏–∏
        const evolutionNotification = document.getElementById('evolution-notification');
        const evolutionEmoji = document.getElementById('evolution-emoji');
        const evolutionTitle = document.getElementById('evolution-title');
        const evolutionText = document.getElementById('evolution-text');
        const closeEvolutionBtn = document.getElementById('close-evolution-btn');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGame();
            setupEventListeners();
            renderPets();
            
            // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã, –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é
            if (!gameState.gameStarted) {
                startNewGame();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            setInterval(gameLoop, 1000);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.enableClosingConfirmation();
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            closeEvolutionBtn.addEventListener('click', () => {
                evolutionNotification.style.display = 'none';
            });
        }

        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameState.gameStarted) return;
            
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdateTime) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdateTime = now;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ—Ö –ø–∏—Ç–æ–º—Ü–µ–≤
            gameState.pets.forEach(pet => {
                // –£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
                decayStats(pet, deltaTime);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —ç–≤–æ–ª—é—Ü–∏—é
                checkEvolution(pet);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ
                checkReproduction(pet);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É
            saveGame();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
        }

        // –£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
        function decayStats(pet, deltaTime) {
            const decayRate = 0.5; // –±–∞–∑–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–º–µ–Ω—å—à–µ–Ω–∏—è (% –≤ –º–∏–Ω—É—Ç—É)
            const decayAmount = decayRate * deltaTime / 60;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
            const hungerDecay = decayAmount * (pet.traits?.hungerDecay || 1);
            const energyDecay = decayAmount * (pet.traits?.energyDecay || 1);
            const happinessDecay = decayAmount * (pet.traits?.happinessDecay || 1);
            const hygieneDecay = decayAmount * (pet.traits?.hygieneDecay || 1);
            
            pet.stats.hunger = Math.max(0, pet.stats.hunger - hungerDecay);
            pet.stats.energy = Math.max(0, pet.stats.energy - energyDecay);
            pet.stats.happiness = Math.max(0, pet.stats.happiness - happinessDecay);
            pet.stats.hygiene = Math.max(0, pet.stats.hygiene - hygieneDecay);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–º–µ—Ä—Ç—å –æ—Ç –≥–æ–ª–æ–¥–∞
            if (pet.stats.hunger <= 0) {
                addLogMessage(`–û–¥–∏–Ω –∏–∑ —Ç–∞–ø–∏–∫–æ–≤ —É–º–µ—Ä –æ—Ç –≥–æ–ª–æ–¥–∞!`, true);
                removePet(pet.id);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —ç–≤–æ–ª—é—Ü–∏—é
        function checkEvolution(pet) {
            const currentStage = getCurrentEvolutionStage(pet);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥ –ª–∏ –ø–∏—Ç–æ–º–µ—Ü —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —ç–≤–æ–ª—é—Ü–∏–∏
            if (currentStage.nextLevel && pet.level >= currentStage.nextLevel && pet.evolutionStage < EVOLUTION_STAGES.length - 1) {
                // –ü–æ–≤—ã—à–∞–µ–º —Å—Ç–∞–¥–∏—é —ç–≤–æ–ª—é—Ü–∏–∏
                pet.evolutionStage += 1;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—É—é —á–µ—Ä—Ç—É –ø—Ä–∏ —ç–≤–æ–ª—é—Ü–∏–∏
                if (pet.traits.length < 3) { // –ú–∞–∫—Å–∏–º—É–º 3 —á–µ—Ä—Ç—ã
                    const availableTraits = EVOLUTION_TRAITS.filter(t => !pet.traits.some(pt => pt.name === t.name));
                    if (availableTraits.length > 0) {
                        const newTrait = availableTraits[Math.floor(Math.random() * availableTraits.length)];
                        pet.traits.push(newTrait);
                    }
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showEvolutionNotification(pet);
                
                addLogMessage(`–¢–∞–ø–∏–∫ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª –≤ ${EVOLUTION_STAGES[pet.evolutionStage].name}!`, true);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç–≤–æ–ª—é—Ü–∏–∏
        function showEvolutionNotification(pet) {
            const stage = EVOLUTION_STAGES[pet.evolutionStage];
            evolutionEmoji.textContent = stage.emoji;
            evolutionEmoji.style.color = stage.color;
            evolutionTitle.textContent = "–≠–≤–æ–ª—é—Ü–∏—è!";
            
            const lastTrait = pet.traits[pet.traits.length - 1];
            if (lastTrait) {
                evolutionText.innerHTML = `–¢–∞–ø–∏–∫ –¥–æ—Å—Ç–∏–≥ —Å—Ç–∞–¥–∏–∏ <strong>${stage.name}</strong> –∏ –ø–æ–ª—É—á–∏–ª —á–µ—Ä—Ç—É <strong>${lastTrait.name}</strong>: ${lastTrait.description}`;
            } else {
                evolutionText.innerHTML = `–¢–∞–ø–∏–∫ –¥–æ—Å—Ç–∏–≥ —Å—Ç–∞–¥–∏–∏ <strong>${stage.name}</strong>`;
            }
            
            evolutionNotification.style.display = 'block';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ
        function checkReproduction(pet) {
            // –ü–∏—Ç–æ–º–µ—Ü –º–æ–∂–µ—Ç —Ä–∞–∑–º–Ω–æ–∂–∞—Ç—å—Å—è, –µ—Å–ª–∏ –æ–Ω –≤–∑—Ä–æ—Å–ª—ã–π (—É—Ä–æ–≤–µ–Ω—å 3+) –∏ —Å—á–∞—Å—Ç–ª–∏–≤
            if (pet.level >= 3 && pet.stats.happiness > 70 && 
                gameState.pets.length < 12 && Math.random() < 0.001) {
                reproducePet(pet);
            }
        }

        // –†–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
        function reproducePet(parentPet) {
            const newPet = {
                id: generateId(),
                level: 1,
                xp: 0,
                evolutionStage: 0,
                traits: [...parentPet.traits],
                stats: {
                    hunger: 70,
                    energy: 70,
                    happiness: 70,
                    hygiene: 70
                }
            };
            
            gameState.pets.push(newPet);
            addLogMessage(`–ü–æ—è–≤–∏–ª—Å—è –Ω–æ–≤—ã–π —Ç–∞–ø–∏–∫! –¢–µ–ø–µ—Ä—å –∏—Ö ${gameState.pets.length}.`, true);
        }

        // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
        function startNewGame() {
            gameState.pets = [createNewPet()];
            gameState.selectedPetId = gameState.pets[0].id;
            gameState.gameStarted = true;
            gameState.lastUpdateTime = Date.now();
            
            addLogMessage(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –¢–∞–ø–∏–∫–æ–≤!`, true);
            addLogMessage(`–ü–æ—è–≤–∏–ª—Å—è –ø–µ—Ä–≤—ã–π —Ç–∞–ø–∏–∫!`, true);
            saveGame();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
        function createNewPet() {
            return {
                id: generateId(),
                level: 1,
                xp: 0,
                evolutionStage: 0,
                traits: [],
                stats: {
                    hunger: 70,
                    energy: 70,
                    happiness: 70,
                    hygiene: 70
                }
            };
        }

        // –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–∏—Ç–æ–º—Ü–µ–º
        function interactWithPet(petId, action) {
            const pet = gameState.pets.find(p => p.id === petId);
            if (!pet) return;
            
            let xpGain = 0;
            let message = "";
            
            switch (action) {
                case 'feed':
                    pet.stats.hunger = Math.min(100, pet.stats.hunger + 20 * (pet.traits?.hungerGain || 1));
                    xpGain = 5;
                    message = "–¢–∞–ø–∏–∫ –ø–æ–∫–æ—Ä–º–ª–µ–Ω";
                    break;
                case 'sleep':
                    pet.stats.energy = Math.min(100, pet.stats.energy + 20 * (pet.traits?.energyGain || 1));
                    xpGain = 5;
                    message = "–¢–∞–ø–∏–∫ –ø–æ—Å–ø–∞–ª";
                    break;
                case 'play':
                    pet.stats.happiness = Math.min(100, pet.stats.happiness + 20 * (pet.traits?.happinessGain || 1));
                    pet.stats.energy = Math.max(0, pet.stats.energy - 5);
                    xpGain = 7;
                    message = "–í—ã –ø–æ–∏–≥—Ä–∞–ª–∏ —Å —Ç–∞–ø–∏–∫–æ–º";
                    break;
                case 'clean':
                    pet.stats.hygiene = Math.min(100, pet.stats.hygiene + 20);
                    xpGain = 5;
                    message = "–¢–∞–ø–∏–∫ –ø–æ–º—ã—Ç";
                    break;
                case 'train':
                    pet.stats.energy = Math.max(0, pet.stats.energy - 10);
                    pet.stats.happiness = Math.max(0, pet.stats.happiness - 5);
                    xpGain = 15 * (pet.traits?.xpGain || 1);
                    message = "–¢–∞–ø–∏–∫ –ø–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–Ω";
                    break;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—ã—Ç
            if (xpGain > 0) {
                pet.xp += xpGain;
                checkLevelUp(pet);
            }
            
            addLogMessage(message);
            saveGame();
            updateUI();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function checkLevelUp(pet) {
            const xpNeeded = pet.level * 50;
            if (pet.xp >= xpNeeded) {
                pet.xp -= xpNeeded;
                pet.level += 1;
                addLogMessage(`–¢–∞–ø–∏–∫ –¥–æ—Å—Ç–∏–≥ —É—Ä–æ–≤–Ω—è ${pet.level}!`, true);
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
        function removePet(petId) {
            gameState.pets = gameState.pets.filter(pet => pet.id !== petId);
            if (gameState.selectedPetId === petId) {
                gameState.selectedPetId = gameState.pets.length > 0 ? gameState.pets[0].id : null;
            }
            saveGame();
            updateUI();
        }

        // –í—ã–±–æ—Ä –ø–∏—Ç–æ–º—Ü–∞
        function selectPet(petId) {
            gameState.selectedPetId = petId;
            updateUI();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            renderPets();
            petsCountElement.textContent = gameState.pets.length;
        }

        // –†–µ–Ω–¥–µ—Ä –ø–∏—Ç–æ–º—Ü–µ–≤
        function renderPets() {
            petsContainer.innerHTML = '';
            
            gameState.pets.forEach(pet => {
                const petCard = document.createElement('div');
                petCard.className = `pet-card ${pet.id === gameState.selectedPetId ? 'pet-card-selected' : ''}`;
                petCard.onclick = () => selectPet(pet.id);
                
                const evolutionStage = getCurrentEvolutionStage(pet);
                const xpPercent = Math.min(100, (pet.xp / (pet.level * 50)) * 100;
                
                petCard.innerHTML = `
                    <div class="pet-level">${pet.level}</div>
                    <div class="pet-image" style="color: ${evolutionStage.color}">${evolutionStage.emoji}</div>
                    <div class="pet-evolution">${evolutionStage.name}</div>
                    
                    <div class="stats-container">
                        <!-- –ì–æ–ª–æ–¥ -->
                        <div class="stat">
                            <div class="stat-label">
                                <span class="stat-icon">üçó</span>
                                <span>${Math.round(pet.stats.hunger)}%</span>
                            </div>
                            <div class="stat-bar-container">
                                <div class="stat-bar hunger-bar" style="width: ${pet.stats.hunger}%"></div>
                            </div>
                        </div>
                        
                        <!-- –≠–Ω–µ—Ä–≥–∏—è -->
                        <div class="stat">
                            <div class="stat-label">
                                <span class="stat-icon">‚ö°</span>
                                <span>${Math.round(pet.stats.energy)}%</span>
                            </div>
                            <div class="stat-bar-container">
                                <div class="stat-bar energy-bar" style="width: ${pet.stats.energy}%"></div>
                            </div>
                        </div>
                        
                        <!-- –°—á–∞—Å—Ç—å–µ -->
                        <div class="stat">
                            <div class="stat-label">
                                <span class="stat-icon">üòä</span>
                                <span>${Math.round(pet.stats.happiness)}%</span>
                            </div>
                            <div class="stat-bar-container">
                                <div class="stat-bar happiness-bar" style="width: ${pet.stats.happiness}%"></div>
                            </div>
                        </div>
                        
                        <!-- –ì–∏–≥–∏–µ–Ω–∞ -->
                        <div class="stat">
                            <div class="stat-label">
                                <span class="stat-icon">üßº</span>
                                <span>${Math.round(pet.stats.hygiene)}%</span>
                            </div>
                            <div class="stat-bar-container">
                                <div class="stat-bar hygiene-bar" style="width: ${pet.stats.hygiene}%"></div>
                            </div>
                        </div>
                        
                        <!-- –û–ø—ã—Ç -->
                        <div class="stat">
                            <div class="stat-label">
                                <span class="stat-icon">‚≠ê</span>
                                <span>${pet.xp}/${pet.level * 50}</span>
                            </div>
                            <div class="xp-bar-container">
                                <div class="xp-bar" style="width: ${xpPercent}%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="actions">
                        <button onclick="interactWithPet('${pet.id}', 'feed'); event.stopPropagation();">–ö–æ—Ä–º–∏—Ç—å</button>
                        <button onclick="interactWithPet('${pet.id}', 'sleep'); event.stopPropagation();">–°–ø–∞—Ç—å</button>
                        <button onclick="interactWithPet('${pet.id}', 'play'); event.stopPropagation();">–ò–≥—Ä–∞—Ç—å</button>
                        <button onclick="interactWithPet('${pet.id}', 'clean'); event.stopPropagation();">–ú—ã—Ç—å</button>
                        <button onclick="interactWithPet('${pet.id}', 'train'); event.stopPropagation();">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    
                    ${pet.traits.length > 0 ? `
                    <div style="margin-top: 10px; font-size: 10px; color: var(--medieval-blue);">
                        –ß–µ—Ä—Ç—ã: ${pet.traits.map(t => t.name).join(', ')}
                    </div>
                    ` : ''}
                `;
                
                petsContainer.appendChild(petCard);
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥
        function addLogMessage(message, isImportant = false) {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            if (isImportant) {
                logEntry.style.fontWeight = 'bold';
                logEntry.style.color = 'var(--medieval-red)';
            }
            
            logEntry.innerHTML = `<span class="log-time">[${timeString}]</span> ${message}`;
            gameLog.appendChild(logEntry);
            
            // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–æ–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
            gameLog.scrollTop = gameLog.scrollHeight;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç–∞–¥–∏–∏ —ç–≤–æ–ª—é—Ü–∏–∏
        function getCurrentEvolutionStage(pet) {
            for (let i = EVOLUTION_STAGES.length - 1; i >= 0; i--) {
                if (pet.level >= EVOLUTION_STAGES[i].level) {
                    return EVOLUTION_STAGES[i];
                }
            }
            return EVOLUTION_STAGES[0];
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            if (gameState.gameStarted) {
                localStorage.setItem('tapikiGame', JSON.stringify(gameState));
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        function loadGame() {
            const savedGame = localStorage.getItem('tapikiGame');
            if (savedGame) {
                gameState = JSON.parse(savedGame);
                gameState.gameStarted = true;
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–≥
                gameLog.innerHTML = '';
                addLogMessage('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞.', true);
                addLogMessage(`–£ –≤–∞—Å ${gameState.pets.length} —Ç–∞–ø–∏–∫–æ–≤.`, true);
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initGame;
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        window.interactWithPet = interactWithPet;
    </script>
</body>
</html>