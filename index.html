<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Cow Hunt</title>
    <script src="https://telegram.org/js/games.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background: #000;
            touch-action: manipulation;
            user-select: none;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        #mainMenu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #0a0a2a 0%, #000033 70%, #00001a 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
        }
        
        .menuTitle {
            font-size: 3rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px #4fc3f7, 0 0 20px #4fc3f7;
            color: #fff;
            text-align: center;
        }
        
        .menuButton {
            background: linear-gradient(to bottom, #4fc3f7, #1976d2);
            border: none;
            color: white;
            padding: 15px 30px;
            margin: 10px;
            font-size: 1.2rem;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            width: 200px;
            text-align: center;
        }
        
        .menuButton:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        #backgroundCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
        }
        
        #uiContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }
        
        #topUI {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            color: white;
            font-size: 1.2rem;
            text-shadow: 1px 1px 2px black;
        }
        
        #bottomUI {
            position: absolute;
            bottom: 10px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            text-shadow: 1px 1px 2px black;
            gap: 20px;
        }
        
        #ammoDisplay {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .bullet {
            width: 20px;
            height: 30px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 30"><path d="M10 0 L20 10 L15 15 L20 20 L10 30 L0 20 L5 15 L0 10 Z" fill="%23FFD700"/></svg>') no-repeat center;
            background-size: contain;
        }
        
        #livesContainer {
            display: flex;
            gap: 5px;
        }
        
        .heart {
            width: 25px;
            height: 25px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="%23FF5252"/></svg>') no-repeat center;
            background-size: contain;
        }
        
        #reloadMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: #FFD700;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.5rem;
            display: none;
            z-index: 10;
            text-align: center;
        }
        
        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            color: white;
        }
        
        .gameOverText {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #4fc3f7;
            text-align: center;
        }
        
        .scoreText {
            font-size: 1.8rem;
            margin-bottom: 30px;
        }
        
        #restartButton {
            background: linear-gradient(to bottom, #4fc3f7, #1976d2);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        #restartButton:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="backgroundCanvas"></canvas>
        <canvas id="gameCanvas"></canvas>
        
        <div id="uiContainer">
            <div id="topUI">
                <div id="scoreDisplay">Score: 0</div>
                <div id="timeDisplay">Time: 60</div>
                <div id="livesContainer">
                    <div class="heart"></div>
                    <div class="heart"></div>
                    <div class="heart"></div>
                </div>
            </div>
            
            <div id="bottomUI">
                <div id="ammoDisplay">
                    <div class="bullet"></div>
                    <div class="bullet"></div>
                    <div class="bullet"></div>
                    <div class="bullet"></div>
                    <div class="bullet"></div>
                </div>
                <div id="hitsDisplay">Hits: 0/0</div>
            </div>
            
            <div id="reloadMessage">Reloading...</div>
        </div>
        
        <div id="mainMenu">
            <h1 class="menuTitle">Cosmic Cow Hunt</h1>
            <button class="menuButton" id="startButton">Start Game</button>
            <button class="menuButton" id="howToPlayButton">How to Play</button>
        </div>
        
        <div id="gameOverScreen">
            <div class="gameOverText">Game Over</div>
            <div class="scoreText" id="finalScore">Score: 0</div>
            <button id="restartButton">Play Again</button>
        </div>
    </div>

    <script>
        // Game constants
        const GAME_WIDTH = window.innerWidth;
        const GAME_HEIGHT = window.innerHeight;
        const GAME_DURATION = 60; // seconds
        const MAX_LIVES = 3;
        const AMMO_CAPACITY = 5;
        const RELOAD_TIME = 2000; // ms
        
        // Game variables
        let score = 0;
        let timeLeft = GAME_DURATION;
        let lives = MAX_LIVES;
        let ammo = AMMO_CAPACITY;
        let hits = 0;
        let shots = 0;
        let gameRunning = false;
        let gameOver = false;
        let reloading = false;
        let lastTime = 0;
        let gameStartTime = 0;
        
        // DOM elements
        const gameCanvas = document.getElementById('gameCanvas');
        const backgroundCanvas = document.getElementById('backgroundCanvas');
        const gameCtx = gameCanvas.getContext('2d');
        const backgroundCtx = backgroundCanvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const livesContainer = document.getElementById('livesContainer');
        const ammoDisplay = document.getElementById('ammoDisplay');
        const hitsDisplay = document.getElementById('hitsDisplay');
        const reloadMessage = document.getElementById('reloadMessage');
        const mainMenu = document.getElementById('mainMenu');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScore = document.getElementById('finalScore');
        const startButton = document.getElementById('startButton');
        const howToPlayButton = document.getElementById('howToPlayButton');
        const restartButton = document.getElementById('restartButton');
        
        // Set canvas sizes
        gameCanvas.width = GAME_WIDTH;
        gameCanvas.height = GAME_HEIGHT;
        backgroundCanvas.width = GAME_WIDTH;
        backgroundCanvas.height = GAME_HEIGHT;
        
        // Game objects
        let cows = [];
        let planets = [];
        let stars = [];
        let explosions = [];
        
        // Cow class
        class Cow {
            constructor() {
                this.width = 80;
                this.height = 60;
                this.x = Math.random() * (GAME_WIDTH - this.width);
                this.y = GAME_HEIGHT;
                this.speedX = (Math.random() - 0.5) * 4;
                this.speedY = - (2 + Math.random() * 3);
                this.angle = 0;
                this.rotationSpeed = (Math.random() - 0.5) * 0.1;
                this.alive = true;
                this.frame = 0;
                this.maxFrames = 4;
                this.animationSpeed = 0.2;
                this.wingFlapSpeed = 0.1;
                this.wingAngle = 0;
                this.wingDirection = 1;
                this.hit = false;
                this.hitTimer = 0;
                this.scored = false;
            }
            
            update(deltaTime) {
                if (!this.alive) return;
                
                this.x += this.speedX;
                this.y += this.speedY;
                this.angle += this.rotationSpeed;
                
                // Wing animation
                this.wingAngle += this.wingFlapSpeed * this.wingDirection;
                if (this.wingAngle > 0.3 || this.wingAngle < -0.3) {
                    this.wingDirection *= -1;
                }
                
                // Frame animation
                this.frame += this.animationSpeed;
                if (this.frame >= this.maxFrames) {
                    this.frame = 0;
                }
                
                // Hit animation
                if (this.hit) {
                    this.hitTimer += deltaTime;
                    if (this.hitTimer > 500) {
                        this.alive = false;
                        explosions.push(new Explosion(this.x + this.width/2, this.y + this.height/2));
                    }
                }
                
                // Check if out of bounds
                if (this.y < -this.height || this.x < -this.width || this.x > GAME_WIDTH) {
                    this.alive = false;
                    if (!this.hit && !this.scored) {
                        lives--;
                        updateLivesDisplay();
                        if (lives <= 0) {
                            endGame();
                        }
                    }
                }
            }
            
            draw(ctx) {
                if (!this.alive) return;
                
                ctx.save();
                ctx.translate(this.x + this.width/2, this.y + this.height/2);
                ctx.rotate(this.angle);
                
                // Draw cow body
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.ellipse(0, 0, this.width/2, this.height/2, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw head
                ctx.beginPath();
                ctx.ellipse(this.width/4, -this.height/4, this.width/6, this.height/6, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw eyes
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(this.width/4 + 10, -this.height/4 - 5, 3, 0, Math.PI * 2);
                ctx.arc(this.width/4 + 10, -this.height/4 + 5, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw nose
                ctx.fillStyle = '#8B4513';
                ctx.beginPath();
                ctx.arc(this.width/4 + 20, -this.height/4, 5, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw wings
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.save();
                ctx.translate(-10, 0);
                ctx.rotate(this.wingAngle);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.quadraticCurveTo(-30, -20, -40, -40);
                ctx.quadraticCurveTo(-20, -30, 0, 0);
                ctx.fill();
                ctx.restore();
                
                ctx.save();
                ctx.translate(10, 0);
                ctx.rotate(-this.wingAngle);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.quadraticCurveTo(30, -20, 40, -40);
                ctx.quadraticCurveTo(20, -30, 0, 0);
                ctx.fill();
                ctx.restore();
                
                // Draw space suit details
                ctx.strokeStyle = 'lightblue';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(0, 0, this.width/2 - 5, 0, Math.PI * 2);
                ctx.stroke();
                
                // Hit effect
                if (this.hit) {
                    ctx.fillStyle = `rgba(255, 0, 0, ${0.5 * (1 - this.hitTimer/500)})`;
                    ctx.beginPath();
                    ctx.ellipse(0, 0, this.width/2, this.height/2, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                ctx.restore();
            }
            
            isHit(x, y) {
                if (!this.alive || this.hit) return false;
                
                // Simple ellipse collision detection
                const centerX = this.x + this.width/2;
                const centerY = this.y + this.height/2;
                const radiusX = this.width/2;
                const radiusY = this.height/2;
                
                const normalizedX = (x - centerX) / radiusX;
                const normalizedY = (y - centerY) / radiusY;
                
                return normalizedX * normalizedX + normalizedY * normalizedY <= 1;
            }
        }
        
        // Explosion class
        class Explosion {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 5;
                this.maxRadius = 40;
                this.growthRate = 1;
                this.alpha = 1;
                this.fadeRate = 0.02;
            }
            
            update() {
                this.radius += this.growthRate;
                this.alpha -= this.fadeRate;
                return this.alpha > 0;
            }
            
            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                
                const gradient = ctx.createRadialGradient(
                    this.x, this.y, 0,
                    this.x, this.y, this.radius
                );
                gradient.addColorStop(0, 'rgba(255, 255, 0, 0.8)');
                gradient.addColorStop(0.5, 'rgba(255, 100, 0, 0.5)');
                gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
        }
        
        // Planet class
        class Planet {
            constructor() {
                this.size = 50 + Math.random() * 100;
                this.x = Math.random() * GAME_WIDTH;
                this.y = Math.random() * GAME_HEIGHT * 0.6;
                this.color = Math.random() > 0.5 ? 
                    `hsl(${200 + Math.random() * 40}, 70%, 50%)` : 
                    `hsl(${40 + Math.random() * 40}, 70%, 50%)`;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.005;
                this.clouds = Math.random() > 0.3;
                this.cloudColor = `rgba(255, 255, 255, ${0.2 + Math.random() * 0.3})`;
            }
            
            update() {
                this.rotation += this.rotationSpeed;
            }
            
            draw(ctx) {
                ctx.save();
                
                // Draw planet
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw cloud patterns
                if (this.clouds) {
                    ctx.fillStyle = this.cloudColor;
                    ctx.beginPath();
                    for (let i = 0; i < 5; i++) {
                        const angle = this.rotation + i * Math.PI * 0.4;
                        const cloudX = this.x + Math.cos(angle) * this.size * 0.7;
                        const cloudY = this.y + Math.sin(angle) * this.size * 0.7;
                        const cloudSize = this.size * (0.2 + Math.random() * 0.3);
                        ctx.moveTo(cloudX + cloudSize, cloudY);
                        ctx.arc(cloudX, cloudY, cloudSize, 0, Math.PI * 2);
                    }
                    ctx.fill();
                }
                
                ctx.restore();
            }
        }
        
        // Star class
        class Star {
            constructor() {
                this.x = Math.random() * GAME_WIDTH;
                this.y = Math.random() * GAME_HEIGHT;
                this.size = 2 + Math.random() * 4;
                this.color = Math.random() > 0.7 ? 'gold' : '#4fc3f7';
                this.twinkleSpeed = 0.5 + Math.random();
                this.twinkleFactor = 0;
                this.twinkleDirection = 1;
            }
            
            update() {
                this.twinkleFactor += this.twinkleSpeed * this.twinkleDirection;
                if (this.twinkleFactor > 1 || this.twinkleFactor < 0) {
                    this.twinkleDirection *= -1;
                }
            }
            
            draw(ctx) {
                const alpha = 0.5 + this.twinkleFactor * 0.5;
                ctx.save();
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                
                // Draw 4-pointed star
                ctx.beginPath();
                ctx.moveTo(this.x, this.y - this.size);
                ctx.lineTo(this.x + this.size/3, this.y - this.size/3);
                ctx.lineTo(this.x + this.size, this.y);
                ctx.lineTo(this.x + this.size/3, this.y + this.size/3);
                ctx.lineTo(this.x, this.y + this.size);
                ctx.lineTo(this.x - this.size/3, this.y + this.size/3);
                ctx.lineTo(this.x - this.size, this.y);
                ctx.lineTo(this.x - this.size/3, this.y - this.size/3);
                ctx.closePath();
                ctx.fill();
                
                ctx.restore();
            }
        }
        
        // Initialize game
        function initGame() {
            score = 0;
            timeLeft = GAME_DURATION;
            lives = MAX_LIVES;
            ammo = AMMO_CAPACITY;
            hits = 0;
            shots = 0;
            gameRunning = true;
            gameOver = false;
            reloading = false;
            cows = [];
            explosions = [];
            gameStartTime = Date.now();
            
            updateScoreDisplay();
            updateTimeDisplay();
            updateLivesDisplay();
            updateAmmoDisplay();
            updateHitsDisplay();
            
            // Create background elements
            createBackground();
            
            // Start game loop
            lastTime = Date.now();
            requestAnimationFrame(gameLoop);
            
            // Start cow spawner
            setTimeout(spawnCow, 1000);
        }
        
        // Create background elements
        function createBackground() {
            planets = [];
            stars = [];
            
            // Create planets
            for (let i = 0; i < 4; i++) {
                let planet, overlapping;
                let attempts = 0;
                
                do {
                    overlapping = false;
                    planet = new Planet();
                    
                    // Check for overlap with existing planets
                    for (const p of planets) {
                        const dx = planet.x - p.x;
                        const dy = planet.y - p.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < (planet.size + p.size) * 0.8) {
                            overlapping = true;
                            break;
                        }
                    }
                    
                    attempts++;
                    if (attempts > 100) break; // Prevent infinite loop
                } while (overlapping);
                
                if (!overlapping || attempts > 100) {
                    planets.push(planet);
                }
            }
            
            // Create stars
            for (let i = 0; i < 100; i++) {
                stars.push(new Star());
            }
            
            drawBackground();
        }
        
        // Draw background
        function drawBackground() {
            backgroundCtx.fillStyle = '#000033';
            backgroundCtx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // Draw fog effect
            const fogGradient = backgroundCtx.createLinearGradient(0, 0, 0, GAME_HEIGHT);
            fogGradient.addColorStop(0, 'rgba(10, 10, 50, 0.5)');
            fogGradient.addColorStop(0.5, 'rgba(20, 20, 80, 0.2)');
            fogGradient.addColorStop(1, 'rgba(10, 10, 50, 0.5)');
            backgroundCtx.fillStyle = fogGradient;
            backgroundCtx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // Draw stars
            for (const star of stars) {
                star.draw(backgroundCtx);
            }
            
            // Draw planets
            for (const planet of planets) {
                planet.draw(backgroundCtx);
            }
        }
        
        // Spawn a new cow
        function spawnCow() {
            if (!gameRunning) return;
            
            cows.push(new Cow());
            
            // Schedule next spawn
            const nextSpawn = 1000 + Math.random() * 2000;
            setTimeout(spawnCow, nextSpawn);
        }
        
        // Game loop
        function gameLoop() {
            if (!gameRunning) return;
            
            const currentTime = Date.now();
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;
            
            // Update game state
            updateGame(deltaTime);
            
            // Render game
            renderGame();
            
            // Continue game loop
            requestAnimationFrame(gameLoop);
        }
        
        // Update game state
        function updateGame(deltaTime) {
            // Update time
            const elapsedSeconds = Math.floor((Date.now() - gameStartTime) / 1000);
            timeLeft = Math.max(0, GAME_DURATION - elapsedSeconds);
            updateTimeDisplay();
            
            // Check if time is up
            if (timeLeft <= 0) {
                endGame();
                return;
            }
            
            // Update cows
            for (let i = cows.length - 1; i >= 0; i--) {
                cows[i].update(deltaTime);
                if (!cows[i].alive) {
                    cows.splice(i, 1);
                }
            }
            
            // Update explosions
            for (let i = explosions.length - 1; i >= 0; i--) {
                if (!explosions[i].update()) {
                    explosions.splice(i, 1);
                }
            }
            
            // Update planets
            for (const planet of planets) {
                planet.update();
            }
            
            // Update stars
            for (const star of stars) {
                star.update();
            }
            
            // Auto-reload when out of ammo
            if (ammo <= 0 && !reloading) {
                startReload();
            }
        }
        
        // Render game
        function renderGame() {
            // Clear game canvas
            gameCtx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // Draw cows
            for (const cow of cows) {
                cow.draw(gameCtx);
            }
            
            // Draw explosions
            for (const explosion of explosions) {
                explosion.draw(gameCtx);
            }
        }
        
        // Start reload process
        function startReload() {
            reloading = true;
            reloadMessage.style.display = 'block';
            
            setTimeout(() => {
                ammo = AMMO_CAPACITY;
                updateAmmoDisplay();
                reloading = false;
                reloadMessage.style.display = 'none';
            }, RELOAD_TIME);
        }
        
        // Handle click/shoot
        function handleShoot(e) {
            if (!gameRunning || reloading || gameOver) return;
            
            // Get click coordinates
            let x, y;
            if (e.type === 'touchstart') {
                x = e.touches[0].clientX;
                y = e.touches[0].clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }
            
            // Check if out of ammo
            if (ammo <= 0) return;
            
            // Use ammo
            ammo--;
            shots++;
            updateAmmoDisplay();
            updateHitsDisplay();
            
            // Check for hits
            let hit = false;
            for (const cow of cows) {
                if (cow.isHit(x, y)) {
                    cow.hit = true;
                    hit = true;
                    if (!cow.scored) {
                        score += 10;
                        hits++;
                        cow.scored = true;
                        updateScoreDisplay();
                        updateHitsDisplay();
                    }
                    break;
                }
            }
            
            // Play sound (placeholder for Telegram Games API)
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
            }
            
            // Draw shot effect
            drawShotEffect(x, y, hit);
        }
        
        // Draw shot effect
        function drawShotEffect(x, y, hit) {
            gameCtx.save();
            
            // Draw bullet trace
            gameCtx.strokeStyle = 'rgba(255, 215, 0, 0.7)';
            gameCtx.lineWidth = 2;
            gameCtx.beginPath();
            gameCtx.moveTo(GAME_WIDTH / 2, GAME_HEIGHT);
            gameCtx.lineTo(x, y);
            gameCtx.stroke();
            
            // Draw hit/miss effect
            gameCtx.beginPath();
            gameCtx.arc(x, y, 15, 0, Math.PI * 2);
            gameCtx.fillStyle = hit ? 'rgba(255, 0, 0, 0.5)' : 'rgba(255, 255, 255, 0.5)';
            gameCtx.fill();
            
            gameCtx.restore();
        }
        
        // Update score display
        function updateScoreDisplay() {
            scoreDisplay.textContent = `Score: ${score}`;
        }
        
        // Update time display
        function updateTimeDisplay() {
            timeDisplay.textContent = `Time: ${timeLeft}`;
        }
        
        // Update lives display
        function updateLivesDisplay() {
            livesContainer.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                livesContainer.appendChild(heart);
            }
        }
        
        // Update ammo display
        function updateAmmoDisplay() {
            const bullets = ammoDisplay.querySelectorAll('.bullet');
            bullets.forEach((bullet, index) => {
                bullet.style.opacity = index < ammo ? '1' : '0.3';
            });
        }
        
        // Update hits display
        function updateHitsDisplay() {
            hitsDisplay.textContent = `Hits: ${hits}/${shots}`;
        }
        
        // End game
        function endGame() {
            gameRunning = false;
            gameOver = true;
            
            finalScore.textContent = `Score: ${score}`;
            gameOverScreen.style.display = 'flex';
            
            // Report score to Telegram
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.isExpanded) {
                window.Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
                window.Telegram.WebApp.sendData(JSON.stringify({ score }));
            }
        }
        
        // Start game
        function startGame() {
            mainMenu.style.display = 'none';
            gameOverScreen.style.display = 'none';
            initGame();
        }
        
        // Event listeners
        gameCanvas.addEventListener('click', handleShoot);
        gameCanvas.addEventListener('touchstart', handleShoot);
        
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        
        howToPlayButton.addEventListener('click', () => {
            alert("How to Play:\n\n- Shoot the flying cosmic cows by tapping/clicking on them\n- You have 5 shots before needing to reload\n- Don't let the cows escape or you'll lose a life\n- Score as many points as you can in 60 seconds!\n\nGood luck!");
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            // For simplicity, we'll just reload the game on resize
            // In a production app, you'd want to properly handle resizing
            if (!gameRunning) {
                gameCanvas.width = window.innerWidth;
                gameCanvas.height = window.innerHeight;
                backgroundCanvas.width = window.innerWidth;
                backgroundCanvas.height = window.innerHeight;
                drawBackground();
            }
        });
        
        // Initialize Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.expand();
            window.Telegram.WebApp.enableClosingConfirmation();
        }
        
        // Initial background draw
        drawBackground();
    </script>
</body>
</html>