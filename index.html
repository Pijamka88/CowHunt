<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>City Chase</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #121212;
            color: #fff;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        #menu, #game {
            padding: 20px;
            text-align: center;
        }
        #menu {
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }
        #game {
            display: none;
            flex: 1;
            flex-direction: column;
        }
        button {
            background: #0078ff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            font-size: 18px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:active {
            background: #0060cc;
        }
        #ui {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: auto;
            padding: 15px 0;
            background: #1e1e1e;
            border-radius: 12px;
            width: 100%;
        }
        #stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            font-size: 18px;
        }
        #diceResult {
            font-weight: bold;
            color: #0078ff;
        }
        #remainingSteps {
            font-weight: bold;
            color: #ff9800;
        }
        #directionControls {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 10px;
        }
        #grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 1px;
            flex: 1;
            background: #333;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .cell {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #2e5d2e;
        }
        .road {
            position: absolute;
            z-index: 1;
        }
        .road-horizontal {
            width: 90%;
            height: 25%;
            background: #555;
            border: 1px solid #444;
            border-radius: 3px;
            top: 37.5%;
        }
        .road-vertical {
            height: 90%;
            width: 25%;
            background: #555;
            border: 1px solid #444;
            border-radius: 3px;
            left: 37.5%;
        }
        .intersection {
            position: absolute;
            width: 24px;
            height: 24px;
            background: #333;
            border-radius: 50%;
            z-index: 2;
        }
        .traffic-light {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            z-index: 3;
        }
        .car {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            z-index: 4;
            transform: translate(-50%, -50%);
        }
        .player-car {
            background: #4CAF50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.7);
        }
        .police-car {
            background: #F44336;
            box-shadow: 0 0 8px rgba(244, 67, 54, 0.7);
        }
        .plant {
            position: absolute;
            font-size: 18px;
            z-index: 0;
        }
        .player-controls {
            display: flex;
            justify-content: center;
            gap: 25px;
            width: 100%;
        }
        .direction-btn {
            background: #2c2c2c;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            display: none;
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>City Chase</h1>
        <p>–£–±–µ–≥–∞–π—Ç–µ –æ—Ç –ø–æ–ª–∏—Ü–∏–∏ –≤ –≥–æ—Ä–æ–¥–µ!</p>
        <button id="startGame">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>
    
    <div id="game">
        <div id="grid"></div>
        
        <div id="ui">
            <div id="stats">
                <div>–•–æ–¥—ã: <span id="moveCount">0</span></div>
                <div>–ö—É–±–∏–∫: <span id="diceResult">-</span></div>
                <div>–û—Å—Ç–∞–ª–æ—Å—å: <span id="remainingSteps">0</span></div>
            </div>
            <button id="dice">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
            
            <div id="directionControls" class="player-controls" style="display: none;">
                <button class="direction-btn" data-dir="left">‚Üê</button>
                <button class="direction-btn" data-dir="straight">‚Üë</button>
                <button class="direction-btn" data-dir="right">‚Üí</button>
            </div>
        </div>
        
        <div class="game-over" id="gameOver">
            <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
            <p id="gameOverMessage">–ü–æ–ª–∏—Ü–∏—è –ø–æ–π–º–∞–ª–∞ –≤–∞—Å!</p>
            <button id="restartGame">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        </div>
    </div>

    <script>
        Telegram.WebApp.expand();
        Telegram.WebApp.ready();
        
        const GRID_SIZE = 10;
        let gameState = {
            player: { x: 5, y: 5, dir: 0, progress: 0, nextX: 5, nextY: 4, segmentLength: 3 },
            police: [
                { x: 0, y: 0, dir: 1, progress: 0, nextX: 1, nextY: 0, segmentLength: 3 },
                { x: 9, y: 9, dir: 3, progress: 0, nextX: 8, nextY: 9, segmentLength: 3 }
            ],
            moves: 0,
            diceValue: 0,
            remainingSteps: 0,
            gameActive: false,
            waitingForDirection: false
        };
        
        // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 0=–≤–≤–µ—Ä—Ö, 1=–≤–ø—Ä–∞–≤–æ, 2=–≤–Ω–∏–∑, 3=–≤–ª–µ–≤–æ
        const DIRECTIONS = [
            { dx: 0, dy: -1 }, // –≤–≤–µ—Ä—Ö
            { dx: 1, dy: 0 },  // –≤–ø—Ä–∞–≤–æ
            { dx: 0, dy: 1 },  // –≤–Ω–∏–∑
            { dx: -1, dy: 0 }  // –≤–ª–µ–≤–æ
        ];
        
        // –°–≤–µ—Ç–æ—Ñ–æ—Ä—ã (–∫—Ä–∞—Å–Ω—ã–π/–∑–µ–ª–µ–Ω—ã–π)
        const trafficLights = Array.from({ length: GRID_SIZE }, () => 
            Array(GRID_SIZE).fill().map(() => Math.random() > 0.3 ? 'green' : 'red')
        );
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        function initGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —è—á–µ–π–∫–∏ (–¥–æ—Ä–æ–≥–∞ –∏–ª–∏ –∑–µ–º–ª—è)
                    const isRoad = (x % 3 === 0 || y % 3 === 0) && !(x === 5 && y === 5);
                    
                    if (isRoad) {
                        // –î–æ—Ä–æ–≥–∏ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
                        if (x < GRID_SIZE - 1 && ((x + 1) % 3 === 0 || x % 3 === 0)) {
                            const roadH = document.createElement('div');
                            roadH.className = 'road road-horizontal';
                            cell.appendChild(roadH);
                        }
                        
                        // –î–æ—Ä–æ–≥–∏ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
                        if (y < GRID_SIZE - 1 && ((y + 1) % 3 === 0 || y % 3 === 0)) {
                            const roadV = document.createElement('div');
                            roadV.className = 'road road-vertical';
                            cell.appendChild(roadV);
                        }
                        
                        // –ü–µ—Ä–µ–∫—Ä–µ—Å—Ç–æ–∫
                        const intersection = document.createElement('div');
                        intersection.className = 'intersection';
                        cell.appendChild(intersection);
                        
                        // –°–≤–µ—Ç–æ—Ñ–æ—Ä
                        if (trafficLights[y][x] === 'red') {
                            const light = document.createElement('div');
                            light.className = 'traffic-light';
                            light.style.backgroundColor = 'red';
                            light.style.top = '5px';
                            light.style.left = '5px';
                            cell.appendChild(light);
                        } else {
                            const light = document.createElement('div');
                            light.className = 'traffic-light';
                            light.style.backgroundColor = 'green';
                            light.style.top = '5px';
                            light.style.right = '5px';
                            cell.appendChild(light);
                        }
                    } else {
                        // –†–∞—Å—Ç–µ–Ω–∏—è –Ω–∞ –∑–µ–º–ª–µ
                        if (Math.random() > 0.3) {
                            const plant = document.createElement('div');
                            plant.className = 'plant';
                            plant.textContent = Math.random() > 0.5 ? 'üå≥' : 'üåø';
                            cell.appendChild(plant);
                        }
                    }
                    
                    grid.appendChild(cell);
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
        function updatePlayerPosition() {
            const grid = document.getElementById('grid');
            const playerEl = document.querySelector('.car.player-car') || createPlayerElement();
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const cellSize = 100 / GRID_SIZE;
            const progress = gameState.player.progress / gameState.player.segmentLength;
            let left = gameState.player.x * cellSize;
            let top = gameState.player.y * cellSize;
            
            if (gameState.player.x !== gameState.player.nextX || gameState.player.y !== gameState.player.nextY) {
                left += (gameState.player.nextX - gameState.player.x) * cellSize * progress;
                top += (gameState.player.nextY - gameState.player.y) * cellSize * progress;
            }
            
            playerEl.style.left = `${left}%`;
            playerEl.style.top = `${top}%`;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–≥—Ä–æ–∫–∞
        function createPlayerElement() {
            const playerEl = document.createElement('div');
            playerEl.className = 'car player-car';
            playerEl.textContent = 'üöó';
            document.getElementById('grid').appendChild(playerEl);
            return playerEl;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –ø–æ–ª–∏—Ü–∏–∏
        function updatePolicePositions() {
            const grid = document.getElementById('grid');
            
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–ª–∏—Ü–∏–∏
            document.querySelectorAll('.car.police-car').forEach(el => el.remove());
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ
            gameState.police.forEach((p, i) => {
                const cellSize = 100 / GRID_SIZE;
                const progress = p.progress / p.segmentLength;
                let left = p.x * cellSize;
                let top = p.y * cellSize;
                
                if (p.x !== p.nextX || p.y !== p.nextY) {
                    left += (p.nextX - p.x) * cellSize * progress;
                    top += (p.nextY - p.y) * cellSize * progress;
                }
                
                const policeEl = document.createElement('div');
                policeEl.className = 'car police-car';
                policeEl.textContent = 'üöì';
                policeEl.style.left = `${left}%`;
                policeEl.style.top = `${top}%`;
                grid.appendChild(policeEl);
            });
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–≤–∏–∂–µ–Ω–∏—è –≤ –ª—é–±–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
        function canMoveAnyDirection() {
            for (let i = 0; i < 3; i++) {
                const dir = i === 0 ? gameState.player.dir : 
                            i === 1 ? (gameState.player.dir + 3) % 4 : 
                            (gameState.player.dir + 1) % 4;
                
                const nextX = gameState.player.x + DIRECTIONS[dir].dx;
                const nextY = gameState.player.y + DIRECTIONS[dir].dy;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
                if (nextX < 0 || nextX >= GRID_SIZE || nextY < 0 || nextY >= GRID_SIZE) {
                    continue;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–µ—Ç–æ—Ñ–æ—Ä –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–µ
                if (trafficLights[nextY][nextX] === 'green') {
                    return true;
                }
            }
            return false;
        }
        
        // –ë—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–∞
        function rollDice() {
            if (!gameState.gameActive || gameState.waitingForDirection || gameState.remainingSteps > 0) return;
            
            gameState.diceValue = Math.floor(Math.random() * 6) + 1;
            gameState.remainingSteps = gameState.diceValue;
            gameState.moves++;
            
            document.getElementById('diceResult').textContent = gameState.diceValue;
            document.getElementById('remainingSteps').textContent = gameState.remainingSteps;
            
            // –î–≤–∏–≥–∞–µ–º –∏–≥—Ä–æ–∫–∞
            movePlayer();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞
            updatePlayerPosition();
        }
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        function movePlayer() {
            while (gameState.remainingSteps > 0) {
                // –ï—Å–ª–∏ –Ω–∞ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–µ, –∂–¥–µ–º –≤—ã–±–æ—Ä–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                if (gameState.player.progress === 0) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è
                    if (!canMoveAnyDirection()) {
                        endGame("–ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è!");
                        return;
                    }
                    
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—É—é –¥–ª–∏–Ω—É —Å–µ–≥–º–µ–Ω—Ç–∞ (2-4)
                    gameState.player.segmentLength = Math.floor(Math.random() * 3) + 2;
                    gameState.waitingForDirection = true;
                    document.getElementById('directionControls').style.display = 'flex';
                    return;
                }
                
                // –î–≤–∏–≥–∞–µ–º—Å—è –ø–æ —Ç–µ–∫—É—â–µ–º—É —Å–µ–≥–º–µ–Ω—Ç—É
                const moveAmount = Math.min(gameState.remainingSteps, gameState.player.segmentLength - gameState.player.progress);
                gameState.player.progress += moveAmount;
                gameState.remainingSteps -= moveAmount;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                document.getElementById('remainingSteps').textContent = gameState.remainingSteps;
                
                // –î–æ—Å—Ç–∏–≥–ª–∏ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–∞?
                if (gameState.player.progress >= gameState.player.segmentLength) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–µ—Ç–æ—Ñ–æ—Ä –Ω–∞ —Ü–µ–ª–µ–≤–æ–º –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–µ
                    if (trafficLights[gameState.player.nextY][gameState.player.nextX] === 'red') {
                        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–æ–º
                        gameState.player.progress = gameState.player.segmentLength;
                        return;
                    }
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–æ–≤—ã–π –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–æ–∫
                    gameState.player.x = gameState.player.nextX;
                    gameState.player.y = gameState.player.nextY;
                    gameState.player.progress = 0;
                }
            }
            
            // –ï—Å–ª–∏ —à–∞–≥–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∏ –Ω–µ –∂–¥–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –¥–≤–∏–≥–∞–µ–º –ø–æ–ª–∏—Ü–∏—é
            if (gameState.remainingSteps === 0 && !gameState.waitingForDirection) {
                movePoliceAutomatically();
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ–ª–∏—Ü–∏–∏
        function movePoliceAutomatically() {
            gameState.police.forEach(police => {
                const diceRoll = Math.floor(Math.random() * 6) + 1;
                movePolice(police, diceRoll);
            });
            updatePolicePositions();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–µ—Ä–∂–∞–Ω–∏—è
            checkArrest();
        }
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ–ª–∏—Ü–∏–∏
        function movePolice(police, steps) {
            let remaining = steps;
            
            while (remaining > 0) {
                if (police.progress === 0) {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—É—é –¥–ª–∏–Ω—É —Å–µ–≥–º–µ–Ω—Ç–∞ (2-4)
                    police.segmentLength = Math.floor(Math.random() * 3) + 2;
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–∫—É
                    const dx = gameState.player.x - police.x;
                    const dy = gameState.player.y - police.y;
                    
                    if (Math.abs(dx) > Math.abs(dy)) {
                        police.dir = dx > 0 ? 1 : 3; // –≤–ø—Ä–∞–≤–æ/–≤–ª–µ–≤–æ
                    } else {
                        police.dir = dy > 0 ? 2 : 0; // –≤–Ω–∏–∑/–≤–≤–µ—Ä—Ö
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø–æ–∑–∏—Ü–∏—é
                    police.nextX = police.x + DIRECTIONS[police.dir].dx;
                    police.nextY = police.y + DIRECTIONS[police.dir].dy;
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
                    if (police.nextX < 0 || police.nextX >= GRID_SIZE || 
                        police.nextY < 0 || police.nextY >= GRID_SIZE) {
                        police.nextX = police.x;
                        police.nextY = police.y;
                    }
                }
                
                // –î–≤–∏–≥–∞–µ–º—Å—è –ø–æ —Å–µ–≥–º–µ–Ω—Ç—É
                const moveAmount = Math.min(remaining, police.segmentLength - police.progress);
                police.progress += moveAmount;
                remaining -= moveAmount;
                
                // –î–æ—Å—Ç–∏–≥–ª–∏ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–∞?
                if (police.progress >= police.segmentLength) {
                    police.x = police.nextX;
                    police.y = police.nextY;
                    police.progress = 0;
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–µ—Ä–∂–∞–Ω–∏—è
        function checkArrest() {
            const playerPos = { x: Math.round(gameState.player.x), y: Math.round(gameState.player.y) };
            
            for (const police of gameState.police) {
                const policePos = { x: Math.round(police.x), y: Math.round(police.y) };
                
                // –ï—Å–ª–∏ –ø–æ–ª–∏—Ü–∏—è –∏ –∏–≥—Ä–æ–∫ –Ω–∞ –æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
                if (playerPos.x === policePos.x && playerPos.y === policePos.y) {
                    endGame("–ü–æ–ª–∏—Ü–∏—è –ø–æ–π–º–∞–ª–∞ –≤–∞—Å!");
                    return;
                }
            }
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        function endGame(message) {
            gameState.gameActive = false;
            document.getElementById('gameOverMessage').textContent = message;
            document.getElementById('gameOver').style.display = 'flex';
        }
        
        // –í—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–º
        function chooseDirection(direction) {
            if (!gameState.waitingForDirection) return;
            
            const currentDir = gameState.player.dir;
            let newDir;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            switch (direction) {
                case 'straight': newDir = currentDir; break;
                case 'left': newDir = (currentDir + 3) % 4; break; // –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞–ª–µ–≤–æ (90¬∞)
                case 'right': newDir = (currentDir + 1) % 4; break; // –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞–ø—Ä–∞–≤–æ (90¬∞)
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Å–ª–µ–¥—É—é—â—É—é –ø–æ–∑–∏—Ü–∏—é
            gameState.player.dir = newDir;
            gameState.player.nextX = gameState.player.x + DIRECTIONS[newDir].dx;
            gameState.player.nextY = gameState.player.y + DIRECTIONS[newDir].dy;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
            if (gameState.player.nextX < 0 || gameState.player.nextX >= GRID_SIZE || 
                gameState.player.nextY < 0 || gameState.player.nextY >= GRID_SIZE) {
                // –ï—Å–ª–∏ –≥—Ä–∞–Ω–∏—Ü–∞, –Ω–µ –¥–≤–∏–≥–∞–µ–º—Å—è
                gameState.waitingForDirection = false;
                document.getElementById('directionControls').style.display = 'none';
                return;
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –æ–∂–∏–¥–∞–Ω–∏—è
            gameState.waitingForDirection = false;
            document.getElementById('directionControls').style.display = 'none';
            
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ
            movePlayer();
            updatePlayerPosition();
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function startGame() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('game').style.display = 'flex';
            document.getElementById('gameOver').style.display = 'none';
            
            initGrid();
            createPlayerElement();
            
            gameState = {
                player: { x: 5, y: 5, dir: 0, progress: 0, nextX: 5, nextY: 4, segmentLength: 3 },
                police: [
                    { x: 0, y: 0, dir: 1, progress: 0, nextX: 1, nextY: 0, segmentLength: 3 },
                    { x: 9, y: 9, dir: 3, progress: 0, nextX: 8, nextY: 9, segmentLength: 3 }
                ],
                moves: 0,
                diceValue: 0,
                remainingSteps: 0,
                gameActive: true,
                waitingForDirection: false
            };
            
            document.getElementById('moveCount').textContent = '0';
            document.getElementById('diceResult').textContent = '-';
            document.getElementById('remainingSteps').textContent = '0';
            updatePlayerPosition();
            updatePolicePositions();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('startGame').addEventListener('click', startGame);
            document.getElementById('dice').addEventListener('click', rollDice);
            document.getElementById('restartGame').addEventListener('click', startGame);
            
            document.querySelectorAll('.direction-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    chooseDirection(btn.dataset.dir);
                });
            });
        });
    </script>
</body>
</html>
