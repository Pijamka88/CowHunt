<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cow Hunt: Space Edition</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(180deg, #1a0033 0%, #4d0099 100%);
            font-family: 'Arial', sans-serif;
            color: white;
            text-shadow: 0 0 5px #ff00ff;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
        }
        
        #leaderboard {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
        
        .heart {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23ff6b6b" d="M12 21.35l-1.45-1.32C5.4 15.14 2 12.34 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.84-3.4 6.64-8.55 11.47L12 21.35z"/></svg>') no-repeat;
            background-size: contain;
        }
        
        #fog {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(transparent 0%, #4d0099 100%);
        }
        
        button {
            background: #ff00ff;
            border: none;
            padding: 15px 30px;
            border-radius: 20px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: scale(1.1);
        }
        
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="menu">
            <h1>Cow Hunt: Space Edition</h1>
            <button onclick="startGame()">Start Mission</button>
            <button onclick="showLeaderboard()">Leaderboard</button>
        </div>
        
        <div id="hud">
            <span id="score">Score: 0</span>
            <div id="lives"></div>
            <span id="timer">Time: 60</span>
        </div>
        
        <div id="leaderboard">
            <h2>Top Scores</h2>
            <ol id="scoresList"></ol>
            <button onclick="closeLeaderboard()">Close</button>
        </div>
        
        <div id="fog"></div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const menu = document.getElementById('menu');
        const leaderboard = document.getElementById('leaderboard');
        const scoresList = document.getElementById('scoresList');
        const scoreDisplay = document.getElementById('score');
        const livesContainer = document.getElementById('lives');
        const timerDisplay = document.getElementById('timer');
        
        let cows = [];
        let bullets = [];
        let explosions = [];
        let score = 0;
        let lives = 3;
        let gameTime = 60;
        let reloadTime = 0;
        let gameLoop;
        let gameActive = false;
        
        // Настройки
        const cowSpeed = 2;
        const bulletSpeed = 5;
        const maxCows = 5;
        const reloadDuration = 0.5; // seconds
        
        // Инициализация
        function init() {
            resizeCanvas();
            createHearts();
            loadLeaderboard();
        }
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        function createHearts() {
            livesContainer.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                livesContainer.appendChild(heart);
            }
        }
        
        // Игровая логика
        function startGame() {
            menu.style.display = 'none';
            leaderboard.style.display = 'none';
            resetGame();
            gameActive = true;
            gameLoop = setInterval(update, 16);
            startTimer();
        }
        
        function resetGame() {
            cows = [];
            bullets = [];
            explosions = [];
            score = 0;
            lives = 3;
            gameTime = 60;
            scoreDisplay.textContent = 'Score: 0';
            createHearts();
            timerDisplay.textContent = 'Time: 60';
        }
        
        function startTimer() {
            const timerInterval = setInterval(() => {
                if (gameTime > 0 && gameActive) {
                    gameTime--;
                    timerDisplay.textContent = `Time: ${gameTime}`;
                } else {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }
        
        function endGame() {
            gameActive = false;
            clearInterval(gameLoop);
            saveScore(score);
            showLeaderboard();
        }
        
        function saveScore(score) {
            const scores = JSON.parse(localStorage.getItem('cowHuntScores')) || [];
            scores.push({name: 'Agent', score: score});
            scores.sort((a, b) => b.score - a.score);
            localStorage.setItem('cowHuntScores', JSON.stringify(scores.slice(0, 10)));
        }
        
        function loadLeaderboard() {
            const scores = JSON.parse(localStorage.getItem('cowHuntScores')) || [];
            scoresList.innerHTML = scores.map(s => `<li>${s.name}: ${s.score}</li>`).join('');
        }
        
        function showLeaderboard() {
            leaderboard.style.display = 'block';
            loadLeaderboard();
        }
        
        function closeLeaderboard() {
            leaderboard.style.display = 'none';
            menu.style.display = 'block';
        }
        
        // Обновление игры
        function update() {
            updateCows();
            updateBullets();
            updateExplosions();
            checkCollisions();
            draw();
        }
        
        function updateCows() {
            if (cows.length < maxCows && Math.random() < 0.02) {
                spawnCow();
            }
            
            cows.forEach((cow, index) => {
                cow.x += cow.speedX;
                cow.y = cow.startY + Math.sin(cow.angle) * 50;
                cow.angle += 0.05;
                
                if (cow.x > canvas.width + 50 || cow.x < -50) {
                    lives--;
                    createHearts();
                    if (lives < 1) endGame();
                    cows.splice(index, 1);
                }
            });
        }
        
        function spawnCow() {
            const side = Math.random() < 0.5 ? 'left' : 'right';
            cows.push({
                x: side === 'left' ? -50 : canvas.width + 50,
                startY: Math.random() * (canvas.height - 200) + 100,
                y: 0,
                speedX: (side === 'left' ? 1 : -1) * (cowSpeed + Math.random() * 2),
                angle: Math.random() * Math.PI * 2,
                size: 40
            });
        }
        
        function updateBullets() {
            bullets.forEach((bullet, index) => {
                bullet.x += bullet.speedX;
                bullet.y += bullet.speedY;
                
                if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
                    bullets.splice(index, 1);
                }
            });
        }
        
        function updateExplosions() {
            explosions.forEach((explosion, index) => {
                explosion.timer -= 0.016;
                if (explosion.timer <= 0) {
                    explosions.splice(index, 1);
                }
            });
        }
        
        function checkCollisions() {
            cows.forEach((cow, cIndex) => {
                bullets.forEach((bullet, bIndex) => {
                    const dx = cow.x - bullet.x;
                    const dy = cow.y - bullet.y;
                    const distance = Math.sqrt(dx*dx + dy*dy);
                    
                    if (distance < cow.size/2 + 5) {
                        score += 10;
                        scoreDisplay.textContent = `Score: ${score}`;
                        explosions.push({x: cow.x, y: cow.y, timer: 0.5});
                        cows.splice(cIndex, 1);
                        bullets.splice(bIndex, 1);
                    }
                });
            });
        }
        
        // Отрисовка
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Фиолетовый туман
            ctx.fillStyle = 'rgba(77, 0, 153, 0.3)';
            ctx.fillRect(0, canvas.height - 100, canvas.width, 100);
            
            // Коровы
            cows.forEach(cow => {
                ctx.save();
                ctx.translate(cow.x, cow.y);
                ctx.rotate(Math.atan2(0, cow.speedX) + Math.PI/2);
                
                // Тело коровы
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.arc(0, 0, cow.size/2, 0, Math.PI*2);
                ctx.fill();
                
                // Крылья
                ctx.fillStyle = '#ff69b4';
                ctx.fillRect(-cow.size/2, 0, cow.size, 10);
                ctx.restore();
            });
            
            // Выстрелы
            bullets.forEach(bullet => {
                ctx.fillStyle = '#ffff00';
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, 3, 0, Math.PI*2);
                ctx.fill();
            });
            
            // Взрывы
            explosions.forEach(explosion => {
                ctx.fillStyle = `rgba(255, 0, 0, ${explosion.timer})`;
                ctx.beginPath();
                ctx.arc(explosion.x, explosion.y, 20 * (1 - explosion.timer), 0, Math.PI*2);
                ctx.fill();
            });
        }
        
        // Управление
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('click', (e) => {
            if (!gameActive || reloadTime > 0) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            bullets.push({
                x: canvas.width/2,
                y: canvas.height - 50,
                speedX: (x - canvas.width/2) * 0.1,
                speedY: (y - (canvas.height - 50)) * 0.1 - 5
            });
            
            reloadTime = reloadDuration;
            setTimeout(() => reloadTime = 0, reloadDuration * 1000);
        });
        
        // Запуск
        init();
    </script>
</body>
</html>
