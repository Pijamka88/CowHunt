<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="telegram:web_app_version" content="1.0">
    <title>Cow Hunter Galaxy</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #2a0a3f, #1a0524);
            font-family: 'Arial', sans-serif;
            color: white;
            position: relative;
        }

        #menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        button {
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            background: #6a1b9a;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background: #9c27b0;
        }

        #game {
            display: none;
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        .cow {
            position: absolute;
            width: 80px;
            height: 80px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="#a1887f" d="M50 10L60 20H90L80 30V50H20V30L10 20H40L50 10Z"/><path fill="#d1c4e9" d="M50 60L60 50H90L80 40V20H20V40L10 50H40L50 60Z"/><path fill="#795548" d="M50 70L60 60H90L80 50V30H20V50L10 60H40L50 70Z"/><circle cx="50" cy="75" r="5" fill="#000"/><path fill="#000" d="M50 80L55 85H45Z"/></svg>') no-repeat;
            background-size: contain;
            transform: scaleX(1);
            transition: transform 0.3s;
        }

        .smoke {
            position: absolute;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(148,0,211,0.3), transparent);
            border-radius: 50%;
            animation: float 10s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(0) scale(0.8); opacity: 0.5; }
            50% { opacity: 1; }
            100% { transform: translateY(-100vh) scale(1.2); opacity: 0; }
        }

        #hud {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
        }

        .heart { 
            width: 30px;
            height: 30px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23ff4444" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>') no-repeat;
            background-size: contain;
        }

        #cooldown {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 10px;
            background: #444;
            border-radius: 5px;
        }

        #cooldown-bar {
            width: 100%;
            height: 100%;
            background: #9c27b0;
            transition: width 0.5s;
        }

        #leaderboard {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        .score-entry {
            background: rgba(255,255,255,0.1);
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
        }

        @keyframes explode {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        .explosion {
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #ff4444, #ff8800);
            border-radius: 50%;
            animation: explode 0.3s forwards;
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>Cow Hunter Galaxy</h1>
        <button onclick="startGame()">Играть</button>
        <button onclick="showLeaderboard()">Таблица лидеров</button>
    </div>

    <div id="game">
        <div id="hud">
            <div id="hearts"></div>
            <div id="timer">60</div>
        </div>
        <div id="cooldown"><div id="cooldown-bar"></div></div>
    </div>

    <div id="leaderboard">
        <h2>Лучшие результаты</h2>
        <div id="leaderboard-entries"></div>
        <button onclick="closeLeaderboard()">Назад</button>
    </div>

    <script>
        let gameActive = false;
        let score = 0;
        let lives = 3;
        let timeLeft = 60;
        let cows = [];
        let cooldown = false;
        const maxCows = 5;
        const gameArea = document.getElementById('game');
        const heartsContainer = document.getElementById('hearts');
        const timerDisplay = document.getElementById('timer');
        const cooldownBar = document.getElementById('cooldown-bar');

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            initializeGame();
        }

        function initializeGame() {
            gameActive = true;
            score = 0;
            lives = 3;
            timeLeft = 60;
            updateHearts();
            resetCooldown();
            createSmoke();
            spawnCows();
            startTimer();
        }

        function createSmoke() {
            const smoke = document.createElement('div');
            smoke.className = 'smoke';
            smoke.style.left = Math.random() * 100 + 'vw';
            smoke.style.animationDuration = Math.random() * 5 + 5 + 's';
            document.body.appendChild(smoke);
            setTimeout(() => smoke.remove(), 10000);
        }

        function spawnCows() {
            if (!gameActive) return;
            
            const cow = document.createElement('div');
            cow.className = 'cow';
            cow.style.left = Math.random() * 90 + '%';
            cow.direction = Math.random() < 0.5 ? -1 : 1;
            cow.style.transform = `scaleX(${cow.direction})`;
            cow.speed = Math.random() * 3 + 2;
            cow.angle = 0;
            cow.amplitude = Math.random() * 50 + 50;
            gameArea.appendChild(cow);
            cows.push(cow);
            
            moveCow(cow);
            
            if (cows.length < maxCows) {
                setTimeout(spawnCows, 1000);
            }
        }

        function moveCow(cow) {
            if (!gameActive) return;
            
            cow.angle += 0.05;
            const y = Math.sin(cow.angle) * cow.amplitude;
            cow.style.left = parseFloat(cow.style.left) + cow.direction * cow.speed + 'px';
            cow.style.top = y + 'px';
            
            if (parseFloat(cow.style.left) > 100 || parseFloat(cow.style.left) < -10) {
                cow.remove();
                cows = cows.filter(c => c !== cow);
                return;
            }
            
            requestAnimationFrame(() => moveCow(cow));
        }

        function updateHearts() {
            heartsContainer.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heartsContainer.appendChild(heart);
            }
        }

        function startTimer() {
            const timerInterval = setInterval(() => {
                if (!gameActive) return;
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            gameActive = false;
            cows.forEach(cow => cow.remove());
            cows = [];
            saveScore(score);
            alert(`Игра окончена! Ваш счет: ${score}`);
            document.getElementById('game').style.display = 'none';
            document.getElementById('menu').style.display = 'block';
        }

        function saveScore(score) {
            let scores = JSON.parse(localStorage.getItem('cowHunterScores')) || [];
            scores.push(score);
            scores.sort((a, b) => b - a);
            scores = scores.slice(0, 10);
            localStorage.setItem('cowHunterScores', JSON.stringify(scores));
        }

        function showLeaderboard() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'block';
            const entries = document.getElementById('leaderboard-entries');
            entries.innerHTML = '';
            const scores = JSON.parse(localStorage.getItem('cowHunterScores')) || [];
            scores.forEach(score => {
                const entry = document.createElement('div');
                entry.className = 'score-entry';
                entry.textContent = score;
                entries.appendChild(entry);
            });
        }

        function closeLeaderboard() {
            document.getElementById('leaderboard').style.display = 'none';
            document.getElementById('menu').style.display = 'block';
        }

        document.addEventListener('click', (e) => {
            if (!gameActive || cooldown) return;
            
            cooldown = true;
            cooldownBar.style.width = '0%';
            setTimeout(resetCooldown, 500);
            
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.left = e.clientX - 25 + 'px';
            explosion.style.top = e.clientY - 25 + 'px';
            document.body.appendChild(explosion);
            setTimeout(() => explosion.remove(), 300);
            
            checkHits(e.clientX, e.clientY);
        });

        function resetCooldown() {
            cooldown = false;
            cooldownBar.style.width = '100%';
        }

        function checkHits(x, y) {
            cows.forEach(cow => {
                const rect = cow.getBoundingClientRect();
                if (x > rect.left && x < rect.right && y > rect.top && y < rect.bottom) {
                    cow.remove();
                    cows = cows.filter(c => c !== cow);
                    score++;
                    if (score % 10 === 0) createSmoke();
                }
            });
        }

        // Telegram Web App integration
        if (window.Telegram) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }
    </script>
</body>
</html>
