<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π –¢–∞–º–∞–≥–æ—á–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        #main-menu, #game-screen, #evolution-screen, #collection-screen {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: none;
        }
        
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 5px 2px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .stats {
            margin: 15px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        
        .pet {
            font-size: 24px;
            text-align: center;
            margin: 20px 0;
        }
        
        .progress-container {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            margin: 5px 0;
        }
        
        .progress-bar {
            height: 20px;
            border-radius: 5px;
            background-color: #4CAF50;
            text-align: center;
            line-height: 20px;
            color: white;
        }
        
        .pet-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }
        
        .pet-item {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin: 10px;
            width: 120px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .pet-item:hover {
            transform: scale(1.05);
        }
        
        h1, h2, h3 {
            color: #2c3e50;
            text-align: center;
        }
        
        .menu-button {
            display: block;
            width: 100%;
            margin: 10px 0;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="main-menu">
        <h1>–≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π –¢–∞–º–∞–≥–æ—á–∏</h1>
        <button id="new-game-btn" class="menu-button">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        <button id="continue-game-btn" class="menu-button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <button id="collection-btn" class="menu-button">–ö–æ–ª–ª–µ–∫—Ü–∏—è</button>
        <button id="about-btn" class="menu-button">–û–± –∏–≥—Ä–µ</button>
    </div>
    
    <div id="game-screen">
        <h2 id="pet-name">–ü–∏—Ç–æ–º–µ—Ü</h2>
        <div class="pet" id="pet-emoji">üê£</div>
        
        <div class="stats">
            <div>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
            <div>–û–ø—ã—Ç: <span id="exp">0</span>/<span id="exp-to-next">100</span></div>
            <div class="progress-container">
                <div id="exp-bar" class="progress-bar" style="width: 0%">0%</div>
            </div>
        </div>
        
        <div class="stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: <span id="health">100</span>/100</div>
            <div class="progress-container">
                <div id="health-bar" class="progress-bar" style="width: 100%">100%</div>
            </div>
            
            <div>–ì–æ–ª–æ–¥: <span id="hunger">50</span>/100</div>
            <div class="progress-container">
                <div id="hunger-bar" class="progress-bar" style="width: 50%">50%</div>
            </div>
            
            <div>–≠–Ω–µ—Ä–≥–∏—è: <span id="energy">80</span>/100</div>
            <div class="progress-container">
                <div id="energy-bar" class="progress-bar" style="width: 80%">80%</div>
            </div>
            
            <div>–°—á–∞—Å—Ç—å–µ: <span id="happiness">70</span>/100</div>
            <div class="progress-container">
                <div id="happiness-bar" class="progress-bar" style="width: 70%">70%</div>
            </div>
        </div>
        
        <div>
            <button id="feed-btn">–ü–æ–∫–æ—Ä–º–∏—Ç—å</button>
            <button id="play-btn">–ü–æ–∏–≥—Ä–∞—Ç—å</button>
            <button id="sleep-btn">–£–ª–æ–∂–∏—Ç—å —Å–ø–∞—Ç—å</button>
            <button id="heal-btn">–õ–µ—á–∏—Ç—å</button>
            <button id="train-btn">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        
        <div id="evolution-container" class="hidden">
            <button id="evolve-btn">–≠–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å!</button>
        </div>
        
        <button id="menu-btn" style="margin-top: 20px;">–ú–µ–Ω—é</button>
    </div>
    
    <div id="evolution-screen">
        <h2>–≠–≤–æ–ª—é—Ü–∏—è!</h2>
        <div class="pet" id="evolution-emoji">üê£</div>
        <p id="evolution-text">–í–∞—à –ø–∏—Ç–æ–º–µ—Ü –¥–æ—Å—Ç–∏–≥ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏ –≥–æ—Ç–æ–≤ –∫ —ç–≤–æ–ª—é—Ü–∏–∏!</p>
        <button id="evolution-continue-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
    
    <div id="collection-screen">
        <h2>–í–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è</h2>
        <div id="collection-stats">
            <p>–í—Å–µ–≥–æ –ø–∏—Ç–æ–º—Ü–µ–≤: <span id="total-pets">0</span></p>
            <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: <span id="max-level">0</span></p>
        </div>
        <div class="pet-container" id="pets-container">
            <!-- –ü–∏—Ç–æ–º—Ü—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>
        <button id="collection-back-btn">–ù–∞–∑–∞–¥</button>
    </div>
    
    <div id="about-screen" style="display: none; background-color: white; padding: 20px; border-radius: 10px;">
        <h2>–û–± –∏–≥—Ä–µ</h2>
        <p>–≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π –¢–∞–º–∞–≥–æ—á–∏ - —ç—Ç–æ –∏–≥—Ä–∞, –≥–¥–µ –≤—ã —É—Ö–∞–∂–∏–≤–∞–µ—Ç–µ –∑–∞ –ø–∏—Ç–æ–º—Ü–µ–º, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –∏ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç.</p>
        <p>–ö–æ–≥–¥–∞ –ø–∏—Ç–æ–º–µ—Ü –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è, –æ–Ω —Ä–∞–∑–º–Ω–æ–∂–∞–µ—Ç—Å—è –¥–µ–ª–µ–Ω–∏–µ–º, –∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞.</p>
        <p>–¶–µ–ª—å - —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–∏—Ç–æ–º—Ü–µ–≤ –∏ –¥–æ—Å—Ç–∏—á—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!</p>
        <button id="about-back-btn">–ù–∞–∑–∞–¥</button>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            pets: [],
            currentPetIndex: 0,
            lastUpdate: Date.now(),
            unlockedSpecies: new Set(['egg']),
            version: 1
        };
        
        // –í–∏–¥—ã –ø–∏—Ç–æ–º—Ü–µ–≤ –∏ –∏—Ö —ç–≤–æ–ª—é—Ü–∏–∏
        const speciesData = {
            'egg': {
                name: '–Ø–π—Ü–æ',
                emoji: 'üê£',
                requirements: { level: 0 },
                next: ['bird', 'reptile'],
                stats: { health: 100, hunger: 50, energy: 80, happiness: 70 }
            },
            'bird': {
                name: '–ü—Ç–∏—Ü–∞',
                emoji: 'üê¶',
                requirements: { level: 3 },
                next: ['eagle', 'penguin'],
                stats: { health: 120, hunger: 60, energy: 90, happiness: 80 }
            },
            'reptile': {
                name: '–†–µ–ø—Ç–∏–ª–∏—è',
                emoji: 'ü¶é',
                requirements: { level: 3 },
                next: ['dragon', 'turtle'],
                stats: { health: 150, hunger: 70, energy: 70, happiness: 60 }
            },
            'eagle': {
                name: '–û—Ä–µ–ª',
                emoji: 'ü¶Ö',
                requirements: { level: 6 },
                next: ['phoenix'],
                stats: { health: 150, hunger: 70, energy: 100, happiness: 90 }
            },
            'penguin': {
                name: '–ü–∏–Ω–≥–≤–∏–Ω',
                emoji: 'üêß',
                requirements: { level: 6 },
                next: ['emperor_penguin'],
                stats: { health: 130, hunger: 80, energy: 80, happiness: 85 }
            },
            'dragon': {
                name: '–î—Ä–∞–∫–æ–Ω',
                emoji: 'üê≤',
                requirements: { level: 6 },
                next: ['elder_dragon'],
                stats: { health: 200, hunger: 90, energy: 120, happiness: 70 }
            },
            'turtle': {
                name: '–ß–µ—Ä–µ–ø–∞—Ö–∞',
                emoji: 'üê¢',
                requirements: { level: 6 },
                next: ['ninja_turtle'],
                stats: { health: 180, hunger: 50, energy: 60, happiness: 75 }
            },
            'phoenix': {
                name: '–§–µ–Ω–∏–∫—Å',
                emoji: 'üî•',
                requirements: { level: 10 },
                next: [],
                stats: { health: 250, hunger: 80, energy: 150, happiness: 100 }
            },
            'emperor_penguin': {
                name: '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä—Å–∫–∏–π –ø–∏–Ω–≥–≤–∏–Ω',
                emoji: 'üëëüêß',
                requirements: { level: 10 },
                next: [],
                stats: { health: 200, hunger: 90, energy: 100, happiness: 95 }
            },
            'elder_dragon': {
                name: '–î—Ä–µ–≤–Ω–∏–π –¥—Ä–∞–∫–æ–Ω',
                emoji: 'üêâ',
                requirements: { level: 10 },
                next: [],
                stats: { health: 300, hunger: 100, energy: 150, happiness: 80 }
            },
            'ninja_turtle': {
                name: '–ß–µ—Ä–µ–ø–∞—à–∫–∞-–Ω–∏–Ω–¥–∑—è',
                emoji: 'üê¢üí•',
                requirements: { level: 10 },
                next: [],
                stats: { health: 220, hunger: 70, energy: 90, happiness: 90 }
            }
        };
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const elements = {
            mainMenu: document.getElementById('main-menu'),
            gameScreen: document.getElementById('game-screen'),
            evolutionScreen: document.getElementById('evolution-screen'),
            collectionScreen: document.getElementById('collection-screen'),
            aboutScreen: document.getElementById('about-screen'),
            
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            newGameBtn: document.getElementById('new-game-btn'),
            continueGameBtn: document.getElementById('continue-game-btn'),
            collectionBtn: document.getElementById('collection-btn'),
            aboutBtn: document.getElementById('about-btn'),
            menuBtn: document.getElementById('menu-btn'),
            collectionBackBtn: document.getElementById('collection-back-btn'),
            aboutBackBtn: document.getElementById('about-back-btn'),
            
            // –ò–≥—Ä–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            petName: document.getElementById('pet-name'),
            petEmoji: document.getElementById('pet-emoji'),
            level: document.getElementById('level'),
            exp: document.getElementById('exp'),
            expToNext: document.getElementById('exp-to-next'),
            expBar: document.getElementById('exp-bar'),
            health: document.getElementById('health'),
            healthBar: document.getElementById('health-bar'),
            hunger: document.getElementById('hunger'),
            hungerBar: document.getElementById('hunger-bar'),
            energy: document.getElementById('energy'),
            energyBar: document.getElementById('energy-bar'),
            happiness: document.getElementById('happiness'),
            happinessBar: document.getElementById('happiness-bar'),
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            feedBtn: document.getElementById('feed-btn'),
            playBtn: document.getElementById('play-btn'),
            sleepBtn: document.getElementById('sleep-btn'),
            healBtn: document.getElementById('heal-btn'),
            trainBtn: document.getElementById('train-btn'),
            
            // –≠–≤–æ–ª—é—Ü–∏—è
            evolveBtn: document.getElementById('evolve-btn'),
            evolutionContainer: document.getElementById('evolution-container'),
            evolutionEmoji: document.getElementById('evolution-emoji'),
            evolutionText: document.getElementById('evolution-text'),
            evolutionContinueBtn: document.getElementById('evolution-continue-btn'),
            
            // –ö–æ–ª–ª–µ–∫—Ü–∏—è
            petsContainer: document.getElementById('pets-container'),
            totalPets: document.getElementById('total-pets'),
            maxLevel: document.getElementById('max-level')
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGame();
            setupEventListeners();
            updateMenu();
            
            if (gameState.pets.length > 0) {
                showGameScreen();
                updateGameUI();
            } else {
                showMainMenu();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            setInterval(gameLoop, 1000);
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            elements.newGameBtn.addEventListener('click', startNewGame);
            elements.continueGameBtn.addEventListener('click', showGameScreen);
            elements.collectionBtn.addEventListener('click', showCollectionScreen);
            elements.aboutBtn.addEventListener('click', showAboutScreen);
            elements.menuBtn.addEventListener('click', showMainMenu);
            elements.collectionBackBtn.addEventListener('click', showMainMenu);
            elements.aboutBackBtn.addEventListener('click', showMainMenu);
            
            // –ò–≥—Ä–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
            elements.feedBtn.addEventListener('click', () => performAction('feed'));
            elements.playBtn.addEventListener('click', () => performAction('play'));
            elements.sleepBtn.addEventListener('click', () => performAction('sleep'));
            elements.healBtn.addEventListener('click', () => performAction('heal'));
            elements.trainBtn.addEventListener('click', () => performAction('train'));
            
            // –≠–≤–æ–ª—é—Ü–∏—è
            elements.evolveBtn.addEventListener('click', startEvolution);
            elements.evolutionContinueBtn.addEventListener('click', finishEvolution);
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (gameState.pets.length === 0) return;
            
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdate) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdate = now;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ—Ö –ø–∏—Ç–æ–º—Ü–µ–≤ (–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π)
            gameState.pets.forEach((pet, index) => {
                const isActive = index === gameState.currentPetIndex;
                updatePet(pet, deltaTime, isActive);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            saveGame();
            updateGameUI();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∏—Ç–æ–º—Ü–∞
        function updatePet(pet, deltaTime, isActive) {
            // –£–º–µ–Ω—å—à–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
            if (isActive) {
                pet.hunger = Math.max(0, pet.hunger - 0.5 * deltaTime);
                pet.energy = Math.max(0, pet.energy - 0.3 * deltaTime);
                pet.happiness = Math.max(0, pet.happiness - 0.2 * deltaTime);
                
                // –ï—Å–ª–∏ –≥–æ–ª–æ–¥ –∏–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –Ω–∞ –Ω—É–ª–µ, —É–º–µ–Ω—å—à–∞–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
                if (pet.hunger <= 0 || pet.energy <= 0) {
                    pet.health = Math.max(0, pet.health - 1 * deltaTime);
                }
                
                // –ï—Å–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ –Ω—É–ª–µ, —É–º–µ–Ω—å—à–∞–µ–º —Å—á–∞—Å—Ç—å–µ
                if (pet.health <= 0) {
                    pet.happiness = Math.max(0, pet.happiness - 1 * deltaTime);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –ø–∏—Ç–æ–º–µ—Ü
            if (pet.health <= 0 && !pet.isDead) {
                pet.isDead = true;
                pet.deathTime = Date.now();
            }
            
            // –ï—Å–ª–∏ –ø–∏—Ç–æ–º–µ—Ü –º–µ—Ä—Ç–≤ –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç, —É–¥–∞–ª—è–µ–º –µ–≥–æ
            if (pet.isDead && Date.now() - pet.deathTime > 300000) {
                const index = gameState.pets.indexOf(pet);
                if (index !== -1) {
                    gameState.pets.splice(index, 1);
                    if (gameState.currentPetIndex >= index) {
                        gameState.currentPetIndex = Math.max(0, gameState.currentPetIndex - 1);
                    }
                }
            }
        }
        
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –ø–∏—Ç–æ–º—Ü–µ–º
        function performAction(action) {
            const pet = getCurrentPet();
            if (!pet || pet.isDead) return;
            
            switch (action) {
                case 'feed':
                    pet.hunger = Math.min(100, pet.hunger + 30);
                    pet.energy = Math.min(100, pet.energy - 5);
                    pet.exp += 5;
                    break;
                case 'play':
                    pet.happiness = Math.min(100, pet.happiness + 20);
                    pet.energy = Math.min(100, pet.energy - 10);
                    pet.hunger = Math.max(0, pet.hunger - 5);
                    pet.exp += 10;
                    break;
                case 'sleep':
                    pet.energy = Math.min(100, pet.energy + 40);
                    pet.hunger = Math.max(0, pet.hunger - 10);
                    pet.exp += 5;
                    break;
                case 'heal':
                    pet.health = Math.min(getSpeciesData(pet.species).stats.health, pet.health + 30);
                    pet.energy = Math.max(0, pet.energy - 15);
                    pet.exp += 5;
                    break;
                case 'train':
                    pet.energy = Math.max(0, pet.energy - 20);
                    pet.hunger = Math.max(0, pet.hunger - 15);
                    pet.exp += 20;
                    break;
            }
            
            checkLevelUp(pet);
            updateGameUI();
            saveGame();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function checkLevelUp(pet) {
            const expNeeded = getExpForLevel(pet.level + 1);
            
            if (pet.exp >= expNeeded) {
                pet.level++;
                pet.exp -= expNeeded;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —ç–≤–æ–ª—é—Ü–∏—è
                checkEvolution(pet);
                
                // –ï—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –∫—Ä–∞—Ç–µ–Ω 3, –ø–∏—Ç–æ–º–µ—Ü –º–æ–∂–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å—Å—è
                if (pet.level % 3 === 0) {
                    reproducePet(pet);
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —ç–≤–æ–ª—é—Ü–∏–∏
        function checkEvolution(pet) {
            const speciesInfo = speciesData[pet.species];
            const nextSpecies = speciesInfo.next;
            
            for (const next of nextSpecies) {
                if (pet.level >= speciesData[next].requirements.level) {
                    pet.canEvolve = true;
                    elements.evolutionContainer.classList.remove('hidden');
                    return;
                }
            }
        }
        
        // –≠–≤–æ–ª—é—Ü–∏—è –ø–∏—Ç–æ–º—Ü–∞
        function startEvolution() {
            const pet = getCurrentPet();
            if (!pet || !pet.canEvolve) return;
            
            const speciesInfo = speciesData[pet.species];
            const possibleEvolutions = speciesInfo.next.filter(next => 
                pet.level >= speciesData[next].requirements.level
            );
            
            if (possibleEvolutions.length > 0) {
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —ç–≤–æ–ª—é—Ü–∏—é –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
                const newSpecies = possibleEvolutions[Math.floor(Math.random() * possibleEvolutions.length)];
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —ç–≤–æ–ª—é—Ü–∏–∏
                showEvolutionScreen(pet, newSpecies);
            }
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç–≤–æ–ª—é—Ü–∏–∏
        function finishEvolution() {
            const pet = getCurrentPet();
            if (!pet || !pet.newSpecies) return;
            
            // –ú–µ–Ω—è–µ–º –≤–∏–¥ –ø–∏—Ç–æ–º—Ü–∞
            pet.species = pet.newSpecies;
            delete pet.newSpecies;
            pet.canEvolve = false;
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –≤–∏–¥ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
            gameState.unlockedSpecies.add(pet.species);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–∏—Ç–æ–º—Ü–∞
            const speciesStats = speciesData[pet.species].stats;
            pet.health = speciesStats.health;
            pet.hunger = speciesStats.hunger;
            pet.energy = speciesStats.energy;
            pet.happiness = speciesStats.happiness;
            
            showGameScreen();
            updateGameUI();
            saveGame();
        }
        
        // –†–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞ –¥–µ–ª–µ–Ω–∏–µ–º
        function reproducePet(parentPet) {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–¥–∏—Ç–µ–ª—è
            const newPet = {
                species: parentPet.species,
                name: generatePetName(parentPet.species),
                level: 1,
                exp: 0,
                health: speciesData[parentPet.species].stats.health,
                hunger: speciesData[parentPet.species].stats.hunger,
                energy: speciesData[parentPet.species].stats.energy,
                happiness: speciesData[parentPet.species].stats.happiness,
                isDead: false,
                canEvolve: false,
                birthTime: Date.now()
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
            gameState.pets.push(newPet);
            
            // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            alert(`–í–∞—à –ø–∏—Ç–æ–º–µ—Ü ${parentPet.name} –¥–æ—Å—Ç–∏–≥ —É—Ä–æ–≤–Ω—è ${parentPet.level} –∏ —Ä–∞–∑–¥–µ–ª–∏–ª—Å—è! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å ${newPet.name}!`);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ –¥–ª—è –ø–∏—Ç–æ–º—Ü–∞
        function generatePetName(species) {
            const names = {
                'egg': ['–Ø–π—Ü–æ', '–®–∞—Ä", "–°—Ñ–µ—Ä–∞", "–û–≤–∞–ª'],
                'bird': ['–ß–∏—Ä–∏–∫", "–ö—Ä—ã–ª—ã—à–∫–æ", "–ü–µ—Ä—ã—à–∫–æ", "–ü—Ç–∏—Ü'],
                'reptile': ['–ó–º–µ—é–∫–∞", "–ß–µ—à—É–π–∫–∞", "–Ø—â–µ—Ä", "–ì–∞–¥'],
                'eagle': ['–û—Ä–ª–∏–∫", "–ö–æ–≥–æ—Ç—å", "–ö—Ä—ã–ª–∞–Ω", "–¶–∞—Ä—å'],
                'penguin': ['–ü–∏–Ω–≥–≤–∏", "–õ—å–¥–∏–Ω–∫–∞", "–ß–µ—Ä–Ω–æ—Å–ø–∏–Ω", "–§—Ä–∞–∫"],
                'dragon': ['–î—Ä–∞–∫–æ—à–∞", "–û–≥–Ω–µ–¥—ã—à", "–ß–µ—à—É–π", "–ö—Ä—ã–ª–∞–Ω'],
                'turtle': ['–¢–æ—Ä—Ç–∏–ª–ª–∞", "–ü–∞–Ω—Ü–∏—Ä—å", "–ú–µ–¥–ª–∏", "–ù–∏–Ω–¥–∑—è'],
                'phoenix': ['–§–µ–Ω–∏–∫—Å", "–í–æ–∑—Ä–æ–∂–¥", "–û–≥–Ω–µ—Ö–≤–æ—Å—Ç", "–ë–µ—Å—Å–º–µ—Ä—Ç'],
                'emperor_penguin': ['–ò–º–ø–µ—Ä–∞—Ç–æ—Ä", "–ö–æ—Ä–æ–ª—å", "–í–ª–∞—Å—Ç–∏—Ç–µ–ª—å", "–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å'],
                'elder_dragon': ['–î—Ä–µ–≤–Ω–∏–π", "–ú—É–¥—Ä—ã–π", "–í–µ—á–Ω—ã–π", "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π'],
                'ninja_turtle': ['–õ–µ–æ–Ω–∞—Ä–¥–æ", "–†–∞—Ñ–∞—ç–ª—å", "–î–æ–Ω–∞—Ç–µ–ª–ª–æ", "–ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ"]
            };
            
            const speciesNames = names[species] || ['–ü–∏—Ç–æ–º–µ—Ü', '–î—Ä—É–≥', '–ö–æ–º–ø–∞–Ω—å–æ–Ω'];
            const randomName = speciesNames[Math.floor(Math.random() * speciesNames.length)];
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–æ–º–µ—Ä –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
            return `${randomName}-${Math.floor(Math.random() * 1000)}`;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
        function getCurrentPet() {
            return gameState.pets[gameState.currentPetIndex];
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ
        function getSpeciesData(species) {
            return speciesData[species] || speciesData['egg'];
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–ø—ã—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω—è
        function getExpForLevel(level) {
            return 100 * Math.pow(level, 1.5);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–≥—Ä—ã
        function updateGameUI() {
            const pet = getCurrentPet();
            if (!pet) return;
            
            const speciesInfo = getSpeciesData(pet.species);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            elements.petName.textContent = pet.name;
            elements.petEmoji.textContent = speciesInfo.emoji;
            elements.level.textContent = pet.level;
            elements.exp.textContent = Math.floor(pet.exp);
            elements.expToNext.textContent = Math.floor(getExpForLevel(pet.level + 1));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
            const expPercent = (pet.exp / getExpForLevel(pet.level + 1)) * 100;
            elements.expBar.style.width = `${expPercent}%`;
            elements.expBar.textContent = `${Math.floor(expPercent)}%`;
            
            elements.health.textContent = Math.floor(pet.health);
            const healthPercent = (pet.health / speciesInfo.stats.health) * 100;
            elements.healthBar.style.width = `${healthPercent}%`;
            elements.healthBar.textContent = `${Math.floor(healthPercent)}%`;
            
            elements.hunger.textContent = Math.floor(pet.hunger);
            elements.hungerBar.style.width = `${pet.hunger}%`;
            elements.hungerBar.textContent = `${Math.floor(pet.hunger)}%`;
            
            elements.energy.textContent = Math.floor(pet.energy);
            elements.energyBar.style.width = `${pet.energy}%`;
            elements.energyBar.textContent = `${Math.floor(pet.energy)}%`;
            
            elements.happiness.textContent = Math.floor(pet.happiness);
            elements.happinessBar.style.width = `${pet.happiness}%`;
            elements.happinessBar.textContent = `${Math.floor(pet.happiness)}%`;
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –ø–∏—Ç–æ–º–µ—Ü –º–µ—Ä—Ç–≤
            if (pet.isDead) {
                elements.feedBtn.disabled = true;
                elements.playBtn.disabled = true;
                elements.sleepBtn.disabled = true;
                elements.healBtn.disabled = true;
                elements.trainBtn.disabled = true;
                elements.evolveBtn.disabled = true;
                elements.petName.textContent = `${pet.name} (—É–º–µ—Ä)`;
            } else {
                elements.feedBtn.disabled = false;
                elements.playBtn.disabled = false;
                elements.sleepBtn.disabled = false;
                elements.healBtn.disabled = false;
                elements.trainBtn.disabled = false;
                elements.evolveBtn.disabled = !pet.canEvolve;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é
        function updateMenu() {
            elements.continueGameBtn.disabled = gameState.pets.length === 0;
            elements.collectionBtn.disabled = gameState.pets.length === 0;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function updateCollectionScreen() {
            elements.totalPets.textContent = gameState.pets.length;
            
            let maxLevel = 0;
            gameState.pets.forEach(pet => {
                if (pet.level > maxLevel) {
                    maxLevel = pet.level;
                }
            });
            elements.maxLevel.textContent = maxLevel;
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø–∏—Ç–æ–º—Ü–∞–º–∏
            elements.petsContainer.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–∏—Ç–æ–º—Ü–µ–≤ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
            gameState.pets.forEach((pet, index) => {
                const speciesInfo = getSpeciesData(pet.species);
                
                const petElement = document.createElement('div');
                petElement.className = 'pet-item';
                if (pet.isDead) {
                    petElement.style.opacity = '0.6';
                }
                
                petElement.innerHTML = `
                    <div style="font-size: 24px;">${speciesInfo.emoji}</div>
                    <div><strong>${pet.name}</strong></div>
                    <div>–£—Ä. ${pet.level}</div>
                    <div>${pet.isDead ? '–£–º–µ—Ä' : speciesInfo.name}</div>
                `;
                
                petElement.addEventListener('click', () => {
                    gameState.currentPetIndex = index;
                    showGameScreen();
                    updateGameUI();
                });
                
                elements.petsContainer.appendChild(petElement);
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —ç–≤–æ–ª—é—Ü–∏–∏
        function showEvolutionScreen(pet, newSpecies) {
            const newSpeciesInfo = speciesData[newSpecies];
            
            elements.evolutionEmoji.textContent = `${pet.emoji} ‚Üí ${newSpeciesInfo.emoji}`;
            elements.evolutionText.textContent = `–í–∞—à ${pet.name} —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ ${newSpeciesInfo.name}!`;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π –≤–∏–¥ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ
            pet.newSpecies = newSpecies;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —ç–≤–æ–ª—é—Ü–∏–∏
            hideAllScreens();
            elements.evolutionScreen.style.display = 'block';
        }
        
        // –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
        function startNewGame() {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
            const newPet = {
                species: 'egg',
                name: generatePetName('egg'),
                level: 1,
                exp: 0,
                health: 100,
                hunger: 50,
                energy: 80,
                happiness: 70,
                isDead: false,
                canEvolve: false,
                birthTime: Date.now()
            };
            
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã—Ö –ø–∏—Ç–æ–º—Ü–µ–≤ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ
            gameState.pets = [newPet];
            gameState.currentPetIndex = 0;
            gameState.unlockedSpecies = new Set(['egg']);
            gameState.lastUpdate = Date.now();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
            saveGame();
            showGameScreen();
            updateGameUI();
            updateMenu();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        function saveGame() {
            localStorage.setItem('evolutionTamagotchi', JSON.stringify(gameState));
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
        function loadGame() {
            const savedGame = localStorage.getItem('evolutionTamagotchi');
            if (savedGame) {
                const parsed = JSON.parse(savedGame);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
                if (parsed.version === gameState.version) {
                    gameState = parsed;
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Set –∏–∑ –º–∞—Å—Å–∏–≤–∞
                    if (Array.isArray(gameState.unlockedSpecies)) {
                        gameState.unlockedSpecies = new Set(gameState.unlockedSpecies);
                    }
                }
            }
        }
        
        // –°–∫—Ä—ã—Ç—å –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
        function hideAllScreens() {
            elements.mainMenu.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.evolutionScreen.style.display = 'none';
            elements.collectionScreen.style.display = 'none';
            elements.aboutScreen.style.display = 'none';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        function showMainMenu() {
            hideAllScreens();
            elements.mainMenu.style.display = 'block';
            updateMenu();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∏–≥—Ä—ã
        function showGameScreen() {
            hideAllScreens();
            elements.gameScreen.style.display = 'block';
            updateGameUI();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function showCollectionScreen() {
            hideAllScreens();
            elements.collectionScreen.style.display = 'block';
            updateCollectionScreen();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω "–û–± –∏–≥—Ä–µ"
        function showAboutScreen() {
            hideAllScreens();
            elements.aboutScreen.style.display = 'block';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>