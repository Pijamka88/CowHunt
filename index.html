<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Космические Коровы</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #0d1b2a;
      font-family: sans-serif;
      color: white;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: linear-gradient(to bottom, #1b263b, #0f1a2c);
      border-radius: 10px;
      touch-action: none;
    }
    #menu {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
      background: rgba(0,0,0,0.7);
      padding: 30px;
      border-radius: 10px;
    }
    #menu button {
      padding: 15px 30px;
      margin: 10px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
    }
    #scoreboard {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>Космические Коровы</h1>
    <p>Тапай по коровам!</p>
    <button onclick="startGame()">Начать игру</button>
    <p>Рекорд: <span id="record">0</span></p>
  </div>
  <div id="scoreboard" style="display:none;">
    Счёт: <span id="score">0</span><br/>
    Рекорд: <span id="highScore">0</span>
  </div>
  <canvas id="gameCanvas"></canvas>

  <audio id="bgMusic" loop>
    <source src="https://files.catbox.moe/9kzqkc.mp3" type="audio/mp3">
  </audio>
  <audio id="shootSound">
    <source src="https://files.catbox.moe/4n6s9j.mp3" type="audio/mp3">
  </audio>
  <audio id="hitSound">
    <source src="https://files.catbox.moe/p9v6y9.mp3" type="audio/mp3">
  </audio>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let width, height;
    function resize() {
      width = window.innerWidth * 0.95;
      height = window.innerHeight * 0.9;
      canvas.width = width;
      canvas.height = height;
    }
    window.addEventListener('resize', resize);
    resize();

    let gameRunning = false;
    let score = 0;
    let highScore = localStorage.getItem("cowHuntHigh") || 0;

    document.getElementById("highScore").innerText = highScore;
    const bgMusic = document.getElementById("bgMusic");
    const shootSound = document.getElementById("shootSound");
    const hitSound = document.getElementById("hitSound");

    const cows = [];
    let cowFrame = 0;
    let lastCowTime = 0;

    function startGame() {
      score = 0;
      document.getElementById("score").innerText = score;
      document.getElementById("scoreboard").style.display = "block";
      document.getElementById("menu").style.display = "none";
      cows.length = 0;
      bgMusic.play().catch(() => {});
      gameRunning = true;
      requestAnimationFrame(gameLoop);
    }

    function createCow() {
      const direction = Math.random() > 0.5 ? 1 : -1;
      const baseSpeed = 0.8 + Math.random() * 1.2;
      const speed = baseSpeed + score * 0.05; // Увеличивается со счётом
      cows.push({
        x: direction === 1 ? -60 : width + 60,
        y: 100 + Math.random() * (height - 200),
        vx: direction * speed,
        frame: 0,
        dead: false,
        deathTime: 0
      });
    }

    function drawCow(cow) {
      ctx.save();
      ctx.translate(cow.x, cow.y);
      if (cow.vx < 0) ctx.scale(-1, 1);

      // Тело
      ctx.fillStyle = "#ffffff";
      ctx.beginPath();
      ctx.ellipse(0, 0, 30, 20, 0, 0, Math.PI * 2);
      ctx.fill();

      // Голова
      ctx.beginPath();
      ctx.arc(35, -5, 15, 0, Math.PI * 2);
      ctx.fillStyle = "#ffffff";
      ctx.fill();

      // Шлем
      ctx.strokeStyle = "#00ffff";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(35, -5, 16, 0, Math.PI * 2);
      ctx.stroke();

      // Рожки
      ctx.beginPath();
      ctx.moveTo(25, -20);
      ctx.lineTo(20, -30);
      ctx.moveTo(45, -20);
      ctx.lineTo(50, -30);
      ctx.strokeStyle = "#ffcc00";
      ctx.lineWidth = 2;
      ctx.stroke();

      // Нос
      ctx.fillStyle = "#8B4513";
      ctx.beginPath();
      ctx.ellipse(42, 0, 5, 4, 0, 0, Math.PI * 2);
      ctx.fill();

      // Ноздри
      ctx.fillStyle = "#000";
      ctx.beginPath();
      ctx.arc(40, 0, 1.5, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(44, 0, 1.5, 0, Math.PI * 2);
      ctx.fill();

      // Глаза
      ctx.fillStyle = "#fff";
      ctx.beginPath();
      ctx.arc(30, -10, 4, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(30, -5, 1.5, 0, Math.PI * 2);
      ctx.fillStyle = "#000";
      ctx.fill();

      // Ноги
      const footOffset = Math.sin(cow.frame * 0.2) * 5;
      ctx.fillStyle = "#ffffff";
      for (let i = 0; i < 4; i++) {
        ctx.beginPath();
        ctx.rect(i % 2 === 0 ? -10 + (i >> 1) * 20 : -5 + (i >> 1) * 20, 20 + (footOffset * (i % 2 ? 1 : -1)), 5, 10);
        ctx.fill();
      }

      // Смерть
      if (cow.dead) {
        ctx.globalAlpha = 0.7;
        ctx.fillStyle = "#f00";
        ctx.beginPath();
        ctx.arc(0, 0, 20, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      ctx.restore();
    }

    function updateCows(dt) {
      cowFrame += dt * 0.01;
      if (Date.now() - lastCowTime > Math.max(1000 - score * 20, 300)) {
        createCow();
        lastCowTime = Date.now();
      }

      for (const cow of cows) {
        if (!cow.dead) cow.x += cow.vx;
        else cow.deathTime += dt;

        cow.frame += 1;

        if (cow.x < -100 || cow.x > width + 100 || cow.deathTime > 1000) {
          cow.dead = true;
        }
      }
    }

    function checkHit(x, y) {
      shootSound.currentTime = 0;
      shootSound.play();
      for (const cow of cows) {
        const dx = cow.x - x;
        const dy = cow.y - y;
        if (dx * dx + dy * dy < 900 && !cow.dead) {
          cow.dead = true;
          hitSound.currentTime = 0;
          hitSound.play();
          score++;
          document.getElementById("score").innerText = score;
          if (score > highScore) {
            highScore = score;
            localStorage.setItem("cowHuntHigh", highScore);
            document.getElementById("highScore").innerText = highScore;
          }
          break;
        }
      }
    }

    canvas.addEventListener("click", e => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      checkHit(x, y);
    });

    canvas.addEventListener("touchstart", e => {
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      checkHit(x, y);
    }, { passive: true });

    function gameLoop(timestamp) {
      if (!gameRunning) return;
      ctx.clearRect(0, 0, width, height);

      updateCows(16); // ~60 FPS

      for (const cow of cows) {
        drawCow(cow);
      }

      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>