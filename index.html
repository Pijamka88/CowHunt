<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Cow Defense</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: #000;
            color: #fff;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .screen {
            position: fixed;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.9);
        }

        .screen.active {
            display: flex;
        }

        .menu {
            text-align: center;
        }

        .title {
            font-size: 3em;
            margin-bottom: 2rem;
            color: #0ff;
            text-shadow: 0 0 10px #0ff;
        }

        .btn {
            padding: 1rem 2rem;
            margin: 1rem;
            font-size: 1.2em;
            background: #002;
            border: 2px solid #0ff;
            color: #0ff;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #005;
            box-shadow: 0 0 15px #0ff;
        }

        #gameCanvas {
            border: 2px solid #0ff;
            margin: 1rem;
        }

        .hud {
            position: fixed;
            padding: 1rem;
            background: rgba(0, 0, 50, 0.8);
            border: 1px solid #0ff;
            border-radius: 5px;
        }

        #topHud {
            top: 1rem;
            left: 1rem;
        }

        #bottomHud {
            bottom: 1rem;
            left: 1rem;
        }

        .crosshair {
            position: fixed;
            width: 40px;
            height: 40px;
            pointer-events: none;
            background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" stroke="%2300ffff" stroke-width="2" fill="none"/></svg>');
        }
    </style>
</head>
<body>
    <!-- Main Menu -->
    <div class="screen active" id="mainMenu">
        <div class="menu">
            <h1 class="title">SPACE COW DEFENSE</h1>
            <button class="btn" onclick="showScreen('gameScreen')">START</button>
            <button class="btn" onclick="showScreen('howToPlay')">HOW TO PLAY</button>
            <button class="btn" onclick="showScreen('leaderboard')">LEADERBOARD</button>
        </div>
    </div>

    <!-- How To Play -->
    <div class="screen" id="howToPlay">
        <div class="menu">
            <h2>HOW TO PLAY</h2>
            <p>Shoot space cows before they escape!</p>
            <p>Ammo: 5 shots before reload</p>
            <p>Time limit: 60 seconds</p>
            <button class="btn" onclick="showScreen('mainMenu')">BACK</button>
        </div>
    </div>

    <!-- Leaderboard -->
    <div class="screen" id="leaderboard">
        <div class="menu">
            <h2>TOP SCORES</h2>
            <div id="scores"></div>
            <button class="btn" onclick="showScreen('mainMenu')">BACK</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="screen" id="gameScreen">
        <div class="hud" id="topHud">
            Score: <span id="score">0</span> | 
            Time: <span id="timer">60</span>
        </div>
        <canvas id="gameCanvas"></canvas>
        <div class="hud" id="bottomHud">
            Ammo: <span id="ammo">5</span> | 
            Hits: <span id="hits">0</span>
        </div>
    </div>

    <div class="crosshair"></div>

    <script>
        // Game State
        let gameState = {
            score: 0,
            ammo: 5,
            hits: 0,
            time: 60,
            cows: [],
            interval: null,
            reloading: false
        };

        // Elements
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let crosshairX = 0, crosshairY = 0;

        // Screen Management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            if(screenId === 'gameScreen') startGame();
            if(screenId === 'leaderboard') updateLeaderboard();
        }

        // Game Functions
        function startGame() {
            // Reset state
            gameState = {
                score: 0,
                ammo: 5,
                hits: 0,
                time: 60,
                cows: [],
                interval: null,
                reloading: false
            };
            
            // Setup canvas
            canvas.width = 800;
            canvas.height = 600;
            
            // Start game loop
            gameState.interval = setInterval(gameLoop, 1000);
            
            // Input handlers
            canvas.addEventListener('mousemove', updateCrosshair);
            canvas.addEventListener('click', handleShoot);
        }

        function gameLoop() {
            // Update game state
            gameState.time--;
            document.getElementById('timer').textContent = gameState.time;
            
            // Spawn cows
            if(Math.random() < 0.1) {
                gameState.cows.push({
                    x: -50,
                    y: Math.random() * canvas.height,
                    speed: Math.random() * 3 + 2
                });
            }
            
            // Update cows
            gameState.cows = gameState.cows.filter(cow => {
                cow.x += cow.speed;
                return cow.x < canvas.width + 50;
            });
            
            // Update HUD
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('ammo').textContent = gameState.ammo;
            document.getElementById('hits').textContent = gameState.hits;
            
            // End game
            if(gameState.time <= 0) endGame();
        }

        function updateCrosshair(e) {
            const rect = canvas.getBoundingClientRect();
            crosshairX = e.clientX - rect.left;
            crosshairY = e.clientY - rect.top;
            document.querySelector('.crosshair').style.transform = 
                `translate(${e.clientX - 20}px, ${e.clientY - 20}px)`;
        }

        function handleShoot() {
            if(gameState.ammo > 0 && !gameState.reloading) {
                gameState.ammo--;
                
                // Check hits
                gameState.cows = gameState.cows.filter(cow => {
                    const hit = Math.abs(cow.x - crosshairX) < 30 && 
                               Math.abs(cow.y - crosshairY) < 30;
                    if(hit) {
                        gameState.score += 100;
                        gameState.hits++;
                    }
                    return !hit;
                });
                
                if(gameState.ammo === 0) reload();
            }
        }

        function reload() {
            gameState.reloading = true;
            setTimeout(() => {
                gameState.ammo = 5;
                gameState.reloading = false;
            }, 2000);
        }

        function endGame() {
            clearInterval(gameState.interval);
            updateLeaderboard();
            showScreen('mainMenu');
        }

        function updateLeaderboard() {
            let scores = JSON.parse(localStorage.getItem('scores') || '[]');
            scores.push(gameState.score);
            scores = scores.sort((a,b) => b - a).slice(0, 5);
            localStorage.setItem('scores', JSON.stringify(scores));
            
            document.getElementById('scores').innerHTML = 
                scores.map((s,i) => `<div>${i+1}. ${s}</div>`).join('');
        }

        // Init
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>