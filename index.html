<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cosmic Cow Hunt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --space-dark: #0A0E17;
            --neon-blue: #00F3FF;
            --warning-red: #FF4655;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: var(--space-dark);
            touch-action: none;
            font-family: 'Orbitron', sans-serif;
            color: white;
        }

        #gameCanvas {
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
        }

        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            background: radial-gradient(circle at center, #00111E 0%, #00090F 100%);
        }

        #mainMenu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .title {
            font-size: 2.5em;
            text-shadow: 0 0 15px var(--neon-blue);
            margin-bottom: 2em;
            background: linear-gradient(90deg, #00F3FF 0%, #7D41FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .menu-btn {
            width: 200px;
            padding: 15px;
            margin: 10px;
            background: rgba(0, 243, 255, 0.1);
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu-btn:hover {
            background: rgba(0, 243, 255, 0.3);
            transform: scale(1.05);
        }

        #hud {
            position: absolute;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            box-sizing: border-box;
            font-size: 1.2em;
        }

        #bottomHUD {
            position: absolute;
            bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .hearts {
            display: flex;
            gap: 5px;
        }

        .heart {
            width: 25px;
            height: 25px;
            background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 24 24" fill="red" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
        }

        #crosshair {
            position: absolute;
            width: 40px;
            height: 40px;
            pointer-events: none;
            background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 100" fill="%2300F3FF" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" stroke="%2300F3FF" stroke-width="2" fill="none"/><line x1="50" y1="10" x2="50" y2="30" stroke="%2300F3FF" stroke-width="2"/><line x1="50" y1="70" x2="50" y2="90" stroke="%2300F3FF" stroke-width="2"/><line x1="10" y1="50" x2="30" y2="50" stroke="%2300F3FF" stroke-width="2"/><line x1="70" y1="50" x2="90" y2="50" stroke="%2300F3FF" stroke-width="2"/></svg>');
            background-size: contain;
            transition: 0.1s;
        }

        #timer {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5em;
            text-shadow: 0 0 10px var(--neon-blue);
        }
    </style>
</head>
<body>
    <div id="mainMenu" class="screen">
        <h1 class="title">COSMIC COW HUNT</h1>
        <button class="menu-btn" id="startBtn">START MISSION</button>
        <button class="menu-btn" id="howToPlayBtn">BRIEFING</button>
        <button class="menu-btn" id="highscoresBtn">LEADERBOARD</button>
    </div>

    <div id="gameScreen" class="screen">
        <div id="hud">
            <div>SCORE: <span id="score">0</span></div>
            <div id="timer">01:00</div>
            <div class="hearts" id="lives"></div>
        </div>
        
        <canvas id="gameCanvas"></canvas>
        
        <div id="bottomHUD">
            <div>AMMO: <span id="ammo">5</span></div>
            <div>HITS: <span id="hits">0</span></div>
            <div>MISS: <span id="miss">0</span></div>
        </div>
    </div>

    <div id="howToPlay" class="screen">
        <div style="padding: 20px; max-width: 500px;">
            <h2 class="title">MISSION BRIEFING</h2>
            <p>- Tap to shoot (5 ammo)</p>
            <p>- Press R or tap ammo to reload</p>
            <p>- Avoid hitting civilians (red cows)</p>
            <p>- Complete in 60 seconds</p>
            <button class="menu-btn" style="margin-top: 30px;" onclick="showScreen('mainMenu')">BACK</button>
        </div>
    </div>

    <div id="highscores" class="screen">
        <div style="padding: 20px;">
            <h2 class="title">LEADERBOARD</h2>
            <div id="leaderboard"></div>
            <button class="menu-btn" style="margin-top: 30px;" onclick="showScreen('mainMenu')">BACK</button>
        </div>
    </div>

    <div id="crosshair"></div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameState = {
            targets: [],
            score: 0,
            ammo: 5,
            hits: 0,
            miss: 0,
            lives: 3,
            timeLeft: 60,
            isPlaying: false,
            reloading: false,
            cowTypes: ['normal', 'fast', 'boss', 'civilian']
        };

        // Leaderboard
        let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];

        function updateLeaderboard() {
            const list = document.getElementById('leaderboard');
            list.innerHTML = leaderboard.slice(0,5).map((entry,i) => 
                `<div>${i+1}. ${entry.name}: ${entry.score}</div>`
            ).join('');
        }

        // Screen management
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
            if(id === 'highscores') updateLeaderboard();
        }

        // Game initialization
        function initGame() {
            canvas.width = Math.min(window.innerWidth, 800);
            canvas.height = Math.min(window.innerHeight, 600);
            
            gameState = {
                targets: [],
                score: 0,
                ammo: 5,
                hits: 0,
                miss: 0,
                lives: 3,
                timeLeft: 60,
                isPlaying: true,
                reloading: false
            };

            // Init lives display
            document.getElementById('lives').innerHTML = 
                Array(3).fill('<div class="heart"></div>').join('');
            
            showScreen('gameScreen');
            gameLoop();
            updateTimer();
        }

        // Cow patterns
        function createCow() {
            const type = gameState.cowTypes[Math.floor(Math.random() * 3.5)];
            return {
                x: Math.random() < 0.5 ? -60 : canvas.width + 60,
                y: Math.random() * (canvas.height - 100),
                speed: type === 'fast' ? 6 : type === 'boss' ? 3 : 4,
                width: type === 'boss' ? 80 : 50,
                height: 40,
                type,
                direction: Math.random() < 0.5 ? 1 : -1,
                angle: 0,
                pattern: Math.random() * Math.PI * 2
            };
        }

        // Movement patterns
        function updateTargets() {
            gameState.targets = gameState.targets.filter(cow => {
                cow.x += cow.direction * cow.speed;
                cow.y += Math.sin(cow.pattern + Date.now()/200) * 2;
                
                if(cow.type === 'fast') {
                    cow.y += Math.sin(Date.now()/100) * 3;
                }
                
                return cow.x > -100 && cow.x < canvas.width + 100;
            });
        }

        // Drawing
        function drawCow(cow) {
            ctx.save();
            ctx.translate(cow.x, cow.y);
            
            // Body
            ctx.fillStyle = cow.type === 'civilian' ? '#FF4655' : 
                           cow.type === 'boss' ? '#7D41FF' : '#00F3FF';
            ctx.fillRect(-20, -10, 40, 20);
            
            // Head
            ctx.beginPath();
            ctx.arc(20, 0, 10, 0, Math.PI * 2);
            ctx.fill();
            
            // Legs
            ctx.fillRect(-15, 10, 5, 15);
            ctx.fillRect(5, 10, 5, 15);
            
            // Wings
            ctx.beginPath();
            ctx.ellipse(-25, 0, 15, 5, Math.PI/4, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();
        }

        // Game loop
        function gameLoop() {
            if(!gameState.isPlaying) return;

            ctx.fillStyle = var(--space-dark);
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Spawn cows
            if(Math.random() < 0.03) gameState.targets.push(createCow());
            
            updateTargets();
            
            // Draw cows
            gameState.targets.forEach(drawCow);
            
            requestAnimationFrame(gameLoop);
        }

        // Input handling
        canvas.addEventListener('click', e => {
            if(!gameState.isPlaying || gameState.reloading) return;
            
            if(gameState.ammo > 0) {
                gameState.ammo--;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const hit = gameState.targets.some(cow => {
                    const dist = Math.hypot(x - cow.x, y - cow.y);
                    if(dist < 30) {
                        gameState.score += cow.type === 'boss' ? 200 : 100;
                        gameState.hits++;
                        if(cow.type === 'civilian') gameState.lives--;
                        return true;
                    }
                    return false;
                });
                
                if(!hit) gameState.miss++;
                updateHUD();
                
                if(gameState.ammo === 0) reload();
            }
        });

        function reload() {
            gameState.reloading = true;
            crosshair.style.backgroundImage = 'none';
            crosshair.innerHTML = 'RELOADING';
            setTimeout(() => {
                gameState.ammo = 5;
                gameState.reloading = false;
                crosshair.style.backgroundImage = `url('data:image/svg+xml;utf8,...')`;
                crosshair.innerHTML = '';
                updateHUD();
            }, 2000);
        }

        function updateHUD() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('ammo').textContent = gameState.ammo;
            document.getElementById('hits').textContent = gameState.hits;
            document.getElementById('miss').textContent = gameState.miss;
            document.getElementById('lives').innerHTML = 
                Array(gameState.lives).fill('<div class="heart"></div>').join('') +
                Array(3-gameState.lives).fill('<div class="heart" style="opacity:0.2"></div>').join('');
        }

        // Timer
        function updateTimer() {
            const timer = setInterval(() => {
                gameState.timeLeft--;
                document.getElementById('timer').textContent = 
                    `${String(Math.floor(gameState.timeLeft/60)).padStart(2,'0')}:` +
                    `${String(gameState.timeLeft%60).padStart(2,'0')}`;
                
                if(gameState.timeLeft <= 0 || gameState.lives <= 0) {
                    clearInterval(timer);
                    gameState.isPlaying = false;
                    const name = prompt('Mission failed! Enter your callsign:');
                    leaderboard.push({name, score: gameState.score});
                    leaderboard.sort((a,b) => b.score - a.score);
                    localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
                    showScreen('mainMenu');
                }
            }, 1000);
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', initGame);
        document.getElementById('howToPlayBtn').addEventListener('click', () => showScreen('howToPlay'));
        document.getElementById('highscoresBtn').addEventListener('click', () => showScreen('highscores'));
        document.addEventListener('keydown', e => e.key === 'r' && !gameState.reloading && reload());

        // Init
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        showScreen('mainMenu');
    </script>
</body>
</html>