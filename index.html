<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medieval Tamagotchi</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary-color: #8B4513;
            --secondary-color: #A0522D;
            --dark-color: #5D2906;
            --light-color: #D2B48C;
            --highlight-color: #CD853F;
            --text-color: #FFF8DC;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 0;
            background-color: var(--dark-color);
            color: var(--text-color);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%235D2906" d="M0 0h100v100H0z"/><path fill="%233D1D08" d="M0 20h100v5H0zM0 40h100v5H0zM0 60h100v5H0zM0 80h100v5H0zM20 0h5v100h-5zM40 0h5v100h-5zM60 0h5v100h-5zM80 0h5v100h-5z"/></svg>');
            background-size: 40px 40px;
        }
        
        #main-menu, #game-screen, #evolution-screen, #collection-screen {
            background-color: var(--primary-color);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3), inset 0 0 0 2px var(--highlight-color);
            margin: 20px auto;
            display: none;
            border: 8px solid transparent;
            border-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%23A0522D" d="M12 2L2 7v10l10 5 10-5V7L12 2z"/><path fill="%23D2B48C" d="M12 2l10 5v10L12 22V2z"/></svg>') 10 stretch;
        }
        
        h1, h2, h3 {
            color: var(--text-color);
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-weight: bold;
            font-style: italic;
            letter-spacing: 1px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            background: linear-gradient(to right, var(--light-color), var(--highlight-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        button {
            background-color: var(--secondary-color);
            border: none;
            color: var(--text-color);
            padding: 12px 20px;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 18px;
            margin: 8px 4px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            border: 2px solid var(--dark-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        button:hover {
            background-color: var(--highlight-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            background-color: #5D2906;
            color: #7a5c3c;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .stats {
            margin: 15px 0;
            padding: 15px;
            background-color: rgba(90, 40, 10, 0.7);
            border-radius: 8px;
            border: 2px solid var(--highlight-color);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }
        
        .progress-container {
            width: 100%;
            background-color: var(--dark-color);
            border-radius: 5px;
            margin: 8px 0;
            height: 20px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(to right, #8B0000, #FF4500);
            text-align: center;
            line-height: 20px;
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
            transition: width 0.5s;
        }
        
        .pet-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .pet-item {
            position: relative;
            border: 3px solid var(--highlight-color);
            border-radius: 10px;
            padding: 10px;
            background-color: rgba(139, 69, 19, 0.7);
            cursor: pointer;
            transition: all 0.3s;
            width: 80px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }
        
        .pet-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--highlight-color);
            background-color: rgba(139, 69, 19, 0.9);
        }
        
        .pet-item.selected {
            border-color: gold;
            box-shadow: 0 0 15px gold;
            background-color: rgba(205, 133, 63, 0.9);
        }
        
        .pet-item.dead {
            opacity: 0.6;
            filter: grayscale(70%);
        }
        
        .pet-emoji {
            font-size: 36px;
            margin-bottom: 5px;
            animation: float 2s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .pet-level {
            font-size: 14px;
            background-color: var(--dark-color);
            color: gold;
            padding: 2px 6px;
            border-radius: 10px;
            position: absolute;
            top: 5px;
            right: 5px;
        }
        
        .pet-type {
            font-size: 12px;
            margin-top: 5px;
        }
        
        .actions-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }
        
        .pet-counter {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: var(--secondary-color);
            color: var(--text-color);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 100;
            border: 1px solid var(--highlight-color);
        }
        
        .evolution-animation {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            animation: pulse 1s infinite;
        }
        
        .hidden {
            display: none;
        }
        
        #pet-display {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        #current-pet {
            position: relative;
        }
        
        #pet-emoji {
            font-size: 64px;
            animation: float 3s ease-in-out infinite;
        }
        
        .health-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        
        .menu-button {
            display: block;
            width: 100%;
            margin: 10px 0;
            font-size: 20px;
            padding: 15px;
        }
        
        #about-text {
            line-height: 1.6;
            text-align: justify;
        }
    </style>
</head>
<body>
    <div id="main-menu">
        <h1>Medieval Tamagotchi</h1>
        <button id="new-game-btn" class="menu-button">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        <button id="continue-game-btn" class="menu-button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <button id="collection-btn" class="menu-button">–ö–æ–ª–ª–µ–∫—Ü–∏—è</button>
        <button id="about-btn" class="menu-button">–û–± –∏–≥—Ä–µ</button>
    </div>
    
    <div id="game-screen">
        <h2 id="pet-type">–ú–µ–¥–≤–µ–∂–æ–Ω–æ–∫</h2>
        
        <div id="pet-display">
            <div id="current-pet">
                <div id="pet-emoji">üêª</div>
                <div class="health-indicator" id="health-indicator">100</div>
            </div>
        </div>
        
        <div class="stats">
            <div>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
            <div>–û–ø—ã—Ç: <span id="exp">0</span>/<span id="exp-to-next">100</span></div>
            <div class="progress-container">
                <div id="exp-bar" class="progress-bar" style="width: 0%">0%</div>
            </div>
        </div>
        
        <div class="stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: <span id="health">100</span>/<span id="max-health">100</span></div>
            <div class="progress-container">
                <div id="health-bar" class="progress-bar" style="width: 100%">100%</div>
            </div>
            
            <div>–ì–æ–ª–æ–¥: <span id="hunger">50</span>/100</div>
            <div class="progress-container">
                <div id="hunger-bar" class="progress-bar" style="width: 50%">50%</div>
            </div>
            
            <div>–≠–Ω–µ—Ä–≥–∏—è: <span id="energy">80</span>/100</div>
            <div class="progress-container">
                <div id="energy-bar" class="progress-bar" style="width: 80%">80%</div>
            </div>
            
            <div>–°—á–∞—Å—Ç—å–µ: <span id="happiness">70</span>/100</div>
            <div class="progress-container">
                <div id="happiness-bar" class="progress-bar" style="width: 70%">70%</div>
            </div>
        </div>
        
        <div class="actions-container">
            <button id="feed-btn">üçó –ö–æ—Ä–º–∏—Ç—å</button>
            <button id="play-btn">üé≤ –ò–≥—Ä–∞—Ç—å</button>
            <button id="sleep-btn">üõå –°–ø–∞—Ç—å</button>
            <button id="heal-btn">üíä –õ–µ—á–∏—Ç—å</button>
            <button id="train-btn">‚öîÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        
        <div id="evolution-container" class="hidden">
            <button id="evolve-btn">‚ú® –≠–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å!</button>
        </div>
        
        <button id="menu-btn" style="margin-top: 20px; width: 100%;">üè∞ –ú–µ–Ω—é</button>
    </div>
    
    <div id="evolution-screen">
        <h2>–≠–≤–æ–ª—é—Ü–∏—è!</h2>
        <div class="evolution-animation" id="evolution-emoji">üêª ‚ûî üêª‚Äç‚ùÑÔ∏è</div>
        <p id="evolution-text">–í–∞—à –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫ –¥–æ—Å—Ç–∏–≥ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏ –≥–æ—Ç–æ–≤ –∫ —ç–≤–æ–ª—é—Ü–∏–∏!</p>
        <button id="evolution-continue-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
    
    <div id="collection-screen">
        <h2>–í–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è</h2>
        <div class="pet-container" id="pets-container">
            <!-- –ü–∏—Ç–æ–º—Ü—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>
        <button id="collection-back-btn">–ù–∞–∑–∞–¥</button>
    </div>
    
    <div id="about-screen" style="display: none; background-color: var(--primary-color); padding: 20px; border-radius: 10px; border: 8px solid transparent; border-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"%23A0522D\" d=\"M12 2L2 7v10l10 5 10-5V7L12 2z\"/><path fill=\"%23D2B48C\" d=\"M12 2l10 5v10L12 22V2z\"/></svg>') 10 stretch;">
        <h2>–û–± –∏–≥—Ä–µ</h2>
        <div id="about-text">
            <p>Medieval Tamagotchi - —ç—Ç–æ –∏–≥—Ä–∞ –≤ —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–æ–º —Å—Ç–∏–ª–µ, –≥–¥–µ –≤—ã —É—Ö–∞–∂–∏–≤–∞–µ—Ç–µ –∑–∞ –≤–æ–ª—à–µ–±–Ω—ã–º–∏ –º–µ–¥–≤–µ–∂–∞—Ç–∞–º–∏.</p>
            <p>–ö–æ–≥–¥–∞ –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è, –æ–Ω —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ –±–æ–ª–µ–µ —Å–∏–ª—å–Ω—É—é —Ñ–æ—Ä–º—É –∏ –º–æ–∂–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å—Å—è, —Å–æ–∑–¥–∞–≤ –Ω–æ–≤–æ–≥–æ –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞.</p>
            <p>–ö–∞–∂–¥—ã–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫ –∏–º–µ–µ—Ç:</p>
            <ul>
                <li>–ó–¥–æ—Ä–æ–≤—å–µ - –µ—Å–ª–∏ —É–ø–∞–¥–µ—Ç –¥–æ 0, –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫ —É–º—Ä–µ—Ç</li>
                <li>–ì–æ–ª–æ–¥ - —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º</li>
                <li>–≠–Ω–µ—Ä–≥–∏—é - —Ç—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è</li>
                <li>–°—á–∞—Å—Ç—å–µ - –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞</li>
            </ul>
            <p>–¶–µ–ª—å - —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –º–µ–¥–≤–µ–∂–∞—Ç –∏ –¥–æ—Å—Ç–∏—á—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!</p>
        </div>
        <button id="about-back-btn">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="pet-counter" class="hidden">–ú–µ–¥–≤–µ–∂–∞—Ç: 0</div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            pets: [],
            currentPetIndex: 0,
            lastUpdate: Date.now(),
            unlockedSpecies: new Set(['brown']),
            version: 1
        };
        
        // –í–∏–¥—ã –º–µ–¥–≤–µ–∂–∞—Ç –∏ –∏—Ö —ç–≤–æ–ª—é—Ü–∏–∏
        const speciesData = {
            'brown': {
                name: '–ë—É—Ä—ã–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª',
                color: '#8B4513',
                requirements: { level: 0 },
                next: ['polar', 'black'],
                stats: { health: 100, hunger: 50, energy: 80, happiness: 70 }
            },
            'polar': {
                name: '–ë–µ–ª—ã–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª‚Äç‚ùÑÔ∏è',
                color: '#F8F8FF',
                requirements: { level: 3 },
                next: ['golden', 'moon'],
                stats: { health: 120, hunger: 60, energy: 90, happiness: 80 }
            },
            'black': {
                name: '–ß–µ—Ä–Ω—ã–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª',
                color: '#000000',
                requirements: { level: 3 },
                next: ['specter', 'demon'],
                stats: { health: 150, hunger: 70, energy: 70, happiness: 60 }
            },
            'golden': {
                name: '–ó–æ–ª–æ—Ç–æ–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª',
                color: '#FFD700',
                requirements: { level: 6 },
                next: ['phoenix'],
                stats: { health: 150, hunger: 70, energy: 100, happiness: 90 }
            },
            'moon': {
                name: '–õ—É–Ω–Ω—ã–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª',
                color: '#4682B4',
                requirements: { level: 6 },
                next: ['cosmic'],
                stats: { health: 130, hunger: 80, energy: 80, happiness: 85 }
            },
            'specter': {
                name: '–ú–µ–¥–≤–µ–∂–æ–Ω–æ–∫-–ø—Ä–∏–∑—Ä–∞–∫',
                emoji: 'üêª',
                color: '#E6E6FA',
                requirements: { level: 6 },
                next: ['phantom'],
                stats: { health: 200, hunger: 90, energy: 120, happiness: 70 }
            },
            'demon': {
                name: '–î–µ–º–æ–Ω–∏—á–µ—Å–∫–∏–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª',
                color: '#8B0000',
                requirements: { level: 6 },
                next: ['infernal'],
                stats: { health: 180, hunger: 50, energy: 60, happiness: 75 }
            },
            'phoenix': {
                name: '–§–µ–Ω–∏–∫—Å-–º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª',
                color: '#FF4500',
                requirements: { level: 10 },
                next: [],
                stats: { health: 250, hunger: 80, energy: 150, happiness: 100 }
            },
            'cosmic': {
                name: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª',
                color: '#9400D3',
                requirements: { level: 10 },
                next: [],
                stats: { health: 200, hunger: 90, energy: 100, happiness: 95 }
            },
            'phantom': {
                name: '–§–∞–Ω—Ç–æ–º–Ω—ã–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª',
                color: '#4B0082',
                requirements: { level: 10 },
                next: [],
                stats: { health: 300, hunger: 100, energy: 150, happiness: 80 }
            },
            'infernal': {
                name: '–ò–Ω—Ñ–µ—Ä–Ω–∞–ª—å–Ω—ã–π –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫',
                emoji: 'üêª',
                color: '#B22222',
                requirements: { level: 10 },
                next: [],
                stats: { health: 220, hunger: 70, energy: 90, happiness: 90 }
            }
        };
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const elements = {
            mainMenu: document.getElementById('main-menu'),
            gameScreen: document.getElementById('game-screen'),
            evolutionScreen: document.getElementById('evolution-screen'),
            collectionScreen: document.getElementById('collection-screen'),
            aboutScreen: document.getElementById('about-screen'),
            petCounter: document.getElementById('pet-counter'),
            
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            newGameBtn: document.getElementById('new-game-btn'),
            continueGameBtn: document.getElementById('continue-game-btn'),
            collectionBtn: document.getElementById('collection-btn'),
            aboutBtn: document.getElementById('about-btn'),
            menuBtn: document.getElementById('menu-btn'),
            collectionBackBtn: document.getElementById('collection-back-btn'),
            aboutBackBtn: document.getElementById('about-back-btn'),
            
            // –ò–≥—Ä–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            petType: document.getElementById('pet-type'),
            petEmoji: document.getElementById('pet-emoji'),
            healthIndicator: document.getElementById('health-indicator'),
            level: document.getElementById('level'),
            exp: document.getElementById('exp'),
            expToNext: document.getElementById('exp-to-next'),
            expBar: document.getElementById('exp-bar'),
            health: document.getElementById('health'),
            maxHealth: document.getElementById('max-health'),
            healthBar: document.getElementById('health-bar'),
            hunger: document.getElementById('hunger'),
            hungerBar: document.getElementById('hunger-bar'),
            energy: document.getElementById('energy'),
            energyBar: document.getElementById('energy-bar'),
            happiness: document.getElementById('happiness'),
            happinessBar: document.getElementById('happiness-bar'),
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            feedBtn: document.getElementById('feed-btn'),
            playBtn: document.getElementById('play-btn'),
            sleepBtn: document.getElementById('sleep-btn'),
            healBtn: document.getElementById('heal-btn'),
            trainBtn: document.getElementById('train-btn'),
            
            // –≠–≤–æ–ª—é—Ü–∏—è
            evolveBtn: document.getElementById('evolve-btn'),
            evolutionContainer: document.getElementById('evolution-container'),
            evolutionEmoji: document.getElementById('evolution-emoji'),
            evolutionText: document.getElementById('evolution-text'),
            evolutionContinueBtn: document.getElementById('evolution-continue-btn'),
            
            // –ö–æ–ª–ª–µ–∫—Ü–∏—è
            petsContainer: document.getElementById('pets-container')
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGame();
            setupEventListeners();
            updateMenu();
            
            if (gameState.pets.length > 0) {
                showGameScreen();
                updateGameUI();
                updatePetCounter();
            } else {
                showMainMenu();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            setInterval(gameLoop, 1000);
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            elements.newGameBtn.addEventListener('click', startNewGame);
            elements.continueGameBtn.addEventListener('click', showGameScreen);
            elements.collectionBtn.addEventListener('click', showCollectionScreen);
            elements.aboutBtn.addEventListener('click', showAboutScreen);
            elements.menuBtn.addEventListener('click', showMainMenu);
            elements.collectionBackBtn.addEventListener('click', showMainMenu);
            elements.aboutBackBtn.addEventListener('click', showMainMenu);
            
            // –ò–≥—Ä–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
            elements.feedBtn.addEventListener('click', () => performAction('feed'));
            elements.playBtn.addEventListener('click', () => performAction('play'));
            elements.sleepBtn.addEventListener('click', () => performAction('sleep'));
            elements.healBtn.addEventListener('click', () => performAction('heal'));
            elements.trainBtn.addEventListener('click', () => performAction('train'));
            
            // –≠–≤–æ–ª—é—Ü–∏—è
            elements.evolveBtn.addEventListener('click', startEvolution);
            elements.evolutionContinueBtn.addEventListener('click', finishEvolution);
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (gameState.pets.length === 0) return;
            
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdate) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdate = now;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ—Ö –ø–∏—Ç–æ–º—Ü–µ–≤ (–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π)
            gameState.pets.forEach((pet, index) => {
                const isActive = index === gameState.currentPetIndex;
                updatePet(pet, deltaTime, isActive);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            saveGame();
            updateGameUI();
            updatePetCounter();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞
        function updatePet(pet, deltaTime, isActive) {
            // –£–º–µ–Ω—å—à–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
            if (isActive) {
                pet.hunger = Math.max(0, pet.hunger - 0.5 * deltaTime);
                pet.energy = Math.max(0, pet.energy - 0.3 * deltaTime);
                pet.happiness = Math.max(0, pet.happiness - 0.2 * deltaTime);
                
                // –ï—Å–ª–∏ –≥–æ–ª–æ–¥ –∏–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –Ω–∞ –Ω—É–ª–µ, —É–º–µ–Ω—å—à–∞–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
                if (pet.hunger <= 0 || pet.energy <= 0) {
                    pet.health = Math.max(0, pet.health - 1 * deltaTime);
                }
                
                // –ï—Å–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ –Ω—É–ª–µ, —É–º–µ–Ω—å—à–∞–µ–º —Å—á–∞—Å—Ç—å–µ
                if (pet.health <= 0) {
                    pet.happiness = Math.max(0, pet.happiness - 1 * deltaTime);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫
            if (pet.health <= 0 && !pet.isDead) {
                pet.isDead = true;
                pet.deathTime = Date.now();
            }
            
            // –ï—Å–ª–∏ –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫ –º–µ—Ä—Ç–≤ –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç, —É–¥–∞–ª—è–µ–º –µ–≥–æ
            if (pet.isDead && Date.now() - pet.deathTime > 300000) {
                const index = gameState.pets.indexOf(pet);
                if (index !== -1) {
                    gameState.pets.splice(index, 1);
                    if (gameState.currentPetIndex >= index) {
                        gameState.currentPetIndex = Math.max(0, gameState.currentPetIndex - 1);
                    }
                }
            }
        }
        
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –º–µ–¥–≤–µ–∂–æ–Ω–∫–æ–º
        function performAction(action) {
            const pet = getCurrentPet();
            if (!pet || pet.isDead) return;
            
            switch (action) {
                case 'feed':
                    pet.hunger = Math.min(100, pet.hunger + 30);
                    pet.energy = Math.min(100, pet.energy - 5);
                    pet.exp += 5;
                    break;
                case 'play':
                    pet.happiness = Math.min(100, pet.happiness + 20);
                    pet.energy = Math.min(100, pet.energy - 10);
                    pet.hunger = Math.max(0, pet.hunger - 5);
                    pet.exp += 10;
                    break;
                case 'sleep':
                    pet.energy = Math.min(100, pet.energy + 40);
                    pet.hunger = Math.max(0, pet.hunger - 10);
                    pet.exp += 5;
                    break;
                case 'heal':
                    pet.health = Math.min(getSpeciesData(pet.species).stats.health, pet.health + 30);
                    pet.energy = Math.max(0, pet.energy - 15);
                    pet.exp += 5;
                    break;
                case 'train':
                    pet.energy = Math.max(0, pet.energy - 20);
                    pet.hunger = Math.max(0, pet.hunger - 15);
                    pet.exp += 20;
                    break;
            }
            
            checkLevelUp(pet);
            updateGameUI();
            saveGame();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function checkLevelUp(pet) {
            const expNeeded = getExpForLevel(pet.level + 1);
            
            if (pet.exp >= expNeeded) {
                pet.level++;
                pet.exp -= expNeeded;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —ç–≤–æ–ª—é—Ü–∏—è
                checkEvolution(pet);
                
                // –ï—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –∫—Ä–∞—Ç–µ–Ω 3, –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫ –º–æ–∂–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å—Å—è
                if (pet.level % 3 === 0 && gameState.pets.length < 10) {
                    reproducePet(pet);
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —ç–≤–æ–ª—é—Ü–∏–∏
        function checkEvolution(pet) {
            const speciesInfo = speciesData[pet.species];
            const nextSpecies = speciesInfo.next;
            
            for (const next of nextSpecies) {
                if (pet.level >= speciesData[next].requirements.level) {
                    pet.canEvolve = true;
                    elements.evolutionContainer.classList.remove('hidden');
                    return;
                }
            }
        }
        
        // –≠–≤–æ–ª—é—Ü–∏—è –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞
        function startEvolution() {
            const pet = getCurrentPet();
            if (!pet || !pet.canEvolve) return;
            
            const speciesInfo = speciesData[pet.species];
            const possibleEvolutions = speciesInfo.next.filter(next => 
                pet.level >= speciesData[next].requirements.level
            );
            
            if (possibleEvolutions.length > 0) {
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —ç–≤–æ–ª—é—Ü–∏—é –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
                const newSpecies = possibleEvolutions[Math.floor(Math.random() * possibleEvolutions.length)];
                const newSpeciesInfo = speciesData[newSpecies];
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —ç–≤–æ–ª—é—Ü–∏–∏
                showEvolutionScreen(pet, newSpecies);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —ç–≤–æ–ª—é—Ü–∏–∏
                elements.evolutionEmoji.textContent = `${speciesInfo.emoji} ‚ûî ${newSpeciesInfo.emoji}`;
                elements.evolutionText.textContent = `–í–∞—à ${speciesInfo.name} —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ ${newSpeciesInfo.name}!`;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π –≤–∏–¥ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ
                pet.newSpecies = newSpecies;
            }
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç–≤–æ–ª—é—Ü–∏–∏
        function finishEvolution() {
            const pet = getCurrentPet();
            if (!pet || !pet.newSpecies) return;
            
            // –ú–µ–Ω—è–µ–º –≤–∏–¥ –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞
            pet.species = pet.newSpecies;
            delete pet.newSpecies;
            pet.canEvolve = false;
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –≤–∏–¥ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
            gameState.unlockedSpecies.add(pet.species);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞
            const speciesStats = speciesData[pet.species].stats;
            pet.health = speciesStats.health;
            pet.hunger = speciesStats.hunger;
            pet.energy = speciesStats.energy;
            pet.happiness = speciesStats.happiness;
            
            showGameScreen();
            updateGameUI();
            saveGame();
        }
        
        // –†–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞ –¥–µ–ª–µ–Ω–∏–µ–º
        function reproducePet(parentPet) {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–¥–∏—Ç–µ–ª—è
            const newPet = {
                species: parentPet.species,
                level: 1,
                exp: 0,
                health: speciesData[parentPet.species].stats.health,
                hunger: speciesData[parentPet.species].stats.hunger,
                energy: speciesData[parentPet.species].stats.energy,
                happiness: speciesData[parentPet.species].stats.happiness,
                isDead: false,
                canEvolve: false,
                birthTime: Date.now()
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
            gameState.pets.push(newPet);
            
            // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            alert(`–í–∞—à –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫ –¥–æ—Å—Ç–∏–≥ —É—Ä–æ–≤–Ω—è ${parentPet.level} –∏ —Ä–∞–∑–¥–µ–ª–∏–ª—Å—è! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å ${gameState.pets.length} –º–µ–¥–≤–µ–∂–∞—Ç!`);
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞
        function getCurrentPet() {
            return gameState.pets[gameState.currentPetIndex];
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ
        function getSpeciesData(species) {
            return speciesData[species] || speciesData['brown'];
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–ø—ã—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω—è
        function getExpForLevel(level) {
            return 100 * Math.pow(level, 1.5);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–≥—Ä—ã
        function updateGameUI() {
            const pet = getCurrentPet();
            if (!pet) return;
            
            const speciesInfo = getSpeciesData(pet.species);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            elements.petType.textContent = speciesInfo.name;
            elements.petEmoji.textContent = speciesInfo.emoji;
            elements.petEmoji.style.color = speciesInfo.color;
            elements.level.textContent = pet.level;
            elements.exp.textContent = Math.floor(pet.exp);
            elements.expToNext.textContent = Math.floor(getExpForLevel(pet.level + 1));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
            const expPercent = (pet.exp / getExpForLevel(pet.level + 1)) * 100;
            elements.expBar.style.width = `${expPercent}%`;
            elements.expBar.textContent = `${Math.floor(expPercent)}%`;
            
            elements.health.textContent = Math.floor(pet.health);
            elements.maxHealth.textContent = speciesInfo.stats.health;
            const healthPercent = (pet.health / speciesInfo.stats.health) * 100;
            elements.healthBar.style.width = `${healthPercent}%`;
            elements.healthBar.textContent = `${Math.floor(healthPercent)}%`;
            elements.healthIndicator.textContent = Math.floor(pet.health);
            
            elements.hunger.textContent = Math.floor(pet.hunger);
            elements.hungerBar.style.width = `${pet.hunger}%`;
            elements.hungerBar.textContent = `${Math.floor(pet.hunger)}%`;
            
            elements.energy.textContent = Math.floor(pet.energy);
            elements.energyBar.style.width = `${pet.energy}%`;
            elements.energyBar.textContent = `${Math.floor(pet.energy)}%`;
            
            elements.happiness.textContent = Math.floor(pet.happiness);
            elements.happinessBar.style.width = `${pet.happiness}%`;
            elements.happinessBar.textContent = `${Math.floor(pet.happiness)}%`;
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –º–µ–¥–≤–µ–∂–æ–Ω–æ–∫ –º–µ—Ä—Ç–≤
            if (pet.isDead) {
                elements.feedBtn.disabled = true;
                elements.playBtn.disabled = true;
                elements.sleepBtn.disabled = true;
                elements.healBtn.disabled = true;
                elements.trainBtn.disabled = true;
                elements.evolveBtn.disabled = true;
                elements.petType.textContent = `${speciesInfo.name} (—É–º–µ—Ä)`;
            } else {
                elements.feedBtn.disabled = false;
                elements.playBtn.disabled = false;
                elements.sleepBtn.disabled = false;
                elements.healBtn.disabled = false;
                elements.trainBtn.disabled = false;
                elements.evolveBtn.disabled = !pet.canEvolve;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –º–µ–¥–≤–µ–∂–∞—Ç
        function updatePetCounter() {
            if (gameState.pets.length > 0) {
                elements.petCounter.textContent = `–ú–µ–¥–≤–µ–∂–∞—Ç: ${gameState.pets.length}`;
                elements.petCounter.classList.remove('hidden');
            } else {
                elements.petCounter.classList.add('hidden');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é
        function updateMenu() {
            elements.continueGameBtn.disabled = gameState.pets.length === 0;
            elements.collectionBtn.disabled = gameState.pets.length === 0;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function updateCollectionScreen() {
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –º–µ–¥–≤–µ–∂–∞—Ç–∞–º–∏
            elements.petsContainer.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–¥–≤–µ–∂–∞—Ç –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
            gameState.pets.forEach((pet, index) => {
                const speciesInfo = getSpeciesData(pet.species);
                
                const petElement = document.createElement('div');
                petElement.className = `pet-item ${pet.isDead ? 'dead' : ''} ${index === gameState.currentPetIndex ? 'selected' : ''}`;
                
                petElement.innerHTML = `
                    <div class="pet-emoji" style="color: ${speciesInfo.color}">${speciesInfo.emoji}</div>
                    <div class="pet-level">${pet.level}</div>
                    <div class="pet-type">${speciesInfo.name}</div>
                `;
                
                petElement.addEventListener('click', () => {
                    gameState.currentPetIndex = index;
                    showGameScreen();
                    updateGameUI();
                });
                
                elements.petsContainer.appendChild(petElement);
            });
        }
        
        // –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
        function startNewGame() {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞
            const newPet = {
                species: 'brown',
                level: 1,
                exp: 0,
                health: 100,
                hunger: 50,
                energy: 80,
                happiness: 70,
                isDead: false,
                canEvolve: false,
                birthTime: Date.now()
            };
            
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã—Ö –º–µ–¥–≤–µ–∂–∞—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ
            gameState.pets = [newPet];
            gameState.currentPetIndex = 0;
            gameState.unlockedSpecies = new Set(['brown']);
            gameState.lastUpdate = Date.now();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
            saveGame();
            showGameScreen();
            updateGameUI();
            updateMenu();
            updatePetCounter();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        function saveGame() {
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º Set –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            const saveData = {
                ...gameState,
                unlockedSpecies: Array.from(gameState.unlockedSpecies)
            };
            localStorage.setItem('medievalTamagotchi', JSON.stringify(saveData));
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
        function loadGame() {
            const savedGame = localStorage.getItem('medievalTamagotchi');
            if (savedGame) {
                const parsed = JSON.parse(savedGame);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
                if (parsed.version === gameState.version) {
                    gameState = parsed;
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Set –∏–∑ –º–∞—Å—Å–∏–≤–∞
                    if (Array.isArray(gameState.unlockedSpecies)) {
                        gameState.unlockedSpecies = new Set(gameState.unlockedSpecies);
                    }
                }
            }
        }
        
        // –°–∫—Ä—ã—Ç—å –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
        function hideAllScreens() {
            elements.mainMenu.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.evolutionScreen.style.display = 'none';
            elements.collectionScreen.style.display = 'none';
            elements.aboutScreen.style.display = 'none';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        function showMainMenu() {
            hideAllScreens();
            elements.mainMenu.style.display = 'block';
            updateMenu();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∏–≥—Ä—ã
        function showGameScreen() {
            hideAllScreens();
            elements.gameScreen.style.display = 'block';
            updateGameUI();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function showCollectionScreen() {
            hideAllScreens();
            elements.collectionScreen.style.display = 'block';
            updateCollectionScreen();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω "–û–± –∏–≥—Ä–µ"
        function showAboutScreen() {
            hideAllScreens();
            elements.aboutScreen.style.display = 'block';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —ç–≤–æ–ª—é—Ü–∏–∏
        function showEvolutionScreen(pet, newSpecies) {
            hideAllScreens();
            elements.evolutionScreen.style.display = 'block';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>