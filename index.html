<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–ø–∏–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bear-color-1: #8B4513;
            --bear-color-2: #A0522D;
            --bear-color-3: #CD853F;
            --bear-color-4: #D2691E;
            --bear-color-5: #B8860B;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background-color: #f0e6d2;
            color: #3a2e1e;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23d4c9a8" d="M50 0c27.6 0 50 22.4 50 50s-22.4 50-50 50S0 77.6 0 50 22.4 0 50 0zm0 10c-22.1 0-40 17.9-40 40s17.9 40 40 40 40-17.9 40-40-17.9-40-40-40z"/></svg>');
            background-size: 30px 30px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #5d3a1a;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin: 0;
            font-family: 'Georgia', serif;
        }
        
        .header .pets-count {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #5d3a1a;
            color: #f0e6d2;
            padding: 5px 10px;
            border-radius: 50%;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .menu {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            background-color: #5d3a1a;
            color: #f0e6d2;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-family: 'Georgia', serif;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 2px solid #3a2e1e;
        }
        
        button:hover {
            background-color: #3a2e1e;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #a99b84;
            cursor: not-allowed;
            transform: none;
        }
        
        .game-screen {
            display: none;
        }
        
        .pets-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .pet {
            position: relative;
            width: 120px;
            text-align: center;
        }
        
        .pet-image {
            width: 100px;
            height: 100px;
            margin: 0 auto;
            position: relative;
            cursor: pointer;
        }
        
        .bear {
            width: 100%;
            height: 100%;
            background-color: var(--bear-color);
            border-radius: 50%;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .bear::before, .bear::after {
            content: '';
            position: absolute;
            background-color: var(--bear-color);
            border-radius: 50%;
        }
        
        .bear::before {
            width: 40px;
            height: 30px;
            top: -15px;
            left: 15px;
        }
        
        .bear::after {
            width: 15px;
            height: 15px;
            top: 30px;
            left: 25px;
            box-shadow: 30px 0 0 0 var(--bear-color);
        }
        
        .pet-stats {
            background-color: #e6d8b5;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid #c9b88a;
        }
        
        .stat {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .stat-icon {
            width: 20px;
            text-align: center;
            margin-right: 5px;
        }
        
        .progress-container {
            flex-grow: 1;
            height: 10px;
            background-color: #c9b88a;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
        }
        
        .hunger-bar { background-color: #d35400; }
        .energy-bar { background-color: #2980b9; }
        .happiness-bar { background-color: #e74c3c; }
        .level-bar { background-color: #8e44ad; }
        .xp-bar { background-color: #27ae60; }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 15px;
            font-size: 0.9rem;
            background-color: #8B4513;
        }
        
        .back-btn {
            margin-top: 20px;
            background-color: #7f1d1d;
        }
        
        .evolution-notice {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(139, 69, 19, 0.9);
            color: #f0e6d2;
            padding: 20px;
            border-radius: 10px;
            z-index: 100;
            text-align: center;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            animation: fadeInOut 3s forwards;
            display: none;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .hidden {
            display: none;
        }
        
        .main-menu {
            background-color: #e6d8b5;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border: 3px solid #c9b88a;
            margin-top: 30px;
        }
        
        .game-container {
            background-color: #e6d8b5;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border: 3px solid #c9b88a;
        }
        
        .pet-level {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #8e44ad;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 2;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="main-menu" class="main-menu">
            <div class="header">
                <h1>–¢–∞–ø–∏–∫–∏</h1>
                <p>–í—ã—Ä–∞—â–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏—Ö –º–∏—à–µ–∫ –∏ –Ω–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –∏—Ö —ç–≤–æ–ª—é—Ü–∏–µ–π!</p>
            </div>
            <div class="menu">
                <button id="continue-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É</button>
                <button id="new-game-btn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            </div>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="game-screen" class="game-screen game-container">
            <div class="header">
                <h1>–¢–∞–ø–∏–∫–∏</h1>
                <div class="pets-count" id="pets-count">0</div>
            </div>
            
            <div class="pets-container" id="pets-container">
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –º–∏—à–∫–∏ -->
            </div>
            
            <div class="actions">
                <button class="action-btn" id="feed-btn">–ü–æ–∫–æ—Ä–º–∏—Ç—å</button>
                <button class="action-btn" id="rest-btn">–û—Ç–¥—ã—Ö</button>
                <button class="action-btn" id="play-btn">–ü–æ–∏–≥—Ä–∞—Ç—å</button>
            </div>
            
            <button class="back-btn" id="back-btn">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç–≤–æ–ª—é—Ü–∏–∏ -->
        <div id="evolution-notice" class="evolution-notice hidden"></div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const MAX_STATS = 100;
        const MAX_LEVEL = 15;
        
        // –°–∫–æ—Ä–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö –≤ —Å–µ–∫—É–Ω–¥—É)
        const HUNGER_RATE = 0.5;
        const ENERGY_RATE = 0.3;
        const HAPPINESS_RATE = 0.4;
        const XP_RATE = 0.1;
        
        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö
        const FEED_AMOUNT = 30;
        const REST_AMOUNT = 40;
        const PLAY_AMOUNT = 25;
        
        // –¶–≤–µ—Ç–∞ –º–∏—à–µ–∫
        const BEAR_COLORS = [
            '#8B4513', '#A0522D', '#CD853F', '#D2691E', '#B8860B'
        ];
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            pets: [],
            lastUpdate: Date.now(),
            gameStarted: false,
            selectedPetIndex: 0
        };
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const mainMenu = document.getElementById('main-menu');
        const gameScreen = document.getElementById('game-screen');
        const petsContainer = document.getElementById('pets-container');
        const petsCount = document.getElementById('pets-count');
        const evolutionNotice = document.getElementById('evolution-notice');
        
        // –ö–Ω–æ–ø–∫–∏
        const continueBtn = document.getElementById('continue-btn');
        const newGameBtn = document.getElementById('new-game-btn');
        const backBtn = document.getElementById('back-btn');
        const feedBtn = document.getElementById('feed-btn');
        const restBtn = document.getElementById('rest-btn');
        const playBtn = document.getElementById('play-btn');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        continueBtn.addEventListener('click', continueGame);
        newGameBtn.addEventListener('click', startNewGame);
        backBtn.addEventListener('click', returnToMainMenu);
        feedBtn.addEventListener('click', () => performAction('feed'));
        restBtn.addEventListener('click', () => performAction('rest'));
        playBtn.addEventListener('click', () => performAction('play'));
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            loadGame();
            updateContinueButton();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Web App
            tg.expand();
            tg.MainButton.hide();
        });
        
        // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
        function startNewGame() {
            gameState = {
                pets: [createNewPet()],
                lastUpdate: Date.now(),
                gameStarted: true,
                selectedPetIndex: 0
            };
            
            saveGame();
            showGameScreen();
            startGameLoop();
        }
        
        function continueGame() {
            if (gameState.pets.length === 0) {
                gameState.pets = [createNewPet()];
            }
            
            updateGame();
            renderPets();
            showGameScreen();
            startGameLoop();
        }
        
        function returnToMainMenu() {
            saveGame();
            gameScreen.style.display = 'none';
            mainMenu.style.display = 'block';
            stopGameLoop();
        }
        
        function showGameScreen() {
            mainMenu.style.display = 'none';
            gameScreen.style.display = 'block';
        }
        
        function createNewPet() {
            const color = BEAR_COLORS[Math.floor(Math.random() * BEAR_COLORS.length)];
            
            return {
                id: Date.now().toString(),
                color: color,
                hunger: MAX_STATS / 2,
                energy: MAX_STATS / 2,
                happiness: MAX_STATS / 2,
                level: 1,
                xp: 0,
                lastFed: Date.now(),
                lastRested: Date.now(),
                lastPlayed: Date.now(),
                createdAt: Date.now()
            };
        }
        
        function updateGame() {
            const now = Date.now();
            const timePassed = (now - gameState.lastUpdate) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdate = now;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ—Ö –ø–∏—Ç–æ–º—Ü–µ–≤
            gameState.pets.forEach(pet => {
                // –£–º–µ–Ω—å—à–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                pet.hunger = Math.max(0, pet.hunger - HUNGER_RATE * timePassed);
                pet.energy = Math.max(0, pet.energy - ENERGY_RATE * timePassed);
                pet.happiness = Math.max(0, pet.happiness - HAPPINESS_RATE * timePassed);
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–ø—ã—Ç, –µ—Å–ª–∏ –ø–∏—Ç–æ–º–µ—Ü —É—Ö–æ–∂–µ–Ω
                if (pet.hunger > 30 && pet.energy > 20 && pet.happiness > 25) {
                    pet.xp = Math.min(MAX_STATS, pet.xp + XP_RATE * timePassed);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–±—Ä–∞–ª –ª–∏ –ø–∏—Ç–æ–º–µ—Ü –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–∞ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
                if (pet.xp >= MAX_STATS) {
                    pet.level++;
                    pet.xp = 0;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥ –ª–∏ –ø–∏—Ç–æ–º–µ—Ü —É—Ä–æ–≤–Ω—è –¥–ª—è —ç–≤–æ–ª—é—Ü–∏–∏ (–∫–∞–∂–¥—ã–µ 3 —É—Ä–æ–≤–Ω—è)
                    if (pet.level % 3 === 0) {
                        evolvePet(pet);
                    }
                }
            });
            
            // –£–¥–∞–ª—è–µ–º "—É–º–µ—Ä—à–∏—Ö" –ø–∏—Ç–æ–º—Ü–µ–≤ (–µ—Å–ª–∏ –≤—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –Ω—É–ª–µ)
            gameState.pets = gameState.pets.filter(pet => 
                pet.hunger > 0 || pet.energy > 0 || pet.happiness > 0
            );
            
            // –ï—Å–ª–∏ –ø–∏—Ç–æ–º—Ü–µ–≤ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å, –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É
            if (gameState.pets.length === 0 && gameState.gameStarted) {
                showEvolutionNotice('–í—Å–µ –≤–∞—à–∏ –º–∏—à–∫–∏ –ø–æ–≥–∏–±–ª–∏! –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É.');
                startNewGame();
                return;
            }
            
            saveGame();
            renderPets();
        }
        
        function evolvePet(pet) {
            showEvolutionNotice(`–ú–∏—à–∫–∞ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª –¥–æ —É—Ä–æ–≤–Ω—è ${pet.level}!`);
            
            // –ü—Ä–∏ —ç–≤–æ–ª—é—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º —Ü–≤–µ—Ç (–ø–æ –≤–∞—à–µ–º—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –º–µ–Ω—è—é—Ç—Å—è)
            const newColor = BEAR_COLORS[Math.floor(Math.random() * BEAR_COLORS.length)];
            pet.color = newColor;
        }
        
        function performAction(action) {
            if (gameState.pets.length === 0) return;
            
            const pet = gameState.pets[gameState.selectedPetIndex];
            
            switch (action) {
                case 'feed':
                    pet.hunger = Math.min(MAX_STATS, pet.hunger + FEED_AMOUNT);
                    pet.lastFed = Date.now();
                    break;
                case 'rest':
                    pet.energy = Math.min(MAX_STATS, pet.energy + REST_AMOUNT);
                    pet.lastRested = Date.now();
                    break;
                case 'play':
                    pet.happiness = Math.min(MAX_STATS, pet.happiness + PLAY_AMOUNT);
                    pet.lastPlayed = Date.now();
                    break;
            }
            
            saveGame();
            renderPets();
        }
        
        function renderPets() {
            petsContainer.innerHTML = '';
            
            if (gameState.pets.length === 0) {
                const noPetsMsg = document.createElement('p');
                noPetsMsg.textContent = '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –º–∏—à–µ–∫.';
                petsContainer.appendChild(noPetsMsg);
                petsCount.textContent = '0';
                return;
            }
            
            petsCount.textContent = gameState.pets.length;
            
            gameState.pets.forEach((pet, index) => {
                const petElement = document.createElement('div');
                petElement.className = 'pet';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ –ø–∏—Ç–æ–º–µ—Ü —É—Ö–æ–∂–µ–Ω
                const isHealthy = pet.hunger > 50 && pet.energy > 40 && pet.happiness > 45;
                const animationDelay = index * 0.2;
                
                petElement.innerHTML = `
                    <div class="pet-image" data-index="${index}">
                        <div class="bear" style="--bear-color: ${pet.color}; animation-delay: ${animationDelay}s"></div>
                        <div class="pet-level">${pet.level}</div>
                    </div>
                    <div class="pet-stats">
                        <div class="stat">
                            <div class="stat-icon">üçó</div>
                            <div class="progress-container">
                                <div class="progress-bar hunger-bar" style="width: ${(pet.hunger / MAX_STATS) * 100}%"></div>
                            </div>
                        </div>
                        <div class="stat">
                            <div class="stat-icon">üí§</div>
                            <div class="progress-container">
                                <div class="progress-bar energy-bar" style="width: ${(pet.energy / MAX_STATS) * 100}%"></div>
                            </div>
                        </div>
                        <div class="stat">
                            <div class="stat-icon">üé≤</div>
                            <div class="progress-container">
                                <div class="progress-bar happiness-bar" style="width: ${(pet.happiness / MAX_STATS) * 100}%"></div>
                            </div>
                        </div>
                        <div class="stat">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="progress-container">
                                <div class="progress-bar xp-bar" style="width: ${(pet.xp / MAX_STATS) * 100}%"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –º–∏—à–∫–∏
                petElement.querySelector('.pet-image').addEventListener('click', () => {
                    gameState.selectedPetIndex = index;
                    renderPets();
                });
                
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–∏—à–∫—É
                if (index === gameState.selectedPetIndex) {
                    petElement.style.transform = 'scale(1.05)';
                    petElement.style.zIndex = '1';
                }
                
                petsContainer.appendChild(petElement);
            });
        }
        
        function showEvolutionNotice(message) {
            evolutionNotice.textContent = message;
            evolutionNotice.classList.remove('hidden');
            
            setTimeout(() => {
                evolutionNotice.classList.add('hidden');
            }, 3000);
        }
        
        function startGameLoop() {
            stopGameLoop();
            window.gameLoop = setInterval(updateGame, 1000);
        }
        
        function stopGameLoop() {
            if (window.gameLoop) {
                clearInterval(window.gameLoop);
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        function saveGame() {
            localStorage.setItem('tapiGameState', JSON.stringify(gameState));
        }
        
        function loadGame() {
            const savedGame = localStorage.getItem('tapiGameState');
            if (savedGame) {
                try {
                    const parsed = JSON.parse(savedGame);
                    if (parsed.pets && Array.isArray(parsed.pets)) {
                        gameState = parsed;
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã:', e);
                }
            }
        }
        
        function updateContinueButton() {
            continueBtn.disabled = !gameState.gameStarted || gameState.pets.length === 0;
        }
    </script>
</body>
</html>