<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Tamagotchi</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }
        
        #game-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            padding: 20px;
            text-align: center;
        }
        
        #main-menu, #game-screen, #evolution-screen {
            display: none;
        }
        
        .active-screen {
            display: block !important;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .pet-container {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        
        .pet-stats {
            text-align: left;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 5px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 100%;
            transition: width 0.3s;
        }
        
        .hunger .progress-fill {
            background-color: #FF9800;
        }
        
        .energy .progress-fill {
            background-color: #2196F3;
        }
        
        .happiness .progress-fill {
            background-color: #E91E63;
        }
        
        .xp .progress-fill {
            background-color: #9C27B0;
        }
        
        .pets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .pet-item {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .pet-item:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .pet-item.selected {
            border: 2px solid #4CAF50;
            background-color: #f0fff0;
        }
        
        h1, h2, h3 {
            color: #2E7D32;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .notification.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="main-menu" class="active-screen">
            <h1>Evolution Tamagotchi</h1>
            <p>Raise your pet, help it evolve, and watch it multiply!</p>
            <button id="new-game-btn">New Game</button>
            <button id="continue-game-btn">Continue</button>
            <button id="how-to-play-btn">How to Play</button>
        </div>
        
        <div id="how-to-play-screen">
            <h2>How to Play</h2>
            <p>1. Take care of your pet by feeding, playing, and letting it rest.</p>
            <p>2. As your pet gains XP, it will level up.</p>
            <p>3. At level 5, your pet will evolve and gain new abilities.</p>
            <p>4. At level 10, your pet will divide into two new pets!</p>
            <p>5. Manage multiple pets and create your own ecosystem.</p>
            <button id="back-to-menu-btn">Back to Menu</button>
        </div>
        
        <div id="game-screen">
            <h2 id="game-title">Your Pets</h2>
            <div id="pets-container" class="pets-grid"></div>
            <div id="current-pet-container" class="pet-container">
                <h3 id="pet-name">No pet selected</h3>
                <p id="pet-level">Level: -</p>
                <p id="pet-stage">Stage: -</p>
                <div class="pet-stats">
                    <p>Hunger:</p>
                    <div class="progress-bar hunger">
                        <div class="progress-fill" id="hunger-bar"></div>
                    </div>
                    <p>Energy:</p>
                    <div class="progress-bar energy">
                        <div class="progress-fill" id="energy-bar"></div>
                    </div>
                    <p>Happiness:</p>
                    <div class="progress-bar happiness">
                        <div class="progress-fill" id="happiness-bar"></div>
                    </div>
                    <p>XP:</p>
                    <div class="progress-bar xp">
                        <div class="progress-fill" id="xp-bar"></div>
                    </div>
                </div>
                <button id="feed-btn">Feed</button>
                <button id="play-btn">Play</button>
                <button id="sleep-btn">Rest</button>
                <button id="train-btn">Train</button>
                <button id="back-to-menu-game-btn">Menu</button>
            </div>
        </div>
        
        <div id="evolution-screen">
            <h2>Evolution!</h2>
            <p id="evolution-message"></p>
            <button id="evolution-continue-btn">Continue</button>
        </div>
        
        <div class="notification" id="notification"></div>
    </div>

    <script>
        // Game state
        const gameState = {
            pets: [],
            currentPetIndex: null,
            gameStarted: false,
            lastUpdate: Date.now()
        };
        
        // Pet stages
        const stages = [
            { name: "Egg", maxLevel: 1, divide: false },
            { name: "Baby", maxLevel: 5, divide: false },
            { name: "Adult", maxLevel: 10, divide: true },
            { name: "Elder", maxLevel: 15, divide: false }
        ];
        
        // DOM elements
        const elements = {
            mainMenu: document.getElementById('main-menu'),
            howToPlayScreen: document.getElementById('how-to-play-screen'),
            gameScreen: document.getElementById('game-screen'),
            evolutionScreen: document.getElementById('evolution-screen'),
            petsContainer: document.getElementById('pets-container'),
            currentPetContainer: document.getElementById('current-pet-container'),
            petName: document.getElementById('pet-name'),
            petLevel: document.getElementById('pet-level'),
            petStage: document.getElementById('pet-stage'),
            hungerBar: document.getElementById('hunger-bar'),
            energyBar: document.getElementById('energy-bar'),
            happinessBar: document.getElementById('happiness-bar'),
            xpBar: document.getElementById('xp-bar'),
            notification: document.getElementById('notification')
        };
        
        // Buttons
        const buttons = {
            newGame: document.getElementById('new-game-btn'),
            continueGame: document.getElementById('continue-game-btn'),
            howToPlay: document.getElementById('how-to-play-btn'),
            backToMenu: document.getElementById('back-to-menu-btn'),
            backToMenuGame: document.getElementById('back-to-menu-game-btn'),
            feed: document.getElementById('feed-btn'),
            play: document.getElementById('play-btn'),
            sleep: document.getElementById('sleep-btn'),
            train: document.getElementById('train-btn'),
            evolutionContinue: document.getElementById('evolution-continue-btn')
        };
        
        // Initialize the game
        function init() {
            loadGame();
            setupEventListeners();
            updateGame();
            
            if (gameState.gameStarted && gameState.pets.length > 0) {
                showScreen('game-screen');
                renderPets();
                if (gameState.currentPetIndex !== null) {
                    selectPet(gameState.currentPetIndex);
                }
            } else {
                showScreen('main-menu');
            }
        }
        
        // Set up event listeners
        function setupEventListeners() {
            buttons.newGame.addEventListener('click', startNewGame);
            buttons.continueGame.addEventListener('click', continueGame);
            buttons.howToPlay.addEventListener('click', () => showScreen('how-to-play-screen'));
            buttons.backToMenu.addEventListener('click', () => showScreen('main-menu'));
            buttons.backToMenuGame.addEventListener('click', () => {
                saveGame();
                showScreen('main-menu');
            });
            buttons.feed.addEventListener('click', () => performAction('feed'));
            buttons.play.addEventListener('click', () => performAction('play'));
            buttons.sleep.addEventListener('click', () => performAction('sleep'));
            buttons.train.addEventListener('click', () => performAction('train'));
            buttons.evolutionContinue.addEventListener('click', handleEvolutionContinue);
        }
        
        // Show a specific screen
        function showScreen(screenId) {
            document.querySelectorAll('#game-container > div').forEach(div => {
                div.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }
        
        // Start a new game
        function startNewGame() {
            gameState.pets = [createNewPet()];
            gameState.currentPetIndex = 0;
            gameState.gameStarted = true;
            gameState.lastUpdate = Date.now();
            
            saveGame();
            showScreen('game-screen');
            renderPets();
            selectPet(0);
        }
        
        // Continue existing game
        function continueGame() {
            if (gameState.pets.length > 0) {
                showScreen('game-screen');
                renderPets();
                if (gameState.currentPetIndex !== null) {
                    selectPet(gameState.currentPetIndex);
                } else {
                    selectPet(0);
                }
            } else {
                startNewGame();
            }
        }
        
        // Create a new pet
        function createNewPet() {
            const names = ["Blip", "Zorg", "Floo", "Glip", "Snorf", "Wibble", "Plink", "Dorb"];
            const randomName = names[Math.floor(Math.random() * names.length)];
            
            return {
                name: randomName,
                hunger: 100,
                energy: 100,
                happiness: 100,
                xp: 0,
                level: 1,
                stage: 0,
                lastFed: Date.now(),
                lastPlayed: Date.now(),
                lastSlept: Date.now(),
                lastTrained: Date.now()
            };
        }
        
        // Render all pets
        function renderPets() {
            elements.petsContainer.innerHTML = '';
            
            gameState.pets.forEach((pet, index) => {
                const petElement = document.createElement('div');
                petElement.className = 'pet-item';
                if (index === gameState.currentPetIndex) {
                    petElement.classList.add('selected');
                }
                
                petElement.innerHTML = `
                    <h3>${pet.name}</h3>
                    <p>Level: ${pet.level}</p>
                    <p>${stages[pet.stage].name}</p>
                `;
                
                petElement.addEventListener('click', () => selectPet(index));
                elements.petsContainer.appendChild(petElement);
            });
        }
        
        // Select a pet
        function selectPet(index) {
            gameState.currentPetIndex = index;
            const pet = gameState.pets[index];
            
            elements.petName.textContent = pet.name;
            elements.petLevel.textContent = `Level: ${pet.level}`;
            elements.petStage.textContent = `Stage: ${stages[pet.stage].name}`;
            
            updatePetStatsDisplay(pet);
            renderPets();
        }
        
        // Update pet stats display
        function updatePetStatsDisplay(pet) {
            elements.hungerBar.style.width = `${pet.hunger}%`;
            elements.energyBar.style.width = `${pet.energy}%`;
            elements.happinessBar.style.width = `${pet.happiness}%`;
            
            const xpNeeded = getXpNeededForLevel(pet.level);
            elements.xpBar.style.width = `${(pet.xp / xpNeeded) * 100}%`;
        }
        
        // Perform an action on the current pet
        function performAction(action) {
            if (gameState.currentPetIndex === null) return;
            
            const pet = gameState.pets[gameState.currentPetIndex];
            const now = Date.now();
            
            switch (action) {
                case 'feed':
                    if (pet.hunger >= 100) {
                        showNotification(`${pet.name} is not hungry!`);
                        return;
                    }
                    pet.hunger = Math.min(100, pet.hunger + 30);
                    pet.lastFed = now;
                    showNotification(`You fed ${pet.name}!`);
                    break;
                    
                case 'play':
                    if (pet.energy < 20) {
                        showNotification(`${pet.name} is too tired to play!`);
                        return;
                    }
                    pet.happiness = Math.min(100, pet.happiness + 25);
                    pet.energy = Math.max(0, pet.energy - 20);
                    pet.lastPlayed = now;
                    showNotification(`You played with ${pet.name}!`);
                    break;
                    
                case 'sleep':
                    if (pet.energy >= 100) {
                        showNotification(`${pet.name} is not tired!`);
                        return;
                    }
                    pet.energy = Math.min(100, pet.energy + 40);
                    pet.lastSlept = now;
                    showNotification(`${pet.name} took a nap!`);
                    break;
                    
                case 'train':
                    if (pet.energy < 30) {
                        showNotification(`${pet.name} is too tired to train!`);
                        return;
                    }
                    if (pet.hunger < 20) {
                        showNotification(`${pet.name} is too hungry to train!`);
                        return;
                    }
                    
                    const xpGain = 10 + Math.floor(Math.random() * 10);
                    pet.xp += xpGain;
                    pet.energy = Math.max(0, pet.energy - 30);
                    pet.hunger = Math.max(0, pet.hunger - 20);
                    pet.lastTrained = now;
                    showNotification(`${pet.name} gained ${xpGain} XP from training!`);
                    
                    // Check for level up
                    checkLevelUp(pet);
                    break;
            }
            
            updatePetStatsDisplay(pet);
            saveGame();
        }
        
        // Check if pet should level up
        function checkLevelUp(pet) {
            const xpNeeded = getXpNeededForLevel(pet.level);
            
            if (pet.xp >= xpNeeded) {
                pet.xp -= xpNeeded;
                pet.level++;
                
                showNotification(`${pet.name} leveled up to level ${pet.level}!`);
                
                // Check for stage evolution
                checkStageEvolution(pet);
                
                updatePetStatsDisplay(pet);
                saveGame();
            }
        }
        
        // Check for stage evolution
        function checkStageEvolution(pet) {
            const currentStage = stages[pet.stage];
            
            if (pet.level >= currentStage.maxLevel && pet.stage < stages.length - 1) {
                // Evolve to next stage
                pet.stage++;
                const newStage = stages[pet.stage];
                
                // Show evolution screen
                elements.evolutionMessage.textContent = 
                    `${pet.name} has evolved from ${currentStage.name} to ${newStage.name}!`;
                
                showScreen('evolution-screen');
                
                // Check for division
                if (currentStage.divide) {
                    dividePet(pet);
                }
            }
        }
        
        // Handle evolution continue
        function handleEvolutionContinue() {
            showScreen('game-screen');
            renderPets();
            if (gameState.currentPetIndex !== null) {
                selectPet(gameState.currentPetIndex);
            }
        }
        
        // Divide pet into two new pets
        function dividePet(pet) {
            const newPet1 = createNewPet();
            const newPet2 = createNewPet();
            
            // Inherit some stats
            newPet1.level = Math.floor(pet.level / 2);
            newPet2.level = Math.ceil(pet.level / 2);
            
            // Add new pets and remove the original
            const originalIndex = gameState.currentPetIndex;
            gameState.pets.splice(originalIndex, 1, newPet1, newPet2);
            
            // Select the first new pet
            gameState.currentPetIndex = originalIndex;
            
            showNotification(`${pet.name} has divided into ${newPet1.name} and ${newPet2.name}!`);
        }
        
        // Get XP needed for next level
        function getXpNeededForLevel(level) {
            return level * 100;
        }
        
        // Show notification
        function showNotification(message) {
            elements.notification.textContent = message;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }
        
        // Update game state (decrease stats over time)
        function updateGame() {
            if (!gameState.gameStarted || gameState.pets.length === 0) return;
            
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdate) / 1000; // in seconds
            gameState.lastUpdate = now;
            
            gameState.pets.forEach(pet => {
                // Decrease hunger (1% per minute)
                pet.hunger = Math.max(0, pet.hunger - deltaTime / 60);
                
                // Decrease energy if not sleeping (1% per 2 minutes)
                pet.energy = Math.max(0, pet.energy - deltaTime / 120);
                
                // Decrease happiness (1% per 3 minutes)
                pet.happiness = Math.max(0, pet.happiness - deltaTime / 180);
            });
            
            // Update display if current pet is selected
            if (gameState.currentPetIndex !== null) {
                updatePetStatsDisplay(gameState.pets[gameState.currentPetIndex]);
            }
            
            saveGame();
            
            // Schedule next update
            setTimeout(updateGame, 1000);
        }
        
        // Save game to localStorage
        function saveGame() {
            const saveData = {
                pets: gameState.pets,
                currentPetIndex: gameState.currentPetIndex,
                gameStarted: gameState.gameStarted,
                lastUpdate: gameState.lastUpdate
            };
            
            localStorage.setItem('evolutionTamagotchiSave', JSON.stringify(saveData));
        }
        
        // Load game from localStorage
        function loadGame() {
            const saveData = localStorage.getItem('evolutionTamagotchiSave');
            
            if (saveData) {
                const parsedData = JSON.parse(saveData);
                
                gameState.pets = parsedData.pets || [];
                gameState.currentPetIndex = parsedData.currentPetIndex !== undefined ? 
                    parsedData.currentPetIndex : null;
                gameState.gameStarted = parsedData.gameStarted || false;
                gameState.lastUpdate = parsedData.lastUpdate || Date.now();
            }
        }
        
        // Initialize the game when the page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>