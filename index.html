<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bird Hunt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #87CEEB;
            font-family: Arial, sans-serif;
            touch-action: manipulation;
            user-select: none;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        #sky {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);
        }
        
        #ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 20%;
            background: linear-gradient(to bottom, #8BC34A, #4CAF50);
        }
        
        .bird {
            position: absolute;
            width: 50px;
            height: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><path d="M25,10 Q30,5 35,10 Q40,15 35,20 Q30,25 25,20 Q20,15 25,10" fill="%23FF5722"/><circle cx="30" cy="15" r="2" fill="black"/><path d="M35,15 Q40,10 45,15" stroke="black" stroke-width="1" fill="none"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            transition: transform 0.1s;
            z-index: 10;
        }
        
        .bullet {
            position: absolute;
            width: 5px;
            height: 15px;
            background-color: black;
            border-radius: 2px;
            z-index: 5;
        }
        
        .explosion {
            position: absolute;
            width: 60px;
            height: 60px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><circle cx="30" cy="30" r="30" fill="%23FFEB3B" opacity="0.8"/><path d="M15,15 L45,45 M15,45 L45,15 M30,5 L30,55 M5,30 L55,30" stroke="%23FF5722" stroke-width="3"/></svg>');
            background-size: contain;
            z-index: 15;
            animation: explode 0.5s forwards;
        }
        
        @keyframes explode {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        #score-display {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 20;
        }
        
        #ammo-display {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 20;
        }
        
        #game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
            color: white;
            font-size: 36px;
            display: none;
        }
        
        #restart-btn {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        #crosshair {
            position: absolute;
            width: 30px;
            height: 30px;
            pointer-events: none;
            z-index: 25;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><circle cx="15" cy="15" r="12" fill="none" stroke="red" stroke-width="2"/><line x1="15" y1="0" x2="15" y2="8" stroke="red" stroke-width="2"/><line x1="15" y1="22" x2="15" y2="30" stroke="red" stroke-width="2"/><line x1="0" y1="15" x2="8" y2="15" stroke="red" stroke-width="2"/><line x1="22" y1="15" x2="30" y2="15" stroke="red" stroke-width="2"/></svg>');
            background-size: contain;
            transform: translate(-15px, -15px);
            display: none;
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 40;
            color: white;
            font-size: 24px;
            text-align: center;
        }
        
        #start-btn {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        #instructions {
            margin-top: 20px;
            font-size: 18px;
            max-width: 80%;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="sky"></div>
        <div id="ground"></div>
        <div id="score-display">Score: 0</div>
        <div id="ammo-display">Ammo: 10</div>
        <div id="crosshair"></div>
        
        <div id="game-over">
            <h1>Game Over</h1>
            <p id="final-score">Your score: 0</p>
            <button id="restart-btn">Play Again</button>
        </div>
        
        <div id="start-screen">
            <h1>Bird Hunt</h1>
            <div id="instructions">
                <p>Shoot the flying birds to score points!</p>
                <p>Tap to shoot. You have limited ammo.</p>
                <p>Try to hit as many birds as possible!</p>
            </div>
            <button id="start-btn">Start Game</button>
        </div>
    </div>

    <script>
        // Game variables
        let score = 0;
        let ammo = 10;
        let gameActive = false;
        let birds = [];
        let bullets = [];
        let explosions = [];
        let birdSpawnInterval;
        let gameTime = 60; // 60 seconds game duration
        let timeLeft = gameTime;
        let gameTimer;
        
        // DOM elements
        const gameContainer = document.getElementById('game-container');
        const scoreDisplay = document.getElementById('score-display');
        const ammoDisplay = document.getElementById('ammo-display');
        const crosshair = document.getElementById('crosshair');
        const gameOverScreen = document.getElementById('game-over');
        const finalScoreDisplay = document.getElementById('final-score');
        const restartBtn = document.getElementById('restart-btn');
        const startScreen = document.getElementById('start-screen');
        const startBtn = document.getElementById('start-btn');
        
        // Initialize Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // Game functions
        function startGame() {
            // Reset game state
            score = 0;
            ammo = 10;
            timeLeft = gameTime;
            birds.forEach(bird => bird.element.remove());
            bullets.forEach(bullet => bullet.element.remove());
            explosions.forEach(explosion => explosion.element.remove());
            birds = [];
            bullets = [];
            explosions = [];
            
            // Update displays
            updateScore();
            updateAmmo();
            
            // Hide start screen and show game
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            gameActive = true;
            
            // Start bird spawning
            birdSpawnInterval = setInterval(spawnBird, 1500);
            
            // Start game timer
            gameTimer = setInterval(updateTimer, 1000);
        }
        
        function endGame() {
            gameActive = false;
            clearInterval(birdSpawnInterval);
            clearInterval(gameTimer);
            
            // Show game over screen
            finalScoreDisplay.textContent = `Your score: ${score}`;
            gameOverScreen.style.display = 'flex';
            
            // Send score to Telegram bot if available
            if (tg && tg.sendData) {
                tg.sendData(JSON.stringify({ score: score }));
            }
        }
        
        function updateTimer() {
            timeLeft--;
            
            if (timeLeft <= 0) {
                endGame();
            }
        }
        
        function spawnBird() {
            if (!gameActive) return;
            
            const bird = {
                element: document.createElement('div'),
                x: Math.random() > 0.5 ? -50 : gameContainer.clientWidth + 50,
                y: Math.random() * (gameContainer.clientHeight * 0.7),
                speedX: (Math.random() * 3 + 2) * (Math.random() > 0.5 ? 1 : -1),
                speedY: (Math.random() * 2 - 1),
                width: 50,
                height: 50
            };
            
            bird.element.className = 'bird';
            bird.element.style.left = `${bird.x}px`;
            bird.element.style.top = `${bird.y}px`;
            
            // Flip bird image if moving left
            if (bird.speedX < 0) {
                bird.element.style.transform = 'scaleX(-1)';
            }
            
            gameContainer.appendChild(bird.element);
            birds.push(bird);
        }
        
        function shoot(x, y) {
            if (!gameActive || ammo <= 0) return;
            
            ammo--;
            updateAmmo();
            
            const bullet = {
                element: document.createElement('div'),
                x: gameContainer.clientWidth / 2,
                y: gameContainer.clientHeight - 50,
                targetX: x,
                targetY: y,
                speed: 20,
                width: 5,
                height: 15
            };
            
            bullet.element.className = 'bullet';
            bullet.element.style.left = `${bullet.x}px`;
            bullet.element.style.top = `${bullet.y}px`;
            
            // Calculate angle for bullet direction
            const dx = bullet.targetX - bullet.x;
            const dy = bullet.targetY - bullet.y;
            const angle = Math.atan2(dy, dx);
            
            bullet.vx = Math.cos(angle) * bullet.speed;
            bullet.vy = Math.sin(angle) * bullet.speed;
            
            gameContainer.appendChild(bullet.element);
            bullets.push(bullet);
            
            // Play shooting sound
            playSound('shoot');
        }
        
        function createExplosion(x, y) {
            const explosion = {
                element: document.createElement('div'),
                x: x,
                y: y
            };
            
            explosion.element.className = 'explosion';
            explosion.element.style.left = `${x}px`;
            explosion.element.style.top = `${y}px`;
            
            gameContainer.appendChild(explosion.element);
            explosions.push(explosion);
            
            // Remove explosion after animation
            setTimeout(() => {
                explosion.element.remove();
                explosions = explosions.filter(e => e !== explosion);
            }, 500);
            
            // Play explosion sound
            playSound('explosion');
        }
        
        function checkCollisions() {
            bullets.forEach((bullet, bulletIndex) => {
                birds.forEach((bird, birdIndex) => {
                    if (isColliding(bullet, bird)) {
                        // Bird hit!
                        createExplosion(bird.x, bird.y);
                        bird.element.remove();
                        bullets.splice(bulletIndex, 1);
                        bullet.element.remove();
                        birds.splice(birdIndex, 1);
                        
                        // Add score
                        score += 10;
                        updateScore();
                        
                        // Add ammo every 5 birds
                        if (score % 50 === 0) {
                            ammo += 5;
                            updateAmmo();
                        }
                    }
                });
            });
        }
        
        function isColliding(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }
        
        function updateScore() {
            scoreDisplay.textContent = `Score: ${score}`;
        }
        
        function updateAmmo() {
            ammoDisplay.textContent = `Ammo: ${ammo}`;
            
            if (ammo <= 0) {
                setTimeout(() => {
                    if (ammo <= 0) {
                        endGame();
                    }
                }, 2000);
            }
        }
        
        function playSound(type) {
            // In a real implementation, you would play actual sound files here
            // For this demo, we'll just log the sound event
            console.log(`Playing ${type} sound`);
        }
        
        function updateGame() {
            if (!gameActive) return;
            
            // Update birds
            birds.forEach(bird => {
                bird.x += bird.speedX;
                bird.y += bird.speedY;
                
                // Bounce off top and bottom
                if (bird.y <= 0 || bird.y >= gameContainer.clientHeight * 0.8) {
                    bird.speedY *= -1;
                }
                
                // Remove if off screen
                if (bird.x < -100 || bird.x > gameContainer.clientWidth + 100) {
                    bird.element.remove();
                    birds = birds.filter(b => b !== bird);
                    return;
                }
                
                bird.element.style.left = `${bird.x}px`;
                bird.element.style.top = `${bird.y}px`;
            });
            
            // Update bullets
            bullets.forEach(bullet => {
                bullet.x += bullet.vx;
                bullet.y += bullet.vy;
                bullet.element.style.left = `${bullet.x}px`;
                bullet.element.style.top = `${bullet.y}px`;
                
                // Remove if off screen
                if (bullet.x < 0 || bullet.x > gameContainer.clientWidth || 
                    bullet.y < 0 || bullet.y > gameContainer.clientHeight) {
                    bullet.element.remove();
                    bullets = bullets.filter(b => b !== bullet);
                }
            });
            
            // Check for collisions
            checkCollisions();
            
            // Continue game loop
            requestAnimationFrame(updateGame);
        }
        
        // Event listeners
        gameContainer.addEventListener('click', (e) => {
            if (gameActive) {
                shoot(e.clientX, e.clientY);
            }
        });
        
        gameContainer.addEventListener('mousemove', (e) => {
            crosshair.style.display = 'block';
            crosshair.style.left = `${e.clientX}px`;
            crosshair.style.top = `${e.clientY}px`;
        });
        
        gameContainer.addEventListener('mouseleave', () => {
            crosshair.style.display = 'none';
        });
        
        // Touch support for mobile
        gameContainer.addEventListener('touchstart', (e) => {
            if (gameActive) {
                e.preventDefault();
                const touch = e.touches[0];
                shoot(touch.clientX, touch.clientY);
            }
        });
        
        gameContainer.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            crosshair.style.display = 'block';
            crosshair.style.left = `${touch.clientX}px`;
            crosshair.style.top = `${touch.clientY}px`;
        });
        
        gameContainer.addEventListener('touchend', () => {
            crosshair.style.display = 'none';
        });
        
        restartBtn.addEventListener('click', startGame);
        startBtn.addEventListener('click', startGame);
        
        // Start the game loop
        updateGame();
    </script>
</body>
</html>
